<!DOCTYPE html>
<!-- Generated by claude-code-log v0.8.0 -->
<html lang='en'>

<head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'>
    <title>Claude Transcripts - claude-hooks</title>
    
    <style>
/* Global styles shared across all templates */

/* CSS Variables for shared colors and consistent theming */
:root {
    /* Base colors */
    --code-bg-color: #f5f1e8;
    --tool-param-sep-color: #4b494822;

    /* Dimmed/transparent variants (66 = ~40% opacity) */
    --white-dimmed: #ffffff66;
    --highlight-dimmed: #e3f2fd66;
    --assistant-dimmed: #9c27b066;
    --info-dimmed: #2196f366;
    --warning-dimmed: #d9810066;
    --success-dimmed: #4caf5066;
    --error-dimmed: #f4433666;
    --neutral-dimmed: #f8f9fa66;
    --tool-input-dimmed: #fff3cd66;
    --thinking-dimmed: #f0f0f066;
    --tool-result-dimmed: #e8f5e866;
    --session-bg-dimmed: #e8f4fd66;
    --ide-notification-dimmed: #d2d6d966;

    /* Fully transparent variants (88 = ~53% opacity) */
    --highlight-semi: #e3f2fd88;
    --error-semi: #ffebee88;
    --neutral-semi: #f8f9fa88;

    /* Slightly transparent variants (55 = ~33% opacity) */
    --highlight-light: #e3f2fd55;

    /* Solid colors for text and accents */
    --text-muted: #666;
    --text-secondary: #495057;

    /* Font families */
    --font-monospace: 'Fira Code', 'Monaco', 'Consolas', 'SF Mono', 'Inconsolata', 'Droid Sans Mono', 'Source Code Pro', 'Ubuntu Mono', 'Cascadia Code', 'Menlo', monospace;
    --font-ui: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
}

body {
    font-family: var(--font-monospace);
    line-height: 1.5;
    max-width: 1200px;
    margin: 0 auto;
    padding: 10px;
    background: linear-gradient(90deg, #f3d6d2, #f1dcce, #f0e4ca, #eeecc7, #e3ecc3, #d5eac0, #c6e8bd, #b9e6bc, #b6e3c5, #b3e1cf);
    color: #333;
}

h1 {
    text-align: center;
    color: #2c3e50;
    margin-bottom: 20px;
    font-size: 1.8em;
}

/* Common typography */

code {
    background-color: var(--code-bg-color);
    padding: 2px 4px;
    border-radius: 3px;
    font-family: var(--font-monospace);
    line-height: 1.5;
}


pre {
    background-color: #12121212;
    padding: 10px;
    border-radius: 5px;
    white-space: pre-wrap;
    word-wrap: break-word;
    word-break: break-word;
    font-family: var(--font-monospace);
    line-height: 1.5;
}

/* Common card styling */
.card-base {
    background-color: #ffffff66;
    border-radius: 8px;
    padding: 16px;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: #ffffff66 1px solid;
    border-top: #ffffff66 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

.card-base:hover {
    box-shadow: -10px -10px 15px #eeeeee66, 10px 10px 15px #00000022;
    transform: translateY(-1px);
    transition: all 0.2s ease;
}

/* Common header styling */
.header {
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}

.header > span:first-child {
    flex: 1;
    min-width: 0;
    overflow: hidden;
}

/* Tool summary in header */
.tool-summary {
    font-weight: normal;
    color: var(--text-muted);
    font-size: 0.95em;
    word-break: break-all;
    overflow-wrap: anywhere;
    display: inline;
}

/* Timestamps */
.timestamp {
    font-size: 0.85em;
    color: #666;
    font-weight: normal;
}

/* Floating action buttons */
.floating-btn {
    position: fixed;
    right: 20px;
    background-color: #e8f4fd66;
    color: #666;
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 1.2em;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
    transition: background-color 0.3s, transform 0.2s;
    z-index: 1000;
    text-decoration: none;
}

.floating-btn:hover {
    background-color: #e8f4fdcc;
    transform: translateY(-2px);
}

.floating-btn:visited {
    color: #666;
}

/* Floating buttons positioning */
.scroll-top.floating-btn {
    bottom: 20px;
}

.toggle-details.floating-btn {
    bottom: 80px;
}

.filter-messages.floating-btn {
    bottom: 140px;
}

.timeline-toggle.floating-btn {
    bottom: 200px;
}
/* Message and content styles */
.message {
    margin-bottom: 1em;
    margin-left: 1em;
    padding: 1em;
    border-radius: 8px;
    border-left: var(--white-dimmed) 2px solid;
    background-color: var(--highlight-light);
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-top: var(--white-dimmed) 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

/* Message header info styling */
.header-info {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 2px;
}

.timestamp-row {
    display: flex;
    flex-direction: row;
    align-items: normal;
    gap: 8px;
}

.pair-duration {
    font-size: 80%;
    color: #666;
    font-style: italic;
}

.token-usage {
    font-size: 0.75em;
    color: #888;
}

/* Paired message styling */
.message.paired-message {
    margin-bottom: 0;
}

.message.paired-message.pair_first {
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
    border-bottom: none;
}

.message.paired-message.pair_last {
    margin-top: 0;
    margin-bottom: 1em;
    border-top-left-radius: 0;
    border-top-right-radius: 0;
    border-top: 1px solid #00000011;
}

.message.paired-message.pair_middle {
    margin-top: 0;
    border-radius: 0;
    border-top: 1px solid #00000011;
    border-bottom: none;
}

.session-divider {
    margin: 70px 0;
    border-top: 2px solid #fff;
}

/* Message type styling */
.user {
    border-left-color: #ff9800;
    margin-left: 0;
}

.assistant {
    border-left-color: #9c27b0;
}

/* Dimmed assistant when paired with thinking */
.assistant.paired-message {
    border-left-color: var(--assistant-dimmed);
}

.system {
    border-left-color: #d98100;
    margin-left: 0;
}

.system-warning {
    border-left-color: #2196f3;
    background-color: var(--highlight-semi);
    margin-left: 2em; /* Extra indent - assistant-initiated */
}

.system-error {
    border-left-color: #f44336;
    background-color: var(--error-semi);
    margin-left: 0;
}

.system-info {
    border-left-color: var(--info-dimmed);
    background-color: var(--highlight-dimmed);
    margin-left: 2em; /* Extra indent - assistant-initiated */
    font-size: 80%;
}

/* Command output styling */
.command-output {
    background-color: #1e1e1e11;
    border-left-color: var(--warning-dimmed);
}

.command-output-content {
    background-color: #1e1e1e08;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #00000011;
    margin-top: 8px;
    font-family: var(--font-monospace);
    font-size: 0.9em;
    line-height: 1.4;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #333;
    overflow-x: auto;
}

/* Bash command styling */
.bash-input {
    background-color: #1e1e1e08;
    border-left-color: #4caf50;
}

.bash-prompt {
    color: #4caf50;
    font-weight: bold;
    font-size: 1.1em;
    margin-right: 8px;
}

.bash-command {
    font-family: var(--font-monospace);
    font-size: 0.95em;
    color: #2c3e50;
    background-color: #f8f9fa;
    padding: 2px 6px;
    border-radius: 3px;
}

/* Bash output styling */
.bash-output {
    background-color: var(--neutral-dimmed);
    border-left-color: #607d8b;
}

.bash-stdout {
    background-color: #1e1e1e05;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #00000011;
    margin: 8px 0;
    font-family: var(--font-monospace);
    font-size: 0.9em;
    line-height: 1.4;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #333;
    overflow-x: auto;
}

.bash-stderr {
    background-color: #ffebee;
    padding: 12px;
    border-radius: 4px;
    border: 1px solid #ffcdd2;
    margin: 8px 0;
    font-family: var(--font-monospace);
    font-size: 0.9em;
    line-height: 1.4;
    white-space: pre-wrap;
    word-wrap: break-word;
    color: #c62828;
    overflow-x: auto;
}

.bash-empty {
    color: #999;
    font-style: italic;
}

/* Bash tool content styling (Tool Use message) */
.bash-tool-content {
    margin: 8px 0;
}

.bash-tool-description {
    color: var(--text-muted);
    font-size: 0.95em;
    margin-bottom: 8px;
    line-height: 1.4;
}

.content pre.bash-tool-command {
    background-color: var(--code-bg-color);
    padding: 8px 12px;
    border-radius: 4px;
    border: 1px solid var(--tool-param-sep-color);
    font-family: var(--font-monospace);
    font-size: 0.9em;
    color: #2c3e50;
    margin: 0;
    overflow-x: auto;
}

.tool_use {
    border-left-color: #4caf50;
    margin-left: 2em; /* Extra indent - assistant-initiated */
}

.tool_result {
    border-left-color: var(--success-dimmed);
    margin-left: 2em; /* Extra indent - assistant-initiated */
}

.tool_result.error {
    border-left-color: var(--error-dimmed);
    background-color: var(--error-semi);
}

.message.tool_use pre, .message.tool_result pre {
    font-size: 80%;
}

/* Sidechain message styling */
.sidechain {
    opacity: 0.85;
    background-color: var(--neutral-semi);
    border-left-width: 2px;
    border-left-style: dashed;
}

/* Sidechain indentation hierarchy */
.sidechain.user {
    margin-left: 3em; /* Sub-assistant Prompt - nested below Task tool use (2em) */
}

.sidechain.assistant {
    margin-left: 4em; /* Sub-assistant - nested below prompt (3em) */
}

.sidechain.tool_use,
.sidechain.tool_result {
    margin-left: 5em; /* Sub-assistant tools - nested below assistant (4em) */
}

.sidechain .sidechain-indicator {
    color: var(--text-muted);
    font-size: 0.9em;
    margin-bottom: 5px;
    padding: 2px 6px;
    background-color: #e9ecef88;
    border-radius: 3px;
    display: inline-block;
}

.thinking {
    border-left-color: var(--assistant-dimmed);
}

/* Full purple when thinking is paired (as pair_first) */
.thinking.paired-message.pair_first {
    border-left-color: #9c27b0;
}

.image {
    border-left-color: #d48a5e;
    margin-left: 0; /* Align with user messages */
}

/* Session header styling */
.session-header {
    background-color: var(--session-bg-dimmed);
    border-radius: 8px;
    padding: 16px;
    margin: 30px 0 20px 0;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: var(--white-dimmed) 1px solid;
    border-top: var(--white-dimmed) 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

.session-header .header {
    margin-bottom: 8px;
    font-size: 1.2em;
}

/* IDE notification styling */
.ide-notification {
    background-color: var(--ide-notification-dimmed);
    border-left: #9c27b0 2px solid;
    padding: 8px 12px;
    margin: 8px 0;
    border-radius: 4px;
    font-size: 80%;
    font-style: italic;
}

/* IDE selection styling */
.ide-selection-collapsible {
    margin-top: 4px;
}

.ide-selection-collapsible summary {
    cursor: pointer;
    color: var(--text-muted);
    user-select: none;
}

.ide-selection-collapsible summary:hover {
    color: #333;
}

.ide-selection-content {
    margin-top: 8px;
    padding: 8px;
    background-color: #f8f9fa;
    border-radius: 3px;
    border: 1px solid #dee2e6;
    font-family: var(--font-monospace);
    font-size: 0.85em;
    line-height: 1.4;
    white-space: pre-wrap;
    overflow-x: auto;
}

/* Content styling */
.content {
    word-wrap: break-word;
}

.content>pre {
    background-color: transparent;
    padding: 0;
    border-radius: 0;
}

.header:has(+ .content > details) {
    margin-left: 1em;
}

/* Assistant and Thinking content styling */
.assistant .content,
.thinking-text,
.user.compacted .content {
    font-family: var(--font-ui);
}

/* Code block styling */
pre > code {
    display: block;
}

/* Tool content styling */
.tool-content {
    background-color: var(--neutral-dimmed);
    border-radius: 4px;
    padding: 8px;
    margin: 8px 0;
    overflow-x: auto;
    box-shadow: -4px -4px 10px #eeeeee33, 4px 4px 10px #00000007;
    border-left: var(--white-dimmed) 1px solid;
    border-top: var(--white-dimmed) 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

/* Tool parameter table styling */
.tool-params-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 80%;
}

.tool-params-table tr {
    border-bottom: 1px solid var(--tool-param-sep-color);
}

.tool-param-key {
    padding: 4px;
    font-weight: 600;
    color: var(--text-secondary);
    vertical-align: top;
    width: 8em;
}

.tool-param-value {
    padding: 4px;
    color: #212529;
    vertical-align: top;
}

.tool-param-structured {
    margin: 0;
    background-color: #f8f9fa;
    padding: 4px;
    border-radius: 3px;
}

.tool-param-collapsible {
    margin: 0;
}

.tool-param-collapsible summary {
    cursor: pointer;
    color: var(--text-muted);
}

.tool-param-collapsible summary:hover {
    color: #333;
}

.tool-param-full {
    margin-top: 4px;
    word-break: break-all;
}

.tool-params-empty {
    color: #999;
    font-style: italic;
}

.tool-result {
    background-color: var(--tool-result-dimmed);
    border-left: #4caf5088 1px solid;
}

.tool-use {
    background-color: var(--highlight-dimmed);
    border-left: #2196f388 1px solid;
}

.thinking-content {
    background-color: var(--thinking-dimmed);
    border-left: #66666688 1px solid;
}

.thinking-text {
    font-family: var(--font-ui);
    font-size: 90%;
    word-wrap: break-word;
    color: #555;
}

.tool-input {
    background-color: var(--tool-input-dimmed);
    border-radius: 4px;
    padding: 6px;
    margin: 4px 0;
    font-size: 0.9em;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: var(--white-dimmed) 1px solid;
    border-top: var(--white-dimmed) 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

/* Session summary styling */
.session-summary {
    background-color: var(--white-dimmed);
    border-left: #4caf5088 4px solid;
    padding: 12px;
    margin: 8px 0;
    border-radius: 0 4px 4px 0;
    font-style: italic;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-top: var(--white-dimmed) 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

/* Collapsible details styling */
details summary {
    cursor: pointer;
    color: var(--text-muted);
}

.collapsible-details {
    margin-top: -2em;
}

.collapsible-details summary {
    position: relative;
    cursor: pointer;
}

/* Collapsible code blocks (Read/Edit/Write tools) */
.tool_result .collapsible-code {
    margin-top: -2.5em;
}

.tool_result .collapsible-code summary {
    cursor: pointer;
    padding-top: 0.5em;
    background: var(--color-bg-secondary);
    border-radius: 4px;
}

.tool_result .collapsible-code summary:hover {
    background: var(--color-bg-tertiary);
}

/* Preview content styling - shown when closed */
.collapsible-details:not([open]) .preview-content {
    margin-top: 4px;
}

/* Tool result preview content with gradient fade */
.tool_result .preview-content {
    opacity: 0.7;
    mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
    -webkit-mask-image: linear-gradient(to bottom, black 80%, transparent 100%);
}

/* Hide preview content when details/collapsible is open */
.collapsible-details[open] .preview-content,
.collapsible-code[open] .preview-content {
    display: none;
}

/* Style the full details content */
.details-content {
    margin-top: 4px;
}

/* Hide details content when closed */
.collapsible-details:not([open]) .details-content {
    display: none;
}

/* Style pre and other elements within details content */
.content pre {
    background-color: transparent;
    padding: 0;
    margin: 0;
    color: #555;
    line-height: 1.3;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/* Message filtering */
.message.filtered-hidden {
    display: none;
}

/* ANSI color classes */
/* Standard colors */
.ansi-black { color: #000000; }
.ansi-red { color: #cd3131; }
.ansi-green { color: #0dbc79; }
.ansi-yellow { color: #e5e510; }
.ansi-blue { color: #2472c8; }
.ansi-magenta { color: #bc3fbc; }
.ansi-cyan { color: #11a8cd; }
.ansi-white { color: #e5e5e5; }

/* Bright colors */
.ansi-bright-black { color: #666666; }
.ansi-bright-red { color: #f14c4c; }
.ansi-bright-green { color: #23d18b; }
.ansi-bright-yellow { color: #f5f543; }
.ansi-bright-blue { color: #3b8eea; }
.ansi-bright-magenta { color: #d670d6; }
.ansi-bright-cyan { color: #29b8db; }
.ansi-bright-white { color: #ffffff; }

/* Background colors */
.ansi-bg-black { background-color: #000000; }
.ansi-bg-red { background-color: #cd3131; }
.ansi-bg-green { background-color: #0dbc79; }
.ansi-bg-yellow { background-color: #e5e510; }
.ansi-bg-blue { background-color: #2472c8; }
.ansi-bg-magenta { background-color: #bc3fbc; }
.ansi-bg-cyan { background-color: #11a8cd; }
.ansi-bg-white { background-color: #e5e5e5; }

/* Bright background colors */
.ansi-bg-bright-black { background-color: #666666; }
.ansi-bg-bright-red { background-color: #f14c4c; }
.ansi-bg-bright-green { background-color: #23d18b; }
.ansi-bg-bright-yellow { background-color: #f5f543; }
.ansi-bg-bright-blue { background-color: #3b8eea; }
.ansi-bg-bright-magenta { background-color: #d670d6; }
.ansi-bg-bright-cyan { background-color: #29b8db; }
.ansi-bg-bright-white { background-color: #ffffff; }

/* Text styles */
.ansi-bold { font-weight: bold; }
.ansi-dim { opacity: 0.7; }
.ansi-italic { font-style: italic; }
.ansi-underline { text-decoration: underline; }
/* Session navigation styles */
.navigation {
    background-color: #f8f9fa66;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 24px;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: #ffffff66 1px solid;
    border-top: #ffffff66 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

.navigation h2 {
    margin: 0 0 12px 0;
    font-size: 1.2em;
    color: #495057;
}

.session-nav {
    margin-top: 1em;
    display: grid;
    gap: 8px;
}

.session-link {
    padding: 8px 12px;
    background-color: #ffffff66;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    text-decoration: none;
    color: #495057;
    transition: background-color 0.2s;
}

.session-link:hover {
    background-color: #ffffff99;
}

.session-link-title {
    font-weight: 600;
    font-size: 0.9em;
}

.session-link-meta {
    font-size: 0.8em;
    color: #6c757d;
    margin-top: 2px;
}

/* Project-specific session navigation */
.project-sessions {
    margin-top: 15px;
    border-top: 1px solid #dee2e6;
    padding-top: 15px;
}

.project-sessions h4 {
    margin: 0 0 10px 0;
    font-size: 0.9em;
    color: #495057;
    font-weight: 600;
}

.project-sessions .session-link {
    padding: 6px 8px;
    font-size: 0.8em;
    margin-bottom: 4px;
}

.project-sessions .session-link-title {
    font-size: 0.85em;
}

.project-sessions .session-link-meta {
    font-size: 0.75em;
}

/* Combined transcript link */
.combined-transcript-link {
    display: inline-block;
    padding: 8px 12px;
    background-color: #ffffff66;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    text-decoration: none;
    color: #495057;
    font-weight: 500;
    transition: background-color 0.2s;
}

.combined-transcript-link:hover {
    background-color: #ffffff99;
    text-decoration: none;
}
/* Filter toolbar and controls */
.filter-toolbar {
    background-color: #f8f9fa66;
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 16px;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: #ffffff66 1px solid;
    border-top: #ffffff66 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
    display: none;
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(8px);
}

.filter-toolbar.visible {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.toolbar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    padding-bottom: 8px;
    border-bottom: 1px solid #dee2e633;
    gap: 16px;
}

.toolbar-header h3 {
    margin: 0;
    font-size: 1em;
    color: #495057;
    font-weight: 600;
}

.close-toolbar-btn {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 20px;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.2s;
    line-height: 1;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.close-toolbar-btn:hover {
    background-color: #ffffff66;
    color: #333;
}

.filter-section {
    margin-top: 16px;
    padding-top: 16px;
    border-top: 1px solid #dee2e633;
}


.filter-toggles {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 8px;
    margin-bottom: 12px;
}


.filter-toggle {
    padding: 6px 12px;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    background-color: transparent;
    color: #495057;
    font-size: 0.85em;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
}

.filter-toggle:hover {
    background-color: #ffffff99;
    transform: translateY(-1px);
}

.filter-toggle.active {
    background-color: #ffffffaa;
}

.filter-toggle.active:hover {
    background-color: #ffffff66;
}

/* Color-coded filter buttons */
.filter-toggle[data-type="user"] {
    border-color: #ff9800;
    border-width: 2px;
}

.filter-toggle[data-type="system"] {
    border-color: #d98100;
    border-width: 2px;
}

.filter-toggle[data-type="tool"] {
    border-color: #4caf50;
    border-width: 2px;
}

.filter-toggle[data-type="assistant"] {
    border-color: #9c27b0;
    border-width: 2px;
}

.filter-toggle[data-type="thinking"] {
    border-color: #9c27b066;
    border-width: 2px;
}

.filter-actions {
    display: flex;
    gap: 6px;
}

.filter-action-btn {
    padding: 4px 8px;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    background-color: #ffffff66;
    color: #6c757d;
    font-size: 0.75em;
    cursor: pointer;
    transition: background-color 0.2s;
}

.filter-action-btn:hover {
    background-color: #ffffff99;
}

.filter-toggle .count {
    opacity: 0.7;
    font-size: 0.9em;
    margin-left: 2px;
}

.filter-toggle.active .count {
    opacity: 1;
}

.filter-messages.active {
    background-color: #fff3cd;
}
/* TodoWrite tool styling */
.todo-write {
    background-color: #f0f8ff66;
    border-left: #4169e188 3px solid;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
}

.tool-header {
    font-weight: 600;
    margin-bottom: 12px;
    color: #2c3e50;
    font-size: 1.1em;
}

.todo-list {
    background-color: #ffffff66;
    border-radius: 6px;
    padding: 8px;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: #ffffff66 1px solid;
    border-top: #ffffff66 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
}

.todo-item {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 4px;
    border-bottom: 1px solid #f0f3f6;
    transition: background-color 0.2s ease;
}

.todo-item:last-child {
    border-bottom: none;
}

.todo-item:hover {
    background-color: #f8f9fa;
}

.todo-item.completed {
    opacity: 0.7;
}

.todo-item.completed .todo-content {
    text-decoration: line-through;
    color: #6c757d;
}

.todo-item input[type="checkbox"] {
    margin: 0;
    cursor: default;
}

.todo-status {
    font-size: 1.1em;
    line-height: 1;
}

.todo-content {
    flex: 1;
    color: #333;
    font-weight: 500;
    font-size: 90%;
    font-family: var(--font-ui);
}

.todo-id {
    font-size: 0.8em;
    color: #6c757d;
    font-weight: normal;
}

/* Priority-based left border colors */
.todo-item.high {
    border-left: 3px solid #dc3545;
}

.todo-item.medium {
    border-left: 3px solid #ffc107;
}

.todo-item.low {
    border-left: 3px solid #28a745;
}

/* Status-based background tints */
.todo-item.in_progress {
    background-color: #fff3cd;
}

.todo-item.completed {
    background-color: #d4edda;
}
/* Timeline-specific styles for vis-timeline */

/* Timeline toggle button styling */
.timeline-toggle.active {
    background-color: #fff3cd;
}

/* Timeline container positioning and styling */
#timeline-container {
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    transition: top 0.3s ease;
    position: relative;
}

/* Timeline resize handle styling */
#timeline-resize-handle {
    transition: background 0.2s ease;
}

#timeline-resize-handle:hover {
    background: linear-gradient(to bottom, transparent, #bbb) !important;
}

#timeline-resize-handle:hover>div {
    background: #777 !important;
}

#timeline-resize-handle:active {
    background: linear-gradient(to bottom, transparent, #999) !important;
}

#timeline-resize-handle:active>div {
    background: #555 !important;
}

/* vis-timeline customizations */
.vis-timeline {
    border: none !important;
}

.vis-labelset .vis-label {
    font-size: 12px !important;
    font-weight: 500 !important;
    color: #495057 !important;
}

/* Timeline items styling */
.vis-item {
    border-radius: 4px !important;
    border: 1px solid #ddd !important;
    font-size: 11px !important;
    /* Stuck item workaround, see: https://github.com/visjs/vis-timeline/issues/494#issuecomment-1638974075 */
    transform: scale(0);
}

.vis-item .vis-item-content {
    padding: 2px 4px !important;
}

.vis-item.vis-selected {
    border-color: #007bff !important;
    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25) !important;
}

/* Message type specific styling */
.vis-item.timeline-item-user {
    background-color: #e3f2fd !important;
    border-color: #2196f3 !important;
}

.vis-item.timeline-item-assistant {
    background-color: #f3e5f5 !important;
    border-color: #9c27b0 !important;
}

.vis-item.timeline-item-tool_use {
    background-color: #fff8e1 !important;
    border-color: #ffc107 !important;
}

.vis-item.timeline-item-tool_result {
    background-color: #e8f5e8 !important;
    border-color: #4caf50 !important;
}

.vis-item.timeline-item-thinking {
    background-color: #fce4ec !important;
    border-color: #e91e63 !important;
}

.vis-item.timeline-item-system {
    background-color: #ffeee1 !important;
    border-color: #ff8707 !important;
}

.vis-item.timeline-item-image {
    background-color: #e1f5fe !important;
    border-color: #00bcd4 !important;
}

.vis-item.timeline-item-sidechain {
    background-color: #f5f5f5 !important;
    border-color: #9e9e9e !important;
}

/* Hide filtered timeline items */
.vis-item.timeline-filtered-hidden {
    display: none !important;
}

/* Timeline axis styling */
.vis-time-axis {
    border-top: 1px solid #ddd !important;
}

.vis-time-axis .vis-text {
    font-size: 11px !important;
    color: #666 !important;
}

/* Timeline navigation controls */
.vis-navigation {
    font-size: 12px !important;
}

/* Hide vis-timeline watermark if present */
.vis-timeline .vis-custom-time {
    display: none !important;
}

.vis-tooltip {
    max-width: 700px;
    padding: 1em !important;
    white-space: normal !important;
    font-family: inherit !important;
}

.vis-tooltip pre {
    margin: 0;
    padding: 0;
    background-color: transparent;
}

.vis-tooltip img {
    max-width: 700px;
}

.vis-tooltip div {
    white-space: normal;
}
/* Search Bar Styles */
.search-container {
    position: relative;
    width: 100%;
}

/* Keyboard shortcut hint */
.search-hint {
    position: absolute;
    right: 45px;
    top: 50%;
    transform: translateY(-50%);
    color: #999;
    font-size: 0.75em;
    pointer-events: none;
    transition: opacity 0.2s;
}

.search-hint.hidden {
    opacity: 0;
    visibility: hidden;
}

/* Inline Search for Filter Toolbar */
.search-inline {
    width: 100%;
    margin-bottom: 12px;
}

/* In filter toolbar mode, search is always visible when toolbar is visible */
.filter-toolbar:not(.visible) .search-container {
    display: none;
}

.search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: 10px;
}

.search-input {
    width: 100%;
    padding: 8px 40px 8px 12px;
    background: #ffffff88;
    border: 1px solid #dee2e6;
    border-radius: 20px;
    color: #495057;
    font-size: 0.85em;
    font-family: inherit;
    transition: all 0.2s;
}

.search-input:focus {
    outline: none;
    border-color: #2196f3;
    background: #ffffff99;
    box-shadow: 0 0 0 2px rgba(33, 150, 243, 0.2);
}

.search-input::placeholder {
    color: #666;
}

.search-clear {
    position: absolute;
    right: 15px;
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 18px;
    padding: 5px;
    display: none;
    border-radius: 50%;
    transition: all 0.2s;
}

.search-clear:hover {
    color: #333;
    background: #ffffff66;
}

.search-clear.visible {
    display: block;
}

/* Search Results Counter */
.search-results-info {
    margin-top: 8px;
    font-size: 12px;
    color: #666;
    display: none;
}

.search-results-info.visible {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 12px;
}

.search-navigation {
    display: flex;
    gap: 5px;
    align-items: center;
}

.search-options-inline {
    display: flex;
    gap: 12px;
    font-size: 0.75em;
}

.search-option-inline {
    display: flex;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    color: #666;
}

.search-option-inline:hover {
    color: #333;
}

.search-option-inline input[type="checkbox"] {
    cursor: pointer;
    margin: 0;
}

.search-nav-btn {
    background: #ffffff88;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    color: #333;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 12px;
    transition: all 0.2s;
}

.search-nav-btn:hover:not(:disabled) {
    background: #ffffff99;
    border-color: #2196f3;
    transform: translateY(-1px);
}

.search-nav-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Search Match Highlighting */
.search-highlight {
    background-color: #ffeb3b;
    color: #000;
    padding: 0 2px;
    border-radius: 2px;
}

.search-highlight.current {
    background-color: #ff9800;
    color: #000;
}

/* Search Options */
.search-options {
    margin-top: 8px;
    display: flex;
    gap: 12px;
    font-size: 0.75em;
}

.search-option {
    display: flex;
    align-items: center;
    gap: 5px;
    color: #666;
    transition: color 0.2s;
}

.search-option input[type="checkbox"] {
    cursor: pointer;
    accent-color: #2196f3;
}

.search-option label {
    cursor: pointer;
    user-select: none;
}

.search-option:hover {
    color: #333;
}

/* Index Page Search Results */
.search-results-panel {
    margin: 20px 0;
    padding: 20px;
    background-color: #ffffff66;
    border-radius: 8px;
    box-shadow: -7px -7px 10px #eeeeee44, 7px 7px 10px #00000011;
    border-left: #ffffff66 1px solid;
    border-top: #ffffff66 1px solid;
    border-bottom: #00000017 1px solid;
    border-right: #00000017 1px solid;
    display: none;
}

.search-results-panel.visible {
    display: block;
}

.search-results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #dee2e6;
}

.search-results-title {
    font-size: 16px;
    font-weight: 600;
    color: #2c3e50;
}

.search-close-btn {
    background: none;
    border: none;
    color: #666;
    cursor: pointer;
    font-size: 20px;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.2s;
}

.search-close-btn:hover {
    color: #333;
    background: #ffffff66;
}

.search-result-group {
    margin-bottom: 20px;
}

.search-result-group-title {
    font-size: 14px;
    font-weight: 600;
    color: #2196f3;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.search-result-count {
    background: #ffffff88;
    color: #666;
    padding: 2px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: normal;
    border: 1px solid #dee2e6;
}

.search-result-item {
    padding: 12px;
    margin-bottom: 8px;
    background-color: #ffffff88;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: -3px -3px 5px #eeeeee22, 3px 3px 5px #00000008;
    border-left: #ffffff44 1px solid;
    border-top: #ffffff44 1px solid;
    border-bottom: #00000012 1px solid;
    border-right: #00000012 1px solid;
}

.search-result-item:hover {
    background-color: #ffffff99;
    transform: translateY(-1px);
    box-shadow: -5px -5px 8px #eeeeee33, 5px 5px 8px #00000012;
}

.search-result-item a {
    text-decoration: none;
    color: inherit;
    display: block;
}

.search-result-session {
    font-size: 12px;
    color: #666;
    margin-bottom: 5px;
    font-weight: 500;
}

.search-result-excerpt {
    font-size: 13px;
    color: #495057;
    line-height: 1.4;
}

.search-result-excerpt .search-highlight {
    font-weight: 600;
    background-color: #ffeb3b;
    color: #000;
    padding: 0 2px;
    border-radius: 2px;
}

.search-result-meta {
    margin-top: 8px;
    font-size: 11px;
    color: #666;
    display: flex;
    gap: 15px;
    padding-top: 5px;
    border-top: 1px solid #dee2e611;
}

/* Removed floating search button - now integrated in filter toolbar */

/* No results message */
.search-no-results {
    text-align: center;
    padding: 30px;
    color: #666;
    font-size: 14px;
    background-color: #ffffff44;
    border-radius: 6px;
    margin: 10px 0;
}

/* Loading indicator */
.search-loading {
    text-align: center;
    padding: 20px;
    color: #666;
    background-color: #ffffff44;
    border-radius: 6px;
}

.search-loading::after {
    content: '...';
    animation: dots 1.5s infinite;
}

@keyframes dots {
    0%, 20% { content: '.'; }
    40% { content: '..'; }
    60%, 100% { content: '...'; }
}

/* Keyboard shortcut hint */

/* Responsive adjustments */
@media (max-width: 768px) {
    .search-input {
        font-size: 0.8em;
    }

    .search-options {
        font-size: 0.7em;
    }
}
/* Edit tool diff styling */
.edit-tool-content {
    margin: 8px 0;
}

.edit-file-path {
    font-weight: 600;
    color: var(--text-secondary);
    margin-bottom: 8px;
    font-size: 0.95em;
}

.edit-replace-all {
    color: var(--text-muted);
    font-size: 0.85em;
    font-style: italic;
    margin-bottom: 8px;
}

.edit-diff {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    overflow-x: auto;
    font-family: var(--font-monospace);
    font-size: 80%;
    line-height: 2ex;
}

/* Diff line styling */
.diff-line {
    padding: 2px 4px 2px 2px;
    white-space: pre-wrap;
    word-wrap: break-word;
}

.diff-marker {
    display: inline-block;
    width: 1.5em;
    text-align: center;
    user-select: none;
    color: var(--text-muted);
}

/* Line backgrounds */
.diff-removed {
    background-color: #ffebe9;
    border-left: 3px solid #f85149;
}

.diff-added {
    background-color: #dafbe1;
    border-left: 3px solid #3fb950;
}

.diff-context {
    background-color: var(--code-bg-color);
    border-left: 3px solid transparent;
}

/* Character-level highlighting */
.diff-char-removed {
    background-color: #ffcecb;
    border-radius: 2px;
}

.diff-char-added {
    background-color: #abf2bc;
    border-radius: 2px;
}

/* Remove default mark styling */
mark.diff-char-removed,
mark.diff-char-added {
    color: inherit;
}
/* Pygments syntax highlighting styles */

/* Base styles for highlighted code blocks */
.highlight {
    background: var(--color-bg-secondary);
    border-radius: 4px;
    overflow-x: auto;
}

.highlight pre {
    margin: 0;
    padding: 0.5em;
    line-height: 1.5;
    font-family: var(--font-monospace);
    white-space: pre;  /* Prevent line wrapping */
}

/* Smaller font for code blocks in markdown content (assistant messages, thinking, etc.) */
.content.markdown .highlight pre code {
    font-size: 80%;
}

/* Line numbers table styling */
.highlight .highlighttable {
    width: 100%;
    border-spacing: 0;
    background: transparent;
}

.highlight .highlighttable td {
    padding: 0;
    vertical-align: top;
}

.highlight .highlighttable td.linenos {
    width: 1%;
    text-align: right;
    user-select: none;
    border-right: 1px solid var(--color-border-dim);
}

.highlight .linenos pre {
    color: var(--color-text-dim);
    background: var(--color-bg-tertiary);
    padding: 0.65em 0.5em 0.5em 0.8em;
    margin: 0;
    line-height: 1.5;
    white-space: pre;
}

.highlight .linenos .normal {
    color: inherit;
}

.highlight td.code {
    width: 99%;
}

.highlight td.code pre {
    padding-left: 0.8em;
    line-height: 1.5;
}

/* Read tool specific styles */
.read-tool-content {
    font-weight: 600;
    color: var(--color-blue);
    margin: 0.5em 0;
    font-family: var(--font-monospace);
    font-size: 0.9em;
}

.read-tool-result {
    margin: 0.5em 0;
}

/* Unified styling for inline preview text in tool results */
.tool-result .line-count,
.tool-result .preview-text {
    font-size: 0.9em;
    color: var(--color-text-secondary);
    margin-left: 0.5em;
}

.read-tool-result .system-reminder {
    margin-top: 0.5em;
    padding: 0.5em;
    background: var(--color-bg-secondary);
    border-left: 3px solid var(--color-blue);
    border-radius: 4px;
    font-style: italic;
    font-size: 80%;
    color: var(--color-text-secondary);
}

/* Edit tool result specific styles */
.edit-tool-result {
    margin: 0.5em 0;
}

/* Multiedit tool specific styles */
.multiedit-tool-content {
    margin: 0.5em 0;
}

.multiedit-file-path {
    font-weight: 600;
    color: var(--color-purple);
    margin-bottom: 0.5em;
    font-family: var(--font-monospace);
    font-size: 0.9em;
}

.multiedit-count {
    font-size: 0.85em;
    color: var(--color-text-secondary);
    margin-bottom: 0.8em;
}

.multiedit-item {
    margin-bottom: 1em;
    border-left: 2px solid var(--color-border-dim);
    padding-left: 1em;
}

.multiedit-item-header {
    font-weight: 600;
    color: var(--color-text-secondary);
    margin-bottom: 0.5em;
    font-size: 0.9em;
}

/* Write tool specific styles */
.write-tool-content {
    margin: 0.5em 0;
}

.write-file-path {
    font-weight: 600;
    color: var(--color-green);
    margin-bottom: 0.5em;
    font-family: var(--font-monospace);
    font-size: 0.9em;
    padding-left: 1.5em;
}


/* Pygments token styles (based on 'default' theme) */
.highlight { background: var(--color-bg-secondary); }
.highlight .hll { background-color: #ffffcc }
.highlight .c { color: #3D7B7B; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #9C6500 } /* Comment.Preproc */
.highlight .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.highlight .gr { color: #E40000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #008400 } /* Generic.Inserted */
.highlight .go { color: #717171 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #687822 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #717171; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #767600 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #A45A77 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>

<body>
    <h1 id="title">Claude Transcripts - claude-hooks</h1>

    <!-- Timeline Component -->
    <!-- Timeline Component Template -->
<!-- vis-timeline integration for transcript visualization -->

<div id="timeline-container"
    style="display: none; position: sticky; top: 0; z-index: 100; background: white; border-bottom: 1px solid #ddd; width: 100vw; margin-left: calc(-50vw + 50%); overflow: hidden; min-height: 150px; max-height: 80vh;">
    <div id="timeline-visualization" style="height: calc(100% - 8px); width: 100%;"></div>
    <div id="timeline-resize-handle"
        style="position: absolute; bottom: 0; left: 0; right: 0; height: 8px; background: linear-gradient(to bottom, transparent, #ddd); cursor: ns-resize; display: flex; align-items: center; justify-content: center;">
        <div style="width: 40px; height: 3px; background: #999; border-radius: 2px;"></div>
    </div>
</div>

<script id="timeline-script">
    // Timeline functionality - inline for self-contained HTML
    (function () {
        let timeline = null;
        let items = null;
        let groups = null;
        let isTimelineLoaded = false;
        let timelineIdToElement = new Map(); // Map timeline IDs to DOM elements
        let isResizing = false;

        // Message type to group mapping
        const messageTypeGroups = {
            'user': { id: 'user', content: 'ü§∑ User', style: 'background-color: #e3f2fd;' },
            'assistant': { id: 'assistant', content: 'ü§ñ Assistant', style: 'background-color: #f3e5f5;' },
            'tool_use': { id: 'tool_use', content: 'üõ†Ô∏è Tool Use', style: 'background-color: #fff3e0;' },
            'tool_result': { id: 'tool_result', content: 'üß∞ Tool Result', style: 'background-color: #e8f5e8;' },
            'thinking': { id: 'thinking', content: 'üí≠ Thinking', style: 'background-color: #fce4ec;' },
            'system': { id: 'system', content: '‚öôÔ∏è System', style: 'background-color: #ffeee1;' },
            'image': { id: 'image', content: 'üñºÔ∏è Image', style: 'background-color: #e1f5fe;' },
            'sidechain': { id: 'sidechain', content: 'üîó Sub-assistant', style: 'background-color: #f5f5f5;' }
        };

        // Build timeline data from messages
        function buildTimelineData() {
            let latestTimeString = '1970-01-01 00:00:00';
            const timelineItems = [];
            const timelineGroups = [];
            const usedGroups = new Set();

            // Clear existing mapping
            timelineIdToElement.clear();

            // Get all messages from the page (including filtered ones - we'll hide them with CSS)
            const messages = document.querySelectorAll('.message:not(.session-header)');

            messages.forEach((messageEl, index) => {
                // Extract message data - handle both simple and complex CSS classes
                const classList = Array.from(messageEl.classList);
                let messageType = 'system'; // Default fallback

                // Check for sidechain first (sub-assistant messages)
                if (classList.includes('sidechain')) {
                    messageType = 'sidechain';
                } else if (classList.includes('system-warning') || classList.includes('system-error') || classList.includes('system-info')) {
                    messageType = 'system';
                } else {
                    // Look for standard message types
                    messageType = classList.find(cls =>
                        ['user', 'assistant', 'tool_use', 'tool_result', 'thinking', 'system', 'image'].includes(cls)
                    ) ?? 'system';
                }

                const timestampEl = messageEl.querySelector('.timestamp');
                if (!timestampEl) return; // Skip if no timestamp

                // Use raw timestamp from data attribute if available, otherwise fall back to text content
                const rawTimestamp = timestampEl.getAttribute('data-timestamp');
                const timestamp = rawTimestamp ?? timestampEl.textContent.trim();
                if (timestamp > latestTimeString) latestTimeString = timestamp;

                // Get message content preview
                const contentEl = messageEl.querySelector('.content');
                let content = '';
                if (contentEl) {
                    let textContent = contentEl.textContent ?? contentEl.innerText ?? '';

                    // For system messages, try to extract just the message without the prefix
                    if (messageType === 'system') {
                        // System messages often have format like "‚ö†Ô∏è System Warning: message content"
                        const systemMatch = textContent.match(/^[‚ö†Ô∏è‚ùå‚ÑπÔ∏è]?\s*System\s+\w+:\s*(.+)$/);
                        if (systemMatch) {
                            textContent = systemMatch[1];
                        }
                    }

                    content = textContent.length > 100 ? textContent.substring(0, 100) + '...' : textContent;
                }

                // For tool_use messages, try to extract the tool name
                if (messageType === 'tool_use') {
                    // Try to extract tool name from JSON content
                    const nameMatch = content.match(/"name":\s*"([^"]+)"/);
                    if (nameMatch) {
                        const toolName = nameMatch[1];
                        content = toolName + ': ' + content.replace(/"name":\s*"[^"]+",?\s*/, '');
                    } else {
                        // Fallback: try to extract from header if available
                        const headerEl = messageEl.querySelector('.header span');
                        if (headerEl) {
                            const headerText = headerEl.textContent ?? '';
                            const toolMatch = headerText.match(/üõ†Ô∏è\s*(.+) \(Id:.*/);
                            if (toolMatch) {
                                content = toolMatch[1].replace("Tool Use: ", "") + (content ? ': ' + content : '');
                            }
                        }
                    }
                }

                // Add group if not already added
                if (!usedGroups.has(messageType)) {
                    timelineGroups.push(messageTypeGroups[messageType]);
                    usedGroups.add(messageType);
                }

                // Store mapping for click handling
                timelineIdToElement.set(index, messageEl);

                // Format tooltip content with proper containment and styling
                let title = contentEl.innerHTML;
                title = title.includes("<pre") ? title : `<pre>${title}</pre>`;

                // Clean up collapsible details for tooltip display
                if (title.includes("<details")) {
                    title = title.replace(/(<summary>.*<\/summary>)/gs, '').replace(/<details class="collapsible-details">(.*?)<\/details>/gs, (m, p) => p)
                }

                // Clean up excessive whitespace in pre tags
                title = title.replace(/<pre([^>]*)>[\s\r\n]+(.*?)[\s\r\n]+<\/pre>/gs, (m, attrs, content) => `<pre${attrs}>${content}</pre>`)

                // Adjust content display based on message type
                let displayContent = content ?? messageTypeGroups[messageType].content;

                // Check for sidechain context regardless of primary message type
                if (classList.includes('sidechain')) {
                    // Override group for sidechain messages, but preserve the content
                    messageType = 'sidechain';

                    // For sidechain messages, prefix with appropriate icon based on original type
                    if (classList.includes('user')) {
                        displayContent = 'üìù ' + (content ?? 'Sub-assistant prompt');
                    } else if (classList.includes('assistant')) {
                        displayContent = 'üîó ' + (content ?? 'Sub-assistant response');
                    } else if (classList.includes('tool_use')) {
                        displayContent = 'üîó ' + (content ?? 'Sub-assistant tool use');
                    } else if (classList.includes('tool_result')) {
                        displayContent = 'üîó ' + (content ?? 'Sub-assistant tool result');
                    } else {
                        displayContent = 'üîó ' + (content ?? 'Sub-assistant');
                    }
                }

                // Create timeline item
                const timelineItem = {
                    id: index,
                    content: displayContent,
                    start: timestamp,
                    group: messageType,
                    title,
                    className: `timeline-item-${messageType}`
                };

                timelineItems.push(timelineItem);
            });

            // Set timeline window to show last hour by default, with padding after the last message
            const timelineEnd = new Date(new Date(latestTimeString).getTime() + 60 * 60 * 1000); // 1 hour after latest
            const timelineStart = new Date(timelineEnd.getTime() - 2 * 60 * 60 * 1000); // 2 hours total window (1 hour before latest + 1 hour after)

            return { timelineItems, timelineGroups, timelineEnd, timelineStart };
        }

        // Filter timeline items based on current message filters
        function applyFilters() {
            if (!timeline || !groups) return;

            // Get active filter types from filter toggles
            const activeTypes = Array.from(document.querySelectorAll('.filter-toggle.active'))
                .map(toggle => toggle.dataset.type);

            // Update groups visibility based on filter states
            const updatedGroups = groups.map(group => ({
                ...group,
                visible: activeTypes.includes(group.id)
            }));

            // Update timeline groups
            timeline.setGroups(updatedGroups);
        }

        // Handle timeline item click - scroll to corresponding message
        function onTimelineSelect(event) {
            const selection = timeline.getSelection();
            if (selection.length > 0) {
                const itemId = selection[0];
                const messageEl = timelineIdToElement.get(itemId);
                if (messageEl) {
                    // Calculate timeline height for proper scroll positioning
                    const timelineContainer = document.getElementById('timeline-container');
                    const timelineHeight = timelineContainer ? timelineContainer.offsetHeight : 0;

                    // Scroll so message top aligns with timeline bottom
                    const elementTop = messageEl.offsetTop;
                    const scrollPosition = elementTop - timelineHeight - 10; // 10px padding

                    window.scrollTo({
                        top: Math.max(0, scrollPosition),
                        behavior: 'smooth'
                    });

                    // Highlight the message briefly
                    messageEl.style.backgroundColor = '#fff3cd';
                    setTimeout(() => {
                        messageEl.style.backgroundColor = '';
                    }, 2000);
                }
            }
        }

        // Initialize timeline
        function initTimeline() {
            if (timeline) return; // Already initialized

            console.log('Initializing vis-timeline...');

            const container = document.getElementById('timeline-visualization');
            if (!container) {
                console.error('Timeline container not found');
                return;
            }

            // Build timeline data
            const { timelineItems, timelineGroups, timelineEnd, timelineStart } = buildTimelineData();
            items = timelineItems
            groups = timelineGroups
            if (items.length === 0) {
                console.warn('No timeline items found');
                return;
            }

            // Timeline options
            const options = {
                height: '100%',
                stack: true,
                showCurrentTime: true,
                zoomMin: 1000 * 1, // 1 second
                zoomMax: 1000 * 60 * 60 * 24 * 30, // 30 days
                start: timelineStart,
                end: timelineEnd,
                orientation: 'top',
                align: 'left',
                tooltip: {
                    // FIXME: This followMouse doesn't work for some reason and the tooltip box gets cut off for the bottom timeline boxes
                    followMouse: true,
                    overflowMethod: 'cap'
                },
                margin: {
                    item: 2,
                    axis: 2
                },
                groupOrder: (a, b) => {
                    const order = ['user', 'assistant', 'sidechain', 'tool_use', 'tool_result', 'thinking', 'system', 'image'];
                    return order.indexOf(a.id) - order.indexOf(b.id);
                }
            };

            // Create timeline
            timeline = new vis.Timeline(container, new vis.DataSet(items), new vis.DataSet(groups), options);

            // Make timeline available globally for debugging
            window.timeline = timeline;

            // Add event listeners
            timeline.on('select', onTimelineSelect);

            // Apply current filters
            applyFilters();

            console.log('Timeline initialized with', items.length, 'items and', groups.length, 'groups');
        }

        // Load vis-timeline library dynamically
        function loadVisTimeline() {
            return new Promise((resolve, reject) => {
                if (window.vis && window.vis.Timeline) {
                    resolve();
                    return;
                }

                console.log('Loading vis-timeline from CDN...');

                // Load CSS first
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'https://unpkg.com/vis-timeline/styles/vis-timeline-graph2d.min.css';
                document.head.appendChild(link);

                // Load JavaScript
                const script = document.createElement('script');
                script.src = 'https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js';
                script.onload = () => {
                    console.log('vis-timeline loaded successfully');
                    isTimelineLoaded = true;
                    resolve();
                };
                script.onerror = () => {
                    console.error('Failed to load vis-timeline');
                    reject(new Error('Failed to load vis-timeline'));
                };
                document.head.appendChild(script);
            });
        }

        // Toggle timeline visibility
        function toggleTimeline() {
            const container = document.getElementById('timeline-container');
            const button = document.getElementById('toggleTimeline');

            if (container.style.display === 'none') {
                // Show timeline
                button.classList.add('active');
                button.title = 'Hide timeline';
                button.textContent = 'üóìÔ∏è';

                // Load vis-timeline if needed and show timeline
                loadVisTimeline().then(() => {
                    container.style.display = 'block';
                    // Set default height if not already set
                    if (!container.style.height) {
                        container.style.height = '30vh';
                    }
                    // Wait for container to be visible, then initialize
                    setTimeout(() => {
                        initTimeline();
                        initTimelineResize();
                    }, 100);
                }).catch(error => {
                    console.error('Error loading timeline:', error);
                    alert('Failed to load timeline. Please check your internet connection.');
                    container.style.display = 'none';
                    button.classList.remove('active');
                    button.title = 'Show timeline';
                    button.textContent = 'üìÜ';
                });
            } else {
                // Hide timeline
                container.style.display = 'none';
                button.classList.remove('active');
                button.title = 'Show timeline';
                button.textContent = 'üìÜ';
            }
        }

        // Update timeline position when filter bar is toggled
        function updateTimelinePosition() {
            const container = document.getElementById('timeline-container');
            const filterToolbar = document.querySelector('.filter-toolbar');

            if (container && filterToolbar) {
                const filterHeight = filterToolbar.offsetHeight;
                const computedStyle = getComputedStyle(filterToolbar);
                const isFilterVisible = computedStyle.display !== 'none' &&
                    computedStyle.visibility !== 'hidden' &&
                    filterHeight > 0;

                container.style.top = isFilterVisible ? `${filterHeight}px` : '0px';
            }
        }

        // Initialize timeline resizing functionality
        function initTimelineResize() {
            const container = document.getElementById('timeline-container');
            const resizeHandle = document.getElementById('timeline-resize-handle');

            if (!container || !resizeHandle) return;

            let startY = 0;
            let startHeight = 0;

            function handleMouseDown(e) {
                isResizing = true;
                startY = e.clientY;
                startHeight = container.offsetHeight;

                document.addEventListener('mousemove', handleMouseMove);
                document.addEventListener('mouseup', handleMouseUp);

                // Prevent text selection during resize
                document.body.style.userSelect = 'none';
                e.preventDefault();
            }

            function handleMouseMove(e) {
                if (!isResizing) return;

                const deltaY = e.clientY - startY;
                const newHeight = Math.max(150, Math.min(window.innerHeight * 0.8, startHeight + deltaY));

                container.style.height = newHeight + 'px';

                // Trigger timeline redraw if needed
                if (timeline) {
                    timeline.redraw();
                }
            }

            function handleMouseUp() {
                isResizing = false;
                document.removeEventListener('mousemove', handleMouseMove);
                document.removeEventListener('mouseup', handleMouseUp);
                document.body.style.userSelect = '';
            }

            // Add mouse event listeners
            resizeHandle.addEventListener('mousedown', handleMouseDown);

            // Also allow resizing by dragging the container bottom edge
            container.addEventListener('mousedown', function (e) {
                const rect = container.getBoundingClientRect();
                if (e.clientY >= rect.bottom - 8) {
                    handleMouseDown(e);
                }
            });
        }

        // Export functions to global scope
        window.toggleTimeline = toggleTimeline;
        window.applyTimelineFilters = applyFilters;
        window.updateTimelinePosition = updateTimelinePosition;

        // Hook into existing systems
        document.addEventListener('DOMContentLoaded', function () {
            // Listen for filter changes
            const filterToggles = document.querySelectorAll('.filter-toggle');
            filterToggles.forEach(toggle => {
                toggle.addEventListener('click', function () {
                    setTimeout(applyFilters, 50);
                });
            });

            // Listen for select all/none buttons
            const selectAllButton = document.getElementById('selectAll');
            const selectNoneButton = document.getElementById('selectNone');
            if (selectAllButton) {
                selectAllButton.addEventListener('click', function () {
                    setTimeout(applyFilters, 50);
                });
            }
            if (selectNoneButton) {
                selectNoneButton.addEventListener('click', function () {
                    setTimeout(applyFilters, 50);
                });
            }

            // Listen for filter toolbar visibility changes
            const filterButton = document.getElementById('filterMessages');
            const closeFiltersButton = document.getElementById('closeFilters');

            if (filterButton) {
                filterButton.addEventListener('click', function () {
                    setTimeout(updateTimelinePosition, 50);
                });
            }

            if (closeFiltersButton) {
                closeFiltersButton.addEventListener('click', function () {
                    setTimeout(updateTimelinePosition, 50);
                });
            }

            // Update timeline position on window resize
            window.addEventListener('resize', updateTimelinePosition);
        });
    })();
</script>

    <!-- Combined Search & Filter Toolbar -->
    <div class="filter-toolbar">
        <div class="toolbar-header">
            <h3>üîç Search & Filter</h3>
            <button class="close-toolbar-btn" id="closeToolbar" title="Close">‚úï</button>
        </div>

        <!-- Inline Search -->
        <!-- Inline Search Component for Filter Toolbar -->
<div id="searchContainer" class="search-inline search-container">
    <div class="search-input-wrapper">
        <input type="text"
               id="searchInput"
               class="search-input"
               placeholder="Search conversations... (Ctrl+F)"
               autocomplete="off">
        <button id="searchClear" class="search-clear" title="Clear search">‚úï</button>
    </div>

    <div id="searchResultsInfo" class="search-results-info">
        <div class="search-navigation">
            <span id="searchResultCount">No results</span>
            <button id="searchPrev" class="search-nav-btn" disabled title="Previous match (Shift+F3)">‚Üë</button>
            <button id="searchNext" class="search-nav-btn" disabled title="Next match (F3)">‚Üì</button>
        </div>
        <div class="search-options-inline">
            <label class="search-option-inline">
                <input type="checkbox" id="searchRegex">
                <span>Regex</span>
            </label>
            <label class="search-option-inline">
                <input type="checkbox" id="searchInFiltered" checked>
                <span>Visible only</span>
            </label>
        </div>
    </div>
</div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="filter-toggles">
                <button class="filter-toggle active" data-type="user">ü§∑ User <span class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="system">‚öôÔ∏è System <span class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="assistant">ü§ñ Assistant <span
                        class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="thinking">üí≠ Thinking <span
                        class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="tool">üõ†Ô∏è Tool <span
                        class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="sidechain">üîó Sub-assistant <span
                        class="count">(0)</span></button>
                <button class="filter-toggle active" data-type="image">üñºÔ∏è Images <span class="count">(0)</span></button>
            </div>
            <div class="filter-actions">
                <button class="filter-action-btn" id="selectAll">All</button>
                <button class="filter-action-btn" id="selectNone">None</button>
            </div>
        </div>
    </div>


    

    
    
    <div class="session-divider"></div>
    <div id='session-53188aba-ad34-4f11-9df7-8031d427bc6f' class='message session-header'>
        <div class='header'>Session: 53188aba</div>
        

    </div>
    
    
    
    
    <div class='message assistant sidechain'>
        <div class='header'>
            <span>üîó Sub-assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:01.759Z'>2025-11-18 14:01:01</span>
                </div>
                
                <span class='token-usage'>Input: 602 | Output: 131</span>
                
            </div>
        </div>
        <div class='content'><p>I'm ready to help you explore the codebase in <code>/root/Claude/claude-hooks</code>. This is a read-only exploration task where I can:</p>
<ul>
<li>Search for files using glob patterns</li>
<li>Search code contents with regex</li>
<li>Read and analyze specific files</li>
<li>Run read-only bash commands</li>
</ul>
<p>Please let me know what you'd like me to search for or explore in this directory. For example, I can:</p>
<ul>
<li>Find files matching certain patterns</li>
<li>Search for specific code or text</li>
<li>Analyze file structures</li>
<li>Locate functions, classes, or imports</li>
</ul>
<p>What would you like me to investigate?</p>
</div>
    </div>
    
    
    
    
    <div class='message assistant sidechain'>
        <div class='header'>
            <span>üîó Sub-assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:03.846Z'>2025-11-18 14:01:03</span>
                </div>
                
                <span class='token-usage'>Input: 613 | Output: 136</span>
                
            </div>
        </div>
        <div class='content'><p>I'm ready to help you search and explore your codebase! I'm Claude Code's file search specialist, and I can help you find files, search through code, and analyze contents.</p>
<p>I can assist you with:</p>
<ul>
<li><strong>Finding files</strong> using glob patterns</li>
<li><strong>Searching code</strong> using grep with regex patterns</li>
<li><strong>Reading file contents</strong> when you know the path</li>
<li><strong>Exploring directory structures</strong> with read-only bash commands</li>
</ul>
<p>Just let me know what you're looking for in the <code>/root/Claude/claude-hooks</code> directory, and I'll help you locate it. What would you like me to search for?</p>
</div>
    </div>
    
    
    
    
    <div class='message user'>
        <div class='header'>
            <span>ü§∑ User</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:05.870Z'>2025-11-18 14:01:05</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Build an Alert Notification Router system that intelligently routes alerts to appropriate teams based on configurable rules and escalation policies. The system should support multiple notification
channels (email, Slack, PagerDuty) and include alert deduplication, priority handling, and delivery tracking.

Please create the following documentation files:
1. DevelopmentPlan.md - Outline the architecture, tech stack, database schema, API endpoints, and implementation phases
2. TestingPlan.md - Define test strategy including unit tests, integration tests, end-to-end tests, and test coverage goals
3. Guide.md - Create a user guide covering setup, configuration, usage examples, and troubleshooting</pre></div>
    </div>
    
    
    
    
    <div class='message assistant'>
        <div class='header'>
            <span>ü§ñ Assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.769Z'>2025-11-18 14:01:11</span>
                </div>
                
                <span class='token-usage'>Input: 2 | Output: 127 | Cache Creation: 734 | Cache Read: 20791</span>
                
            </div>
        </div>
        <div class='content markdown'><p>I'll help you build an Alert Notification Router system with comprehensive documentation. Let me start by activating the relevant skills and then create the documentation files.</p>
</div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_019EXGt5tYKUq3q32vbvoasf">üõ†Ô∏è Skill</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.801Z'>2025-11-18 14:01:11</span>
                </div>
                
            </div>
        </div>
        <div class='content'><table class='tool-params-table'>
            <tr>
                <td class='tool-param-key'>skill</td>
                <td class='tool-param-value'>backend-dev-guidelines</td>
            </tr>
        </table></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_019EXGt5tYKUq3q32vbvoasf"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.970Z' data-duration='took 169 ms'>2025-11-18 14:01:11</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Launching skill: backend-dev-guidelines</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01JTExZsYCHE5xZfSBwyuKrA">üõ†Ô∏è Skill</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.839Z'>2025-11-18 14:01:11</span>
                </div>
                
            </div>
        </div>
        <div class='content'><table class='tool-params-table'>
            <tr>
                <td class='tool-param-key'>skill</td>
                <td class='tool-param-value'>frontend-dev-guidelines</td>
            </tr>
        </table></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01JTExZsYCHE5xZfSBwyuKrA"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:12.114Z' data-duration='took 275 ms'>2025-11-18 14:01:12</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Launching skill: frontend-dev-guidelines</pre></div>
    </div>
    
    
    
    
    <div class='message system'>
        <div class='header'>
            <span>‚öôÔ∏è System</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.968Z'>2025-11-18 14:01:11</span>
                </div>
                
            </div>
        </div>
        <div class='content'><strong>Command:</strong> backend-dev-guidelines</div>
    </div>
    
    
    
    
    <div class='message user'>
        <div class='header'>
            <span>ü§∑ User</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:11.968Z'>2025-11-18 14:01:11</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Base directory for this skill: /root/.claude/skills/backend-dev-guidelines

# Backend Development Guidelines

## Purpose

Establish consistency and best practices across backend microservices (blog-api, auth-service, notifications-service) using modern Node.js/Express/TypeScript patterns.

## When to Use This Skill

Automatically activates when working on:
- Creating or modifying routes, endpoints, APIs
- Building controllers, services, repositories
- Implementing middleware (auth, validation, error handling)
- Database operations with Prisma
- Error tracking with Sentry
- Input validation with Zod
- Configuration management
- Backend testing and refactoring

---

## Quick Start

### New Backend Feature Checklist

- [ ] **Route**: Clean definition, delegate to controller
- [ ] **Controller**: Extend BaseController
- [ ] **Service**: Business logic with DI
- [ ] **Repository**: Database access (if complex)
- [ ] **Validation**: Zod schema
- [ ] **Sentry**: Error tracking
- [ ] **Tests**: Unit + integration tests
- [ ] **Config**: Use unifiedConfig

### New Microservice Checklist

- [ ] Directory structure (see [architecture-overview.md](architecture-overview.md))
- [ ] instrument.ts for Sentry
- [ ] unifiedConfig setup
- [ ] BaseController class
- [ ] Middleware stack
- [ ] Error boundary
- [ ] Testing framework

---

## Architecture Overview

### Layered Architecture

```
HTTP Request
    ‚Üì
Routes (routing only)
    ‚Üì
Controllers (request handling)
    ‚Üì
Services (business logic)
    ‚Üì
Repositories (data access)
    ‚Üì
Database (Prisma)
```

**Key Principle:** Each layer has ONE responsibility.

See [architecture-overview.md](architecture-overview.md) for complete details.

---

## Directory Structure

```
service/src/
‚îú‚îÄ‚îÄ config/              # UnifiedConfig
‚îú‚îÄ‚îÄ controllers/         # Request handlers
‚îú‚îÄ‚îÄ services/            # Business logic
‚îú‚îÄ‚îÄ repositories/        # Data access
‚îú‚îÄ‚îÄ routes/              # Route definitions
‚îú‚îÄ‚îÄ middleware/          # Express middleware
‚îú‚îÄ‚îÄ types/               # TypeScript types
‚îú‚îÄ‚îÄ validators/          # Zod schemas
‚îú‚îÄ‚îÄ utils/               # Utilities
‚îú‚îÄ‚îÄ tests/               # Tests
‚îú‚îÄ‚îÄ instrument.ts        # Sentry (FIRST IMPORT)
‚îú‚îÄ‚îÄ app.ts               # Express setup
‚îî‚îÄ‚îÄ server.ts            # HTTP server
```

**Naming Conventions:**
- Controllers: `PascalCase` - `UserController.ts`
- Services: `camelCase` - `userService.ts`
- Routes: `camelCase + Routes` - `userRoutes.ts`
- Repositories: `PascalCase + Repository` - `UserRepository.ts`

---

## Core Principles (7 Key Rules)

### 1. Routes Only Route, Controllers Control

```typescript
// ‚ùå NEVER: Business logic in routes
router.post(&#x27;/submit&#x27;, async (req, res) =&gt; {
    // 200 lines of logic
});

// ‚úÖ ALWAYS: Delegate to controller
router.post(&#x27;/submit&#x27;, (req, res) =&gt; controller.submit(req, res));
```

### 2. All Controllers Extend BaseController

```typescript
export class UserController extends BaseController {
    async getUser(req: Request, res: Response): Promise&lt;void&gt; {
        try {
            const user = await this.userService.findById(req.params.id);
            this.handleSuccess(res, user);
        } catch (error) {
            this.handleError(error, res, &#x27;getUser&#x27;);
        }
    }
}
```

### 3. All Errors to Sentry

```typescript
try {
    await operation();
} catch (error) {
    Sentry.captureException(error);
    throw error;
}
```

### 4. Use unifiedConfig, NEVER process.env

```typescript
// ‚ùå NEVER
const timeout = process.env.TIMEOUT_MS;

// ‚úÖ ALWAYS
import { config } from &#x27;./config/unifiedConfig&#x27;;
const timeout = config.timeouts.default;
```

### 5. Validate All Input with Zod

```typescript
const schema = z.object({ email: z.string().email() });
const validated = schema.parse(req.body);
```

### 6. Use Repository Pattern for Data Access

```typescript
// Service ‚Üí Repository ‚Üí Database
const users = await userRepository.findActive();
```

### 7. Comprehensive Testing Required

```typescript
describe(&#x27;UserService&#x27;, () =&gt; {
    it(&#x27;should create user&#x27;, async () =&gt; {
        expect(user).toBeDefined();
    });
});
```

---

## Common Imports

```typescript
// Express
import express, { Request, Response, NextFunction, Router } from &#x27;express&#x27;;

// Validation
import { z } from &#x27;zod&#x27;;

// Database
import { PrismaClient } from &#x27;@prisma/client&#x27;;
import type { Prisma } from &#x27;@prisma/client&#x27;;

// Sentry
import * as Sentry from &#x27;@sentry/node&#x27;;

// Config
import { config } from &#x27;./config/unifiedConfig&#x27;;

// Middleware
import { SSOMiddlewareClient } from &#x27;./middleware/SSOMiddleware&#x27;;
import { asyncErrorWrapper } from &#x27;./middleware/errorBoundary&#x27;;
```

---

## Quick Reference

### HTTP Status Codes

| Code | Use Case |
|------|----------|
| 200 | Success |
| 201 | Created |
| 400 | Bad Request |
| 401 | Unauthorized |
| 403 | Forbidden |
| 404 | Not Found |
| 500 | Server Error |

### Service Templates

**Blog API** (‚úÖ Mature) - Use as template for REST APIs
**Auth Service** (‚úÖ Mature) - Use as template for authentication patterns

---

## Anti-Patterns to Avoid

‚ùå Business logic in routes
‚ùå Direct process.env usage
‚ùå Missing error handling
‚ùå No input validation
‚ùå Direct Prisma everywhere
‚ùå console.log instead of Sentry

---

## Navigation Guide

| Need to... | Read this |
|------------|-----------|
| Understand architecture | [architecture-overview.md](architecture-overview.md) |
| Create routes/controllers | [routing-and-controllers.md](routing-and-controllers.md) |
| Organize business logic | [services-and-repositories.md](services-and-repositories.md) |
| Validate input | [validation-patterns.md](validation-patterns.md) |
| Add error tracking | [sentry-and-monitoring.md](sentry-and-monitoring.md) |
| Create middleware | [middleware-guide.md](middleware-guide.md) |
| Database access | [database-patterns.md](database-patterns.md) |
| Manage config | [configuration.md](configuration.md) |
| Handle async/errors | [async-and-errors.md](async-and-errors.md) |
| Write tests | [testing-guide.md](testing-guide.md) |
| See examples | [complete-examples.md](complete-examples.md) |

---

## Resource Files

### [architecture-overview.md](architecture-overview.md)
Layered architecture, request lifecycle, separation of concerns

### [routing-and-controllers.md](routing-and-controllers.md)
Route definitions, BaseController, error handling, examples

### [services-and-repositories.md](services-and-repositories.md)
Service patterns, DI, repository pattern, caching

### [validation-patterns.md](validation-patterns.md)
Zod schemas, validation, DTO pattern

### [sentry-and-monitoring.md](sentry-and-monitoring.md)
Sentry init, error capture, performance monitoring

### [middleware-guide.md](middleware-guide.md)
Auth, audit, error boundaries, AsyncLocalStorage

### [database-patterns.md](database-patterns.md)
PrismaService, repositories, transactions, optimization

### [configuration.md](configuration.md)
UnifiedConfig, environment configs, secrets

### [async-and-errors.md](async-and-errors.md)
Async patterns, custom errors, asyncErrorWrapper

### [testing-guide.md](testing-guide.md)
Unit/integration tests, mocking, coverage

### [complete-examples.md](complete-examples.md)
Full examples, refactoring guide

---

## Related Skills

- **database-verification** - Verify column names and schema consistency
- **error-tracking** - Sentry integration patterns
- **skill-developer** - Meta-skill for creating and managing skills

---

**Skill Status**: COMPLETE ‚úÖ
**Line Count**: &lt; 500 ‚úÖ
**Progressive Disclosure**: 11 resource files ‚úÖ</pre></div>
    </div>
    
    
    
    
    <div class='message system'>
        <div class='header'>
            <span>‚öôÔ∏è System</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:12.112Z'>2025-11-18 14:01:12</span>
                </div>
                
            </div>
        </div>
        <div class='content'><strong>Command:</strong> frontend-dev-guidelines</div>
    </div>
    
    
    
    
    <div class='message user'>
        <div class='header'>
            <span>ü§∑ User</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:12.112Z'>2025-11-18 14:01:12</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Base directory for this skill: /root/.claude/skills/frontend-dev-guidelines

# Frontend Development Guidelines

## Purpose

Comprehensive guide for modern React development, emphasizing Suspense-based data fetching, lazy loading, proper file organization, and performance optimization.

## When to Use This Skill

- Creating new components or pages
- Building new features
- Fetching data with TanStack Query
- Setting up routing with TanStack Router
- Styling components with MUI v7
- Performance optimization
- Organizing frontend code
- TypeScript best practices

---

## Quick Start

### New Component Checklist

Creating a component? Follow this checklist:

- [ ] Use `React.FC&lt;Props&gt;` pattern with TypeScript
- [ ] Lazy load if heavy component: `React.lazy(() =&gt; import())`
- [ ] Wrap in `&lt;SuspenseLoader&gt;` for loading states
- [ ] Use `useSuspenseQuery` for data fetching
- [ ] Import aliases: `@/`, `~types`, `~components`, `~features`
- [ ] Styles: Inline if &lt;100 lines, separate file if &gt;100 lines
- [ ] Use `useCallback` for event handlers passed to children
- [ ] Default export at bottom
- [ ] No early returns with loading spinners
- [ ] Use `useMuiSnackbar` for user notifications

### New Feature Checklist

Creating a feature? Set up this structure:

- [ ] Create `features/{feature-name}/` directory
- [ ] Create subdirectories: `api/`, `components/`, `hooks/`, `helpers/`, `types/`
- [ ] Create API service file: `api/{feature}Api.ts`
- [ ] Set up TypeScript types in `types/`
- [ ] Create route in `routes/{feature-name}/index.tsx`
- [ ] Lazy load feature components
- [ ] Use Suspense boundaries
- [ ] Export public API from feature `index.ts`

---

## Import Aliases Quick Reference

| Alias | Resolves To | Example |
|-------|-------------|---------|
| `@/` | `src/` | `import { apiClient } from &#x27;@/lib/apiClient&#x27;` |
| `~types` | `src/types` | `import type { User } from &#x27;~types/user&#x27;` |
| `~components` | `src/components` | `import { SuspenseLoader } from &#x27;~components/SuspenseLoader&#x27;` |
| `~features` | `src/features` | `import { authApi } from &#x27;~features/auth&#x27;` |

Defined in: [vite.config.ts](../../vite.config.ts) lines 180-185

---

## Common Imports Cheatsheet

```typescript
// React &amp; Lazy Loading
import React, { useState, useCallback, useMemo } from &#x27;react&#x27;;
const Heavy = React.lazy(() =&gt; import(&#x27;./Heavy&#x27;));

// MUI Components
import { Box, Paper, Typography, Button, Grid } from &#x27;@mui/material&#x27;;
import type { SxProps, Theme } from &#x27;@mui/material&#x27;;

// TanStack Query (Suspense)
import { useSuspenseQuery, useQueryClient } from &#x27;@tanstack/react-query&#x27;;

// TanStack Router
import { createFileRoute } from &#x27;@tanstack/react-router&#x27;;

// Project Components
import { SuspenseLoader } from &#x27;~components/SuspenseLoader&#x27;;

// Hooks
import { useAuth } from &#x27;@/hooks/useAuth&#x27;;
import { useMuiSnackbar } from &#x27;@/hooks/useMuiSnackbar&#x27;;

// Types
import type { Post } from &#x27;~types/post&#x27;;
```

---

## Topic Guides

### üé® Component Patterns

**Modern React components use:**
- `React.FC&lt;Props&gt;` for type safety
- `React.lazy()` for code splitting
- `SuspenseLoader` for loading states
- Named const + default export pattern

**Key Concepts:**
- Lazy load heavy components (DataGrid, charts, editors)
- Always wrap lazy components in Suspense
- Use SuspenseLoader component (with fade animation)
- Component structure: Props ‚Üí Hooks ‚Üí Handlers ‚Üí Render ‚Üí Export

**[üìñ Complete Guide: resources/component-patterns.md](resources/component-patterns.md)**

---

### üìä Data Fetching

**PRIMARY PATTERN: useSuspenseQuery**
- Use with Suspense boundaries
- Cache-first strategy (check grid cache before API)
- Replaces `isLoading` checks
- Type-safe with generics

**API Service Layer:**
- Create `features/{feature}/api/{feature}Api.ts`
- Use `apiClient` axios instance
- Centralized methods per feature
- Route format: `/form/route` (NOT `/api/form/route`)

**[üìñ Complete Guide: resources/data-fetching.md](resources/data-fetching.md)**

---

### üìÅ File Organization

**features/ vs components/:**
- `features/`: Domain-specific (posts, comments, auth)
- `components/`: Truly reusable (SuspenseLoader, CustomAppBar)

**Feature Subdirectories:**
```
features/
  my-feature/
    api/          # API service layer
    components/   # Feature components
    hooks/        # Custom hooks
    helpers/      # Utility functions
    types/        # TypeScript types
```

**[üìñ Complete Guide: resources/file-organization.md](resources/file-organization.md)**

---

### üé® Styling

**Inline vs Separate:**
- &lt;100 lines: Inline `const styles: Record&lt;string, SxProps&lt;Theme&gt;&gt;`
- &gt;100 lines: Separate `.styles.ts` file

**Primary Method:**
- Use `sx` prop for MUI components
- Type-safe with `SxProps&lt;Theme&gt;`
- Theme access: `(theme) =&gt; theme.palette.primary.main`

**MUI v7 Grid:**
```typescript
&lt;Grid size={{ xs: 12, md: 6 }}&gt;  // ‚úÖ v7 syntax
&lt;Grid xs={12} md={6}&gt;             // ‚ùå Old syntax
```

**[üìñ Complete Guide: resources/styling-guide.md](resources/styling-guide.md)**

---

### üõ£Ô∏è Routing

**TanStack Router - Folder-Based:**
- Directory: `routes/my-route/index.tsx`
- Lazy load components
- Use `createFileRoute`
- Breadcrumb data in loader

**Example:**
```typescript
import { createFileRoute } from &#x27;@tanstack/react-router&#x27;;
import { lazy } from &#x27;react&#x27;;

const MyPage = lazy(() =&gt; import(&#x27;@/features/my-feature/components/MyPage&#x27;));

export const Route = createFileRoute(&#x27;/my-route/&#x27;)({
    component: MyPage,
    loader: () =&gt; ({ crumb: &#x27;My Route&#x27; }),
});
```

**[üìñ Complete Guide: resources/routing-guide.md](resources/routing-guide.md)**

---

### ‚è≥ Loading &amp; Error States

**CRITICAL RULE: No Early Returns**

```typescript
// ‚ùå NEVER - Causes layout shift
if (isLoading) {
    return &lt;LoadingSpinner /&gt;;
}

// ‚úÖ ALWAYS - Consistent layout
&lt;SuspenseLoader&gt;
    &lt;Content /&gt;
&lt;/SuspenseLoader&gt;
```

**Why:** Prevents Cumulative Layout Shift (CLS), better UX

**Error Handling:**
- Use `useMuiSnackbar` for user feedback
- NEVER `react-toastify`
- TanStack Query `onError` callbacks

**[üìñ Complete Guide: resources/loading-and-error-states.md](resources/loading-and-error-states.md)**

---

### ‚ö° Performance

**Optimization Patterns:**
- `useMemo`: Expensive computations (filter, sort, map)
- `useCallback`: Event handlers passed to children
- `React.memo`: Expensive components
- Debounced search (300-500ms)
- Memory leak prevention (cleanup in useEffect)

**[üìñ Complete Guide: resources/performance.md](resources/performance.md)**

---

### üìò TypeScript

**Standards:**
- Strict mode, no `any` type
- Explicit return types on functions
- Type imports: `import type { User } from &#x27;~types/user&#x27;`
- Component prop interfaces with JSDoc

**[üìñ Complete Guide: resources/typescript-standards.md](resources/typescript-standards.md)**

---

### üîß Common Patterns

**Covered Topics:**
- React Hook Form with Zod validation
- DataGrid wrapper contracts
- Dialog component standards
- `useAuth` hook for current user
- Mutation patterns with cache invalidation

**[üìñ Complete Guide: resources/common-patterns.md](resources/common-patterns.md)**

---

### üìö Complete Examples

**Full working examples:**
- Modern component with all patterns
- Complete feature structure
- API service layer
- Route with lazy loading
- Suspense + useSuspenseQuery
- Form with validation

**[üìñ Complete Guide: resources/complete-examples.md](resources/complete-examples.md)**

---

## Navigation Guide

| Need to... | Read this resource |
|------------|-------------------|
| Create a component | [component-patterns.md](resources/component-patterns.md) |
| Fetch data | [data-fetching.md](resources/data-fetching.md) |
| Organize files/folders | [file-organization.md](resources/file-organization.md) |
| Style components | [styling-guide.md](resources/styling-guide.md) |
| Set up routing | [routing-guide.md](resources/routing-guide.md) |
| Handle loading/errors | [loading-and-error-states.md](resources/loading-and-error-states.md) |
| Optimize performance | [performance.md](resources/performance.md) |
| TypeScript types | [typescript-standards.md](resources/typescript-standards.md) |
| Forms/Auth/DataGrid | [common-patterns.md](resources/common-patterns.md) |
| See full examples | [complete-examples.md](resources/complete-examples.md) |

---

## Core Principles

1. **Lazy Load Everything Heavy**: Routes, DataGrid, charts, editors
2. **Suspense for Loading**: Use SuspenseLoader, not early returns
3. **useSuspenseQuery**: Primary data fetching pattern for new code
4. **Features are Organized**: api/, components/, hooks/, helpers/ subdirs
5. **Styles Based on Size**: &lt;100 inline, &gt;100 separate
6. **Import Aliases**: Use @/, ~types, ~components, ~features
7. **No Early Returns**: Prevents layout shift
8. **useMuiSnackbar**: For all user notifications

---

## Quick Reference: File Structure

```
src/
  features/
    my-feature/
      api/
        myFeatureApi.ts       # API service
      components/
        MyFeature.tsx         # Main component
        SubComponent.tsx      # Related components
      hooks/
        useMyFeature.ts       # Custom hooks
        useSuspenseMyFeature.ts  # Suspense hooks
      helpers/
        myFeatureHelpers.ts   # Utilities
      types/
        index.ts              # TypeScript types
      index.ts                # Public exports

  components/
    SuspenseLoader/
      SuspenseLoader.tsx      # Reusable loader
    CustomAppBar/
      CustomAppBar.tsx        # Reusable app bar

  routes/
    my-route/
      index.tsx               # Route component
      create/
        index.tsx             # Nested route
```

---

## Modern Component Template (Quick Copy)

```typescript
import React, { useState, useCallback } from &#x27;react&#x27;;
import { Box, Paper } from &#x27;@mui/material&#x27;;
import { useSuspenseQuery } from &#x27;@tanstack/react-query&#x27;;
import { featureApi } from &#x27;../api/featureApi&#x27;;
import type { FeatureData } from &#x27;~types/feature&#x27;;

interface MyComponentProps {
    id: number;
    onAction?: () =&gt; void;
}

export const MyComponent: React.FC&lt;MyComponentProps&gt; = ({ id, onAction }) =&gt; {
    const [state, setState] = useState&lt;string&gt;(&#x27;&#x27;);

    const { data } = useSuspenseQuery({
        queryKey: [&#x27;feature&#x27;, id],
        queryFn: () =&gt; featureApi.getFeature(id),
    });

    const handleAction = useCallback(() =&gt; {
        setState(&#x27;updated&#x27;);
        onAction?.();
    }, [onAction]);

    return (
        &lt;Box sx={{ p: 2 }}&gt;
            &lt;Paper sx={{ p: 3 }}&gt;
                {/* Content */}
            &lt;/Paper&gt;
        &lt;/Box&gt;
    );
};

export default MyComponent;
```

For complete examples, see [resources/complete-examples.md](resources/complete-examples.md)

---

## Related Skills

- **error-tracking**: Error tracking with Sentry (applies to frontend too)
- **backend-dev-guidelines**: Backend API patterns that frontend consumes

---

**Skill Status**: Modular structure with progressive loading for optimal context management</pre></div>
    </div>
    
    
    
    
    <div class='message assistant'>
        <div class='header'>
            <span>ü§ñ Assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:16.802Z'>2025-11-18 14:01:16</span>
                </div>
                
                <span class='token-usage'>Input: 2 | Output: 223 | Cache Creation: 5611 | Cache Read: 21525</span>
                
            </div>
        </div>
        <div class='content markdown'><p>Now I'll create the three comprehensive documentation files for your Alert Notification Router system.</p>
</div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_018rM2L2dkSDNLDownRkeMDn">üìù Todo List</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:18.920Z'>2025-11-18 14:01:18</span>
                </div>
                
            </div>
        </div>
        <div class='content'>
    <div class="todo-list">
        
                <div class="todo-item in_progress medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">üîÑ</span>
                    <span class="todo-content">Create DevelopmentPlan.md with architecture and implementation details</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item pending medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">‚è≥</span>
                    <span class="todo-content">Create TestingPlan.md with comprehensive test strategy</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item pending medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">‚è≥</span>
                    <span class="todo-content">Create Guide.md with user documentation</span>
                    <span class="todo-id">#</span>
                </div>
            
    </div>
    </div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_018rM2L2dkSDNLDownRkeMDn"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:01:19.002Z' data-duration='took 82 ms'>2025-11-18 14:01:19</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01TKi9h4shaQc8jVoEqFnRLQ">üìù Write <span class='tool-summary'>/root/Claude/claude-hooks/DevelopmentPlan.md</span></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:49.485Z'>2025-11-18 14:03:49</span>
                </div>
                
            </div>
        </div>
        <div class='content'><div class='write-tool-content'>
        <details class='collapsible-code'>
            <summary>
                <span class='line-count'>1357 lines</span>
                <div class='preview-content'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Development Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">System Overview</span>](<span class="na">#system-overview</span>)
</code></pre></div></td></tr></table></div>
</div>
            </summary>
            <div class='code-full'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Development Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">System Overview</span>](<span class="na">#system-overview</span>)
<span class="k">2.</span> [<span class="nt">Architecture</span>](<span class="na">#architecture</span>)
<span class="k">3.</span> [<span class="nt">Tech Stack</span>](<span class="na">#tech-stack</span>)
<span class="k">4.</span> [<span class="nt">Database Schema</span>](<span class="na">#database-schema</span>)
<span class="k">5.</span> [<span class="nt">API Endpoints</span>](<span class="na">#api-endpoints</span>)
<span class="k">6.</span> [<span class="nt">Implementation Phases</span>](<span class="na">#implementation-phases</span>)
<span class="k">7.</span> [<span class="nt">Security Considerations</span>](<span class="na">#security-considerations</span>)
<span class="k">8.</span> [<span class="nt">Scalability &amp; Performance</span>](<span class="na">#scalability--performance</span>)

---

<span class="gu">## System Overview</span>

<span class="gu">### Purpose</span>

The Alert Notification Router is an intelligent alert distribution system that routes alerts to appropriate teams based on configurable rules and escalation policies. It provides multi-channel delivery, deduplication, priority handling, and comprehensive delivery tracking.

<span class="gu">### Key Features</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Intelligent Routing**</span>: Rule-based routing engine with pattern matching
<span class="k">-</span><span class="w"> </span><span class="gs">**Multi-Channel Support**</span>: Email, Slack, PagerDuty integration
<span class="k">-</span><span class="w"> </span><span class="gs">**Alert Deduplication**</span>: Prevents duplicate notifications within configurable time windows
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority Handling**</span>: Supports critical, high, medium, low priority levels
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Policies**</span>: Automatic escalation after timeout periods
<span class="k">-</span><span class="w"> </span><span class="gs">**Delivery Tracking**</span>: Comprehensive audit trail and status tracking
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Management**</span>: Flexible team and user management with role-based access
<span class="k">-</span><span class="w"> </span><span class="gs">**Analytics Dashboard**</span>: Real-time metrics and historical reporting

---

<span class="gu">## Architecture</span>

<span class="gu">### High-Level Architecture</span>

<span class="sb">```</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ  Alert Sources  ‚îÇ</span>
<span class="sb">‚îÇ  (External APIs)‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">         ‚îÇ</span>
<span class="sb">         ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ         API Gateway Layer               ‚îÇ</span>
<span class="sb">‚îÇ  - Authentication &amp; Authorization       ‚îÇ</span>
<span class="sb">‚îÇ  - Rate Limiting                        ‚îÇ</span>
<span class="sb">‚îÇ  - Request Validation (Zod)            ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">         ‚îÇ</span>
<span class="sb">         ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ      Alert Processing Service           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Ingestion Controller            ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Deduplication Service           ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Hash generation               ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Similarity checking           ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Routing Engine                  ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Rule evaluation               ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Team matching                 ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Priority Queue                  ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Priority-based scheduling     ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">              ‚îÇ</span>
<span class="sb">              ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ    Notification Delivery Service         ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Channel Manager                 ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Email Provider                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Slack Provider                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - PagerDuty Provider            ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Delivery Tracker                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Status updates                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Retry logic                   ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">              ‚îÇ</span>
<span class="sb">              ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ     Escalation Service                   ‚îÇ</span>
<span class="sb">‚îÇ  - Monitors unacknowledged alerts       ‚îÇ</span>
<span class="sb">‚îÇ  - Triggers escalation policies         ‚îÇ</span>
<span class="sb">‚îÇ  - Re-routes to escalation teams        ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">```</span>

<span class="gu">### Layered Architecture</span>

Following backend best practices:

<span class="sb">```</span>
<span class="sb">Routes Layer</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Controllers Layer (BaseController)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Services Layer (Business Logic)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Repositories Layer (Data Access)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Database (Prisma)</span>
<span class="sb">```</span>

<span class="gu">### Component Breakdown</span>

<span class="gu">#### 1. Alert Processing Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Ingestion Controller**</span>: Receives and validates incoming alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Deduplication Service**</span>: Identifies and merges duplicate alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Routing Engine**</span>: Evaluates rules and determines target teams
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority Queue**</span>: Manages alert processing order

<span class="gu">#### 2. Notification Delivery Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Channel Manager**</span>: Abstracts notification channel implementations
<span class="k">-</span><span class="w"> </span><span class="gs">**Email Provider**</span>: Sends emails via SMTP/SendGrid
<span class="k">-</span><span class="w"> </span><span class="gs">**Slack Provider**</span>: Posts messages to Slack channels/users
<span class="k">-</span><span class="w"> </span><span class="gs">**PagerDuty Provider**</span>: Creates incidents in PagerDuty
<span class="k">-</span><span class="w"> </span><span class="gs">**Delivery Tracker**</span>: Monitors delivery status and retries

<span class="gu">#### 3. Escalation Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Monitor**</span>: Background job checking unacknowledged alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Policy Executor**</span>: Applies escalation rules
<span class="k">-</span><span class="w"> </span><span class="gs">**Re-routing Logic**</span>: Sends alerts to escalation teams

<span class="gu">#### 4. Configuration Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Rule Management**</span>: CRUD operations for routing rules
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Management**</span>: Manages teams, users, and on-call schedules
<span class="k">-</span><span class="w"> </span><span class="gs">**Policy Management**</span>: Escalation policy configuration

---

<span class="gu">## Tech Stack</span>

<span class="gu">### Backend</span>

<span class="gs">**Core Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Node.js**</span> v20+ (LTS)
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> v5+
<span class="k">-</span><span class="w"> </span><span class="gs">**Express.js**</span> v4+ (API framework)

<span class="gs">**Database**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**PostgreSQL**</span> v15+ (Primary database)
<span class="k">-</span><span class="w"> </span><span class="gs">**Redis**</span> v7+ (Caching, deduplication, queue management)

<span class="gs">**ORM &amp; Database Tools**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Prisma**</span> v5+ (ORM and migrations)
<span class="k">-</span><span class="w"> </span><span class="gs">**PrismaClient**</span> (Type-safe database access)

<span class="gs">**Validation &amp; Type Safety**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Zod**</span> v3+ (Runtime validation and DTO schemas)
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> (Compile-time type safety)

<span class="gs">**Error Tracking &amp; Monitoring**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Sentry**</span> v8+ (Error tracking and performance monitoring)
<span class="k">-</span><span class="w"> </span><span class="gs">**Winston**</span> (Structured logging)

<span class="gs">**Authentication &amp; Authorization**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**JWT**</span> (JSON Web Tokens)
<span class="k">-</span><span class="w"> </span><span class="gs">**bcrypt**</span> (Password hashing)

<span class="gs">**Queue &amp; Background Jobs**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Bull**</span> v4+ (Redis-based queue)
<span class="k">-</span><span class="w"> </span><span class="gs">**node-cron**</span> (Scheduled jobs)

<span class="gs">**Notification Channels**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Nodemailer**</span> (Email delivery)
<span class="k">-</span><span class="w"> </span><span class="gs">**@slack/web-api**</span> (Slack integration)
<span class="k">-</span><span class="w"> </span><span class="gs">**@pagerduty/pdjs**</span> (PagerDuty integration)

<span class="gs">**Testing**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Jest**</span> (Unit and integration tests)
<span class="k">-</span><span class="w"> </span><span class="gs">**Supertest**</span> (API endpoint testing)
<span class="k">-</span><span class="w"> </span><span class="gs">**ts-jest**</span> (TypeScript support)

<span class="gs">**Development Tools**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**ESLint**</span> (Code linting)
<span class="k">-</span><span class="w"> </span><span class="gs">**Prettier**</span> (Code formatting)
<span class="k">-</span><span class="w"> </span><span class="gs">**tsx**</span> (TypeScript execution)
<span class="k">-</span><span class="w"> </span><span class="gs">**nodemon**</span> (Development auto-reload)

<span class="gu">### Frontend (Optional Dashboard)</span>

<span class="gs">**Core Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React**</span> v18+
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> v5+
<span class="k">-</span><span class="w"> </span><span class="gs">**Vite**</span> v5+ (Build tool)

<span class="gs">**UI Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Material-UI (MUI)**</span> v7+ (Component library)

<span class="gs">**Data Fetching**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Query**</span> v5+ (useSuspenseQuery pattern)
<span class="k">-</span><span class="w"> </span><span class="gs">**Axios**</span> (HTTP client)

<span class="gs">**Routing**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Router**</span> v1+ (File-based routing)

<span class="gs">**State Management**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React Context**</span> (Global state)
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Query**</span> (Server state)

<span class="gs">**Forms &amp; Validation**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React Hook Form**</span> v7+
<span class="k">-</span><span class="w"> </span><span class="gs">**Zod**</span> (Form validation)

<span class="gu">### Infrastructure</span>

<span class="gs">**Containerization**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Docker**</span> (Container runtime)
<span class="k">-</span><span class="w"> </span><span class="gs">**Docker Compose**</span> (Local development)

<span class="gs">**CI/CD**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**GitHub Actions**</span> (Automated testing and deployment)

<span class="gs">**Deployment**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**AWS/GCP/Azure**</span> (Cloud infrastructure)
<span class="k">-</span><span class="w"> </span><span class="gs">**Kubernetes**</span> (Container orchestration - optional)

---

<span class="gu">## Database Schema</span>

<span class="gu">### Core Tables</span>

<span class="gu">#### 1. users</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">password_hash</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">full_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_deleted_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">deleted_at</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 2. teams</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">teams</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">slack_channel_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">pagerduty_service_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_teams_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 3. team_members</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">team_members</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;member&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_on_call</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">on_call_start</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">on_call_end</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_team_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">team_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_user_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_on_call</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">is_on_call</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 4. routing_rules</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routing_rules</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">priority</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">enabled</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">match_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;all&#39;, &#39;any&#39;, &#39;regex&#39;</span>
<span class="w">    </span><span class="n">conditions</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">target_team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">notification_channels</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w"> </span><span class="c1">-- [&#39;email&#39;, &#39;slack&#39;, &#39;pagerduty&#39;]</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_priority</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">priority</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_enabled</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">enabled</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_conditions</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIN</span><span class="p">(</span><span class="n">conditions</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 5. alerts</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">external_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">source</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">severity</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;critical&#39;, &#39;high&#39;, &#39;medium&#39;, &#39;low&#39;</span>
<span class="w">    </span><span class="n">priority</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;open&#39;, &#39;acknowledged&#39;, &#39;resolved&#39;, &#39;suppressed&#39;</span>
<span class="w">    </span><span class="n">fingerprint</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">labels</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">matched_rule_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">assigned_team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">acknowledged_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">acknowledged_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">resolved_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">resolved_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">expires_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_fingerprint</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_severity</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">severity</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_team</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">assigned_team_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_labels</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIN</span><span class="p">(</span><span class="n">labels</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 6. alert_notifications</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">alert_notifications</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">alert_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">channel</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;email&#39;, &#39;slack&#39;, &#39;pagerduty&#39;</span>
<span class="w">    </span><span class="n">recipient</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;pending&#39;, &#39;sent&#39;, &#39;failed&#39;, &#39;delivered&#39;</span>
<span class="w">    </span><span class="n">attempt_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">last_attempt_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">sent_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">delivered_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">failed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">error_message</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">external_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_alert_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">alert_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_channel</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 7. escalation_policies</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">escalation_policies</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">enabled</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">levels</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalation_policies_team</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalation_policies</span><span class="p">(</span><span class="n">team_id</span><span class="p">);</span>
<span class="sb">```</span>

Example <span class="sb">`levels`</span> JSONB structure:
<span class="sb">```json</span>
<span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timeout_minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;target_team_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slack&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timeout_minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;target_team_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pagerduty&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
<span class="sb">```</span>

<span class="gu">#### 8. escalations</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">escalations</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">alert_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">policy_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">escalation_policies</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">current_level</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">max_level</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;active&#39;, &#39;completed&#39;, &#39;cancelled&#39;</span>
<span class="w">    </span><span class="n">next_escalation_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_alert</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">alert_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_next</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">next_escalation_at</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 9. audit_logs</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit_logs</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">entity_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">entity_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">action</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">changes</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">ip_address</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">45</span><span class="p">),</span>
<span class="w">    </span><span class="n">user_agent</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_entity</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span><span class="w"> </span><span class="n">entity_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_user</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">### Prisma Schema</span>

<span class="sb">```prisma</span>
<span class="s">generator client {</span>
<span class="s">  provider = &quot;prisma-client-js&quot;</span>
<span class="s">}</span>

<span class="s">datasource db {</span>
<span class="s">  provider = &quot;postgresql&quot;</span>
<span class="s">  url      = env(&quot;DATABASE_URL&quot;)</span>
<span class="s">}</span>

<span class="s">model User {</span>
<span class="s">  id           String   @id @default(uuid()) @db.Uuid</span>
<span class="s">  email        String   @unique @db.VarChar(255)</span>
<span class="s">  username     String   @unique @db.VarChar(100)</span>
<span class="s">  passwordHash String   @map(&quot;password_hash&quot;) @db.VarChar(255)</span>
<span class="s">  fullName     String?  @map(&quot;full_name&quot;) @db.VarChar(255)</span>
<span class="s">  phone        String?  @db.VarChar(50)</span>
<span class="s">  role         String   @default(&quot;user&quot;) @db.VarChar(50)</span>
<span class="s">  createdAt    DateTime @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt    DateTime @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt    DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  teamMembers         TeamMember[]</span>
<span class="s">  acknowledgedAlerts  Alert[]       @relation(&quot;AcknowledgedBy&quot;)</span>
<span class="s">  resolvedAlerts      Alert[]       @relation(&quot;ResolvedBy&quot;)</span>
<span class="s">  auditLogs           AuditLog[]</span>

<span class="s">  @@index([email])</span>
<span class="s">  @@index([deletedAt])</span>
<span class="s">  @@map(&quot;users&quot;)</span>
<span class="s">}</span>

<span class="s">model Team {</span>
<span class="s">  id                 String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name               String    @db.VarChar(255)</span>
<span class="s">  description        String?   @db.Text</span>
<span class="s">  email              String?   @db.VarChar(255)</span>
<span class="s">  slackChannelId     String?   @map(&quot;slack_channel_id&quot;) @db.VarChar(100)</span>
<span class="s">  pagerdutyServiceId String?   @map(&quot;pagerduty_service_id&quot;) @db.VarChar(100)</span>
<span class="s">  createdAt          DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt          DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt          DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  members            TeamMember[]</span>
<span class="s">  routingRules       RoutingRule[]</span>
<span class="s">  alerts             Alert[]</span>
<span class="s">  escalationPolicies EscalationPolicy[]</span>

<span class="s">  @@index([name])</span>
<span class="s">  @@map(&quot;teams&quot;)</span>
<span class="s">}</span>

<span class="s">model TeamMember {</span>
<span class="s">  id           String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  teamId       String    @map(&quot;team_id&quot;) @db.Uuid</span>
<span class="s">  userId       String    @map(&quot;user_id&quot;) @db.Uuid</span>
<span class="s">  role         String    @default(&quot;member&quot;) @db.VarChar(50)</span>
<span class="s">  isOnCall     Boolean   @default(false) @map(&quot;is_on_call&quot;)</span>
<span class="s">  onCallStart  DateTime? @map(&quot;on_call_start&quot;)</span>
<span class="s">  onCallEnd    DateTime? @map(&quot;on_call_end&quot;)</span>
<span class="s">  createdAt    DateTime  @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)</span>
<span class="s">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)</span>

<span class="s">  @@unique([teamId, userId])</span>
<span class="s">  @@index([teamId])</span>
<span class="s">  @@index([userId])</span>
<span class="s">  @@index([isOnCall])</span>
<span class="s">  @@map(&quot;team_members&quot;)</span>
<span class="s">}</span>

<span class="s">model RoutingRule {</span>
<span class="s">  id                   String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name                 String    @db.VarChar(255)</span>
<span class="s">  description          String?   @db.Text</span>
<span class="s">  priority             Int       @default(0)</span>
<span class="s">  enabled              Boolean   @default(true)</span>
<span class="s">  matchType            String    @map(&quot;match_type&quot;) @db.VarChar(50)</span>
<span class="s">  conditions           Json      @db.JsonB</span>
<span class="s">  targetTeamId         String?   @map(&quot;target_team_id&quot;) @db.Uuid</span>
<span class="s">  notificationChannels Json?     @map(&quot;notification_channels&quot;) @db.JsonB</span>
<span class="s">  createdAt            DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt            DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt            DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  targetTeam Team?   @relation(fields: [targetTeamId], references: [id], onDelete: SetNull)</span>
<span class="s">  alerts     Alert[]</span>

<span class="s">  @@index([priority(sort: Desc)])</span>
<span class="s">  @@index([enabled])</span>
<span class="s">  @@map(&quot;routing_rules&quot;)</span>
<span class="s">}</span>

<span class="s">model Alert {</span>
<span class="s">  id              String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  externalId      String?   @map(&quot;external_id&quot;) @db.VarChar(255)</span>
<span class="s">  source          String    @db.VarChar(255)</span>
<span class="s">  title           String    @db.VarChar(500)</span>
<span class="s">  description     String?   @db.Text</span>
<span class="s">  severity        String    @db.VarChar(50)</span>
<span class="s">  priority        Int       @default(0)</span>
<span class="s">  status          String    @default(&quot;open&quot;) @db.VarChar(50)</span>
<span class="s">  fingerprint     String    @db.VarChar(64)</span>
<span class="s">  labels          Json?     @db.JsonB</span>
<span class="s">  metadata        Json?     @db.JsonB</span>
<span class="s">  matchedRuleId   String?   @map(&quot;matched_rule_id&quot;) @db.Uuid</span>
<span class="s">  assignedTeamId  String?   @map(&quot;assigned_team_id&quot;) @db.Uuid</span>
<span class="s">  acknowledgedBy  String?   @map(&quot;acknowledged_by&quot;) @db.Uuid</span>
<span class="s">  acknowledgedAt  DateTime? @map(&quot;acknowledged_at&quot;)</span>
<span class="s">  resolvedBy      String?   @map(&quot;resolved_by&quot;) @db.Uuid</span>
<span class="s">  resolvedAt      DateTime? @map(&quot;resolved_at&quot;)</span>
<span class="s">  createdAt       DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt       DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  expiresAt       DateTime? @map(&quot;expires_at&quot;)</span>

<span class="s">  matchedRule       RoutingRule?        @relation(fields: [matchedRuleId], references: [id])</span>
<span class="s">  assignedTeam      Team?               @relation(fields: [assignedTeamId], references: [id])</span>
<span class="s">  acknowledger      User?               @relation(&quot;AcknowledgedBy&quot;, fields: [acknowledgedBy], references: [id])</span>
<span class="s">  resolver          User?               @relation(&quot;ResolvedBy&quot;, fields: [resolvedBy], references: [id])</span>
<span class="s">  notifications     AlertNotification[]</span>
<span class="s">  escalations       Escalation[]</span>

<span class="s">  @@index([fingerprint])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([severity])</span>
<span class="s">  @@index([assignedTeamId])</span>
<span class="s">  @@index([createdAt(sort: Desc)])</span>
<span class="s">  @@map(&quot;alerts&quot;)</span>
<span class="s">}</span>

<span class="s">model AlertNotification {</span>
<span class="s">  id            String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  alertId       String    @map(&quot;alert_id&quot;) @db.Uuid</span>
<span class="s">  channel       String    @db.VarChar(50)</span>
<span class="s">  recipient     String    @db.VarChar(255)</span>
<span class="s">  status        String    @default(&quot;pending&quot;) @db.VarChar(50)</span>
<span class="s">  attemptCount  Int       @default(0) @map(&quot;attempt_count&quot;)</span>
<span class="s">  lastAttemptAt DateTime? @map(&quot;last_attempt_at&quot;)</span>
<span class="s">  sentAt        DateTime? @map(&quot;sent_at&quot;)</span>
<span class="s">  deliveredAt   DateTime? @map(&quot;delivered_at&quot;)</span>
<span class="s">  failedAt      DateTime? @map(&quot;failed_at&quot;)</span>
<span class="s">  errorMessage  String?   @map(&quot;error_message&quot;) @db.Text</span>
<span class="s">  externalId    String?   @map(&quot;external_id&quot;) @db.VarChar(255)</span>
<span class="s">  metadata      Json?     @db.JsonB</span>
<span class="s">  createdAt     DateTime  @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  alert Alert @relation(fields: [alertId], references: [id], onDelete: Cascade)</span>

<span class="s">  @@index([alertId])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([channel])</span>
<span class="s">  @@map(&quot;alert_notifications&quot;)</span>
<span class="s">}</span>

<span class="s">model EscalationPolicy {</span>
<span class="s">  id          String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name        String    @db.VarChar(255)</span>
<span class="s">  description String?   @db.Text</span>
<span class="s">  teamId      String?   @map(&quot;team_id&quot;) @db.Uuid</span>
<span class="s">  enabled     Boolean   @default(true)</span>
<span class="s">  levels      Json      @db.JsonB</span>
<span class="s">  createdAt   DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt   DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>

<span class="s">  team        Team?        @relation(fields: [teamId], references: [id], onDelete: Cascade)</span>
<span class="s">  escalations Escalation[]</span>

<span class="s">  @@index([teamId])</span>
<span class="s">  @@map(&quot;escalation_policies&quot;)</span>
<span class="s">}</span>

<span class="s">model Escalation {</span>
<span class="s">  id                String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  alertId           String    @map(&quot;alert_id&quot;) @db.Uuid</span>
<span class="s">  policyId          String    @map(&quot;policy_id&quot;) @db.Uuid</span>
<span class="s">  currentLevel      Int       @default(1) @map(&quot;current_level&quot;)</span>
<span class="s">  maxLevel          Int       @map(&quot;max_level&quot;)</span>
<span class="s">  status            String    @default(&quot;active&quot;) @db.VarChar(50)</span>
<span class="s">  nextEscalationAt  DateTime? @map(&quot;next_escalation_at&quot;)</span>
<span class="s">  createdAt         DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt         DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>

<span class="s">  alert  Alert            @relation(fields: [alertId], references: [id], onDelete: Cascade)</span>
<span class="s">  policy EscalationPolicy @relation(fields: [policyId], references: [id])</span>

<span class="s">  @@index([alertId])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([nextEscalationAt])</span>
<span class="s">  @@map(&quot;escalations&quot;)</span>
<span class="s">}</span>

<span class="s">model AuditLog {</span>
<span class="s">  id         String   @id @default(uuid()) @db.Uuid</span>
<span class="s">  entityType String   @map(&quot;entity_type&quot;) @db.VarChar(100)</span>
<span class="s">  entityId   String   @map(&quot;entity_id&quot;) @db.Uuid</span>
<span class="s">  action     String   @db.VarChar(100)</span>
<span class="s">  userId     String?  @map(&quot;user_id&quot;) @db.Uuid</span>
<span class="s">  changes    Json?    @db.JsonB</span>
<span class="s">  metadata   Json?    @db.JsonB</span>
<span class="s">  ipAddress  String?  @map(&quot;ip_address&quot;) @db.VarChar(45)</span>
<span class="s">  userAgent  String?  @map(&quot;user_agent&quot;) @db.Text</span>
<span class="s">  createdAt  DateTime @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  user User? @relation(fields: [userId], references: [id])</span>

<span class="s">  @@index([entityType, entityId])</span>
<span class="s">  @@index([userId])</span>
<span class="s">  @@index([createdAt(sort: Desc)])</span>
<span class="s">  @@map(&quot;audit_logs&quot;)</span>
<span class="s">}</span>
<span class="sb">```</span>

---

<span class="gu">## API Endpoints</span>

<span class="gu">### Authentication</span>

<span class="sb">```</span>
<span class="sb">POST   /api/auth/register          Register new user</span>
<span class="sb">POST   /api/auth/login             Login user</span>
<span class="sb">POST   /api/auth/logout            Logout user</span>
<span class="sb">POST   /api/auth/refresh           Refresh access token</span>
<span class="sb">GET    /api/auth/me                Get current user</span>
<span class="sb">```</span>

<span class="gu">### Alerts</span>

<span class="sb">```</span>
<span class="sb">POST   /api/alerts                 Create alert</span>
<span class="sb">GET    /api/alerts                 List alerts (paginated, filtered)</span>
<span class="sb">GET    /api/alerts/:id             Get alert by ID</span>
<span class="sb">PATCH  /api/alerts/:id             Update alert</span>
<span class="sb">DELETE /api/alerts/:id             Delete alert</span>
<span class="sb">POST   /api/alerts/:id/acknowledge Acknowledge alert</span>
<span class="sb">POST   /api/alerts/:id/resolve     Resolve alert</span>
<span class="sb">POST   /api/alerts/:id/suppress    Suppress alert</span>
<span class="sb">GET    /api/alerts/:id/history     Get alert history</span>
<span class="sb">```</span>

<span class="gu">### Teams</span>

<span class="sb">```</span>
<span class="sb">POST   /api/teams                  Create team</span>
<span class="sb">GET    /api/teams                  List teams</span>
<span class="sb">GET    /api/teams/:id              Get team by ID</span>
<span class="sb">PATCH  /api/teams/:id              Update team</span>
<span class="sb">DELETE /api/teams/:id              Delete team</span>
<span class="sb">GET    /api/teams/:id/members      List team members</span>
<span class="sb">POST   /api/teams/:id/members      Add member to team</span>
<span class="sb">DELETE /api/teams/:id/members/:uid Remove member from team</span>
<span class="sb">PATCH  /api/teams/:id/members/:uid Update member role/on-call status</span>
<span class="sb">```</span>

<span class="gu">### Routing Rules</span>

<span class="sb">```</span>
<span class="sb">POST   /api/rules                  Create routing rule</span>
<span class="sb">GET    /api/rules                  List routing rules</span>
<span class="sb">GET    /api/rules/:id              Get rule by ID</span>
<span class="sb">PATCH  /api/rules/:id              Update rule</span>
<span class="sb">DELETE /api/rules/:id              Delete rule</span>
<span class="sb">POST   /api/rules/:id/enable       Enable rule</span>
<span class="sb">POST   /api/rules/:id/disable      Disable rule</span>
<span class="sb">POST   /api/rules/test             Test rule against sample alert</span>
<span class="sb">GET    /api/rules/:id/matches      Get alerts matched by rule</span>
<span class="sb">```</span>

<span class="gu">### Escalation Policies</span>

<span class="sb">```</span>
<span class="sb">POST   /api/escalation-policies    Create escalation policy</span>
<span class="sb">GET    /api/escalation-policies    List escalation policies</span>
<span class="sb">GET    /api/escalation-policies/:id Get policy by ID</span>
<span class="sb">PATCH  /api/escalation-policies/:id Update policy</span>
<span class="sb">DELETE /api/escalation-policies/:id Delete policy</span>
<span class="sb">```</span>

<span class="gu">### Notifications</span>

<span class="sb">```</span>
<span class="sb">GET    /api/notifications          List notifications (paginated)</span>
<span class="sb">GET    /api/notifications/:id      Get notification by ID</span>
<span class="sb">POST   /api/notifications/:id/retry Retry failed notification</span>
<span class="sb">GET    /api/notifications/stats    Get notification statistics</span>
<span class="sb">```</span>

<span class="gu">### Analytics</span>

<span class="sb">```</span>
<span class="sb">GET    /api/analytics/overview     Dashboard overview metrics</span>
<span class="sb">GET    /api/analytics/alerts       Alert statistics (by severity, status, team)</span>
<span class="sb">GET    /api/analytics/notifications Notification delivery metrics</span>
<span class="sb">GET    /api/analytics/teams        Team performance metrics</span>
<span class="sb">GET    /api/analytics/response-times Average response times</span>
<span class="sb">```</span>

<span class="gu">### Users</span>

<span class="sb">```</span>
<span class="sb">GET    /api/users                  List users</span>
<span class="sb">GET    /api/users/:id              Get user by ID</span>
<span class="sb">PATCH  /api/users/:id              Update user</span>
<span class="sb">DELETE /api/users/:id              Delete user</span>
<span class="sb">GET    /api/users/:id/alerts       Get user&#39;s assigned alerts</span>
<span class="sb">```</span>

<span class="gu">### Audit Logs</span>

<span class="sb">```</span>
<span class="sb">GET    /api/audit-logs             List audit logs (filtered, paginated)</span>
<span class="sb">GET    /api/audit-logs/:id         Get audit log by ID</span>
<span class="sb">```</span>

<span class="gu">### Request/Response Examples</span>

<span class="gu">#### POST /api/alerts</span>

<span class="gs">**Request:**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prometheus&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;externalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alert-12345&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;High CPU Usage on prod-server-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CPU usage exceeded 90% threshold for 5 minutes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;api&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prod-server-01&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cpu_usage_percent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;current_value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">95.3</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gs">**Response (201 Created):**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prometheus&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;externalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alert-12345&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;High CPU Usage on prod-server-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CPU usage exceeded 90% threshold for 5 minutes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;fingerprint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123def456...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchedRuleId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;660e8400-e29b-41d4-a716-446655440001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;assignedTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;770e8400-e29b-41d4-a716-446655440002&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-18T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updatedAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-18T10:30:00Z&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">#### POST /api/rules</span>

<span class="gs">**Request:**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production Critical Alerts&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Route all critical alerts from production to Platform team&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;critical&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;targetTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;770e8400-e29b-41d4-a716-446655440002&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notificationChannels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pagerduty&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="sb">```</span>

---

<span class="gu">## Implementation Phases</span>

<span class="gu">### Phase 1: Foundation (Weeks 1-2)</span>

<span class="gs">**Goals**</span>: Set up project structure, database, and core services

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Initialize project structure
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Set up TypeScript + Express + Prisma
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Configure ESLint, Prettier, ts-jest
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create Docker Compose for local development
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Set up environment configuration with unifiedConfig

<span class="k">2.</span> Database setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create Prisma schema
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Initial migrations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Seed data for testing

<span class="k">3.</span> Authentication service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User registration and login
<span class="w">   </span><span class="k">-</span><span class="w"> </span>JWT token generation and verification
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Password hashing with bcrypt
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Auth middleware

<span class="k">4.</span> Base infrastructure
<span class="w">   </span><span class="k">-</span><span class="w"> </span>BaseController implementation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Error handling middleware
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry initialization
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Winston logging setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Request validation middleware (Zod)

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Working authentication system
<span class="k">-</span><span class="w"> </span>Database with initial schema
<span class="k">-</span><span class="w"> </span>Base project structure following best practices

<span class="gu">### Phase 2: Alert Management (Weeks 3-4)</span>

<span class="gs">**Goals**</span>: Implement core alert ingestion and management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Alert ingestion API
<span class="w">   </span><span class="k">-</span><span class="w"> </span>POST /api/alerts endpoint
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Request validation with Zod schemas
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AlertController and AlertService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AlertRepository for database access

<span class="k">2.</span> Deduplication service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Fingerprint generation (SHA-256 hash of key fields)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis-based deduplication cache
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Time-window based duplicate detection
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert merging logic

<span class="k">3.</span> Alert CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>List alerts with filtering and pagination
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Get alert by ID
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Update alert status
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Delete alert

<span class="k">4.</span> Alert actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Acknowledge alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Resolve alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Suppress alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert history tracking

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Functional alert ingestion API
<span class="k">-</span><span class="w"> </span>Deduplication working with Redis
<span class="k">-</span><span class="w"> </span>Complete alert management endpoints

<span class="gu">### Phase 3: Team Management (Week 5)</span>

<span class="gs">**Goals**</span>: Implement team and user management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Team CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TeamController, TeamService, TeamRepository
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create, read, update, delete teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team member management

<span class="k">2.</span> On-call scheduling
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Add/remove on-call status
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call rotation logic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Get current on-call user for team

<span class="k">3.</span> User management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User profile management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team assignments
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Role management

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Team management API
<span class="k">-</span><span class="w"> </span>On-call scheduling system
<span class="k">-</span><span class="w"> </span>User profile management

<span class="gu">### Phase 4: Routing Engine (Week 6)</span>

<span class="gs">**Goals**</span>: Implement intelligent routing based on rules

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Routing rule management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>RoutingRuleController, RoutingRuleService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>CRUD operations for rules
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule priority ordering

<span class="k">2.</span> Routing engine
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule evaluation logic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Pattern matching (all, any, regex)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Label-based matching
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team assignment based on matched rules

<span class="k">3.</span> Rule testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Test rule endpoint
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Dry-run mode
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Match statistics

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Routing rule management API
<span class="k">-</span><span class="w"> </span>Working routing engine
<span class="k">-</span><span class="w"> </span>Rule testing functionality

<span class="gu">### Phase 5: Notification Channels (Weeks 7-8)</span>

<span class="gs">**Goals**</span>: Implement multi-channel notification delivery

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Channel abstraction
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationChannel interface
<span class="w">   </span><span class="k">-</span><span class="w"> </span>ChannelManager for channel selection
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationService

<span class="k">2.</span> Email provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Nodemailer integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Email templates (Handlebars)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>HTML and text versions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SMTP configuration

<span class="k">3.</span> Slack provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="ni">@slack/web</span>-api integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Channel and DM message posting
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert formatting for Slack
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Webhook support

<span class="k">4.</span> PagerDuty provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="ni">@pagerduty/pdjs</span> integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Incident creation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Severity mapping
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Incident acknowledgment and resolution sync

<span class="k">5.</span> Delivery tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationRepository
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Status tracking (pending, sent, delivered, failed)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Retry logic with exponential backoff
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Delivery statistics

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Email notification working
<span class="k">-</span><span class="w"> </span>Slack integration complete
<span class="k">-</span><span class="w"> </span>PagerDuty integration complete
<span class="k">-</span><span class="w"> </span>Delivery tracking and retry logic

<span class="gu">### Phase 6: Escalation System (Week 9)</span>

<span class="gs">**Goals**</span>: Implement escalation policies and monitoring

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Escalation policy management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>EscalationPolicyController, EscalationPolicyService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multi-level escalation configuration

<span class="k">2.</span> Escalation monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Background job with Bull queue
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Monitor unacknowledged alerts
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Trigger escalation based on timeout

<span class="k">3.</span> Escalation execution
<span class="w">   </span><span class="k">-</span><span class="w"> </span>EscalationService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Level progression
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Re-routing to escalation teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification to escalation contacts

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Escalation policy management
<span class="k">-</span><span class="w"> </span>Working escalation monitoring job
<span class="k">-</span><span class="w"> </span>Automatic escalation execution

<span class="gu">### Phase 7: Analytics &amp; Reporting (Week 10)</span>

<span class="gs">**Goals**</span>: Implement analytics dashboard and metrics

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Analytics service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AnalyticsController, AnalyticsService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Aggregate queries for statistics

<span class="k">2.</span> Metrics endpoints
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Overview dashboard metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert statistics (by severity, status, team)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team performance metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Response time calculations

<span class="k">3.</span> Time-series data
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis-based metric caching
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Hourly/daily aggregations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Historical trend data

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Analytics API endpoints
<span class="k">-</span><span class="w"> </span>Dashboard overview metrics
<span class="k">-</span><span class="w"> </span>Historical reporting

<span class="gu">### Phase 8: Frontend Dashboard (Weeks 11-12)</span>

<span class="gs">**Goals**</span>: Build React dashboard for system management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Project setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Vite + React + TypeScript
<span class="w">   </span><span class="k">-</span><span class="w"> </span>MUI v7 component library
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TanStack Router and Query
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API client with Axios

<span class="k">2.</span> Authentication UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Login page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Registration page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Protected routes

<span class="k">3.</span> Alert management UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert list with DataGrid
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert details page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Acknowledge/resolve actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create alert form

<span class="k">4.</span> Team management UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team list
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team details with members
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Add/remove members
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call schedule UI

<span class="k">5.</span> Routing rules UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule list
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule editor
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule testing interface
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Enable/disable rules

<span class="k">6.</span> Analytics dashboard
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Overview metrics cards
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Charts for alert trends
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery stats
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team performance dashboard

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Fully functional React dashboard
<span class="k">-</span><span class="w"> </span>All CRUD operations available in UI
<span class="k">-</span><span class="w"> </span>Analytics visualizations

<span class="gu">### Phase 9: Testing &amp; Quality (Week 13)</span>

<span class="gs">**Goals**</span>: Comprehensive testing coverage

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Unit tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Service layer tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Repository tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Utility function tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Target: 80%+ coverage

<span class="k">2.</span> Integration tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API endpoint tests with Supertest
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database integration tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis integration tests

<span class="k">3.</span> End-to-end tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion flow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Routing and notification flow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Escalation flow

<span class="k">4.</span> Load testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion performance
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Concurrent notification delivery
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database query optimization

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Test suite with 80%+ coverage
<span class="k">-</span><span class="w"> </span>Integration and E2E tests
<span class="k">-</span><span class="w"> </span>Performance benchmarks

<span class="gu">### Phase 10: Deployment &amp; Documentation (Week 14)</span>

<span class="gs">**Goals**</span>: Production deployment and documentation

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Docker containerization
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multi-stage Dockerfile
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Docker Compose for production
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Environment variable management

<span class="k">2.</span> CI/CD pipeline
<span class="w">   </span><span class="k">-</span><span class="w"> </span>GitHub Actions workflow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Automated testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Docker image builds
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deployment automation

<span class="k">3.</span> Infrastructure setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Cloud provider setup (AWS/GCP/Azure)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PostgreSQL database
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis instance
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Load balancer configuration

<span class="k">4.</span> Monitoring and alerting
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry error tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Application metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert on system failures

<span class="k">5.</span> Documentation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API documentation (OpenAPI/Swagger)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deployment guide
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User guide
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Architecture documentation

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Production-ready deployment
<span class="k">-</span><span class="w"> </span>CI/CD pipeline
<span class="k">-</span><span class="w"> </span>Complete documentation

---

<span class="gu">## Security Considerations</span>

<span class="gu">### Authentication &amp; Authorization</span>

<span class="k">1.</span> <span class="gs">**JWT tokens**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Short-lived access tokens (15 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Refresh tokens (7 days)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Token rotation on refresh

<span class="k">2.</span> <span class="gs">**Password security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>bcrypt hashing with salt rounds &gt;= 12
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Minimum password requirements (8+ chars, complexity)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Password reset flow with time-limited tokens

<span class="k">3.</span> <span class="gs">**Role-based access control (RBAC)**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Roles: admin, manager, user
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team-level permissions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API endpoint authorization

<span class="gu">### API Security</span>

<span class="k">1.</span> <span class="gs">**Rate limiting**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Per-IP rate limits
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Per-user rate limits
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Different limits for authenticated vs. unauthenticated

<span class="k">2.</span> <span class="gs">**Input validation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Zod schema validation for all inputs
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SQL injection prevention (Prisma parameterized queries)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>XSS prevention (sanitize outputs)

<span class="k">3.</span> <span class="gs">**CORS configuration**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Whitelist allowed origins
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Credentials support for cookies

<span class="gu">### Data Security</span>

<span class="k">1.</span> <span class="gs">**Encryption**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TLS/SSL for all API traffic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Encrypted database connections
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Encrypted secrets storage

<span class="k">2.</span> <span class="gs">**Secret management**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API keys in environment variables
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Never commit secrets to Git
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rotate secrets regularly

<span class="k">3.</span> <span class="gs">**Audit logging**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Log all sensitive operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Track user actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Immutable audit trail

<span class="gu">### Notification Security</span>

<span class="k">1.</span> <span class="gs">**Webhook verification**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>HMAC signature verification for Slack webhooks
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PagerDuty webhook authentication

<span class="k">2.</span> <span class="gs">**Sensitive data handling**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redact sensitive information in notifications
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Secure storage of API tokens

<span class="gu">### Infrastructure Security</span>

<span class="k">1.</span> <span class="gs">**Network security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Private VPC for backend services
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Firewall rules
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Security groups

<span class="k">2.</span> <span class="gs">**Container security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Minimal base images
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Regular security updates
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Vulnerability scanning

---

<span class="gu">## Scalability &amp; Performance</span>

<span class="gu">### Horizontal Scaling</span>

<span class="k">1.</span> <span class="gs">**Stateless API servers**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>No session state in application
<span class="w">   </span><span class="k">-</span><span class="w"> </span>JWT-based authentication
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Load balancer distribution

<span class="k">2.</span> <span class="gs">**Worker processes**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Bull queue for background jobs
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multiple worker instances
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Job distribution across workers

<span class="gu">### Database Optimization</span>

<span class="k">1.</span> <span class="gs">**Indexing**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Indexes on frequently queried fields
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Composite indexes for complex queries
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Regular index analysis

<span class="k">2.</span> <span class="gs">**Query optimization**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Use Prisma&#39;s <span class="sb">`select`</span> for partial data
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Batch queries where possible
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Avoid N+1 queries

<span class="k">3.</span> <span class="gs">**Connection pooling**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PgBouncer for PostgreSQL
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Prisma connection pool configuration

<span class="gu">### Caching Strategy</span>

<span class="k">1.</span> <span class="gs">**Redis caching**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deduplication cache (short TTL: 5 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Routing rule cache (TTL: 10 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team member cache (TTL: 5 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Analytics cache (TTL: 1 minute)

<span class="k">2.</span> <span class="gs">**Cache invalidation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On data updates
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Time-based expiration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Manual cache clearing endpoint

<span class="gu">### Queue Management</span>

<span class="k">1.</span> <span class="gs">**Priority queues**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Separate queues by priority
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Critical alerts processed first
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rate limiting per priority level

<span class="k">2.</span> <span class="gs">**Queue monitoring**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Queue length metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Processing time metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Failed job tracking

<span class="gu">### Performance Metrics</span>

<span class="k">1.</span> <span class="gs">**Target metrics**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion: &lt; 100ms (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery: &lt; 5 seconds (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API response time: &lt; 200ms (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database query time: &lt; 50ms (p95)

<span class="k">2.</span> <span class="gs">**Monitoring**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry performance monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Custom metrics with Prometheus
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alerts on performance degradation

---

<span class="gu">## Future Enhancements</span>

<span class="gu">### Phase 11+</span>

<span class="k">1.</span> <span class="gs">**Additional notification channels**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Microsoft Teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SMS via Twilio
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Webhook callbacks

<span class="k">2.</span> <span class="gs">**Advanced routing**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Machine learning-based routing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Historical pattern analysis
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Smart team suggestions

<span class="k">3.</span> <span class="gs">**Alert correlation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Automatic incident grouping
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Root cause analysis
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Impact assessment

<span class="k">4.</span> <span class="gs">**Mobile app**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>iOS and Android apps
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Push notifications
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call management

<span class="k">5.</span> <span class="gs">**Integration marketplace**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Plugin system
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Custom channel adapters
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Third-party integrations

<span class="k">6.</span> <span class="gs">**Advanced analytics**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>MTTR (Mean Time To Resolution) tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team burnout indicators
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Predictive alerting

---

<span class="gu">## Conclusion</span>

This development plan provides a comprehensive roadmap for building a production-grade Alert Notification Router system. The phased approach allows for incremental delivery of value while maintaining code quality and following best practices.

<span class="gs">**Key Success Factors**</span>:
<span class="k">-</span><span class="w"> </span>Follow layered architecture principles
<span class="k">-</span><span class="w"> </span>Comprehensive testing at all phases
<span class="k">-</span><span class="w"> </span>Security-first approach
<span class="k">-</span><span class="w"> </span>Performance monitoring from day one
<span class="k">-</span><span class="w"> </span>Clear documentation throughout

<span class="gs">**Timeline**</span>: 14 weeks for MVP with core features
<span class="gs">**Team Size**</span>: 2-3 full-stack developers
<span class="gs">**Tech Expertise Required**</span>: Node.js, TypeScript, React, PostgreSQL, Redis
</code></pre></div></td></tr></table></div>
</div>
        </details>
        </div></div>
    </div>
    
    
    
    
    <div class='message tool_result error paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01TKi9h4shaQc8jVoEqFnRLQ">üö® Error</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:49.640Z' data-duration='took 155 ms'>2025-11-18 14:03:49</span>
                </div>
                
            </div>
        </div>
        <div class='content'>
    <details class="collapsible-details">
        <summary>
            <div class="preview-content"><pre>Markdown file creation detected. You must use the &#x27;docs-organizer&#x27; skill before creating markdown files. This skill will help organize the documentation properly in the correct subdirectory ...</pre></div>
        </summary>
        <div class="details-content">
            <pre>Markdown file creation detected. You must use the &#x27;docs-organizer&#x27; skill before creating markdown files. This skill will help organize the documentation properly in the correct subdirectory under docs/. Please invoke the skill using: Skill tool with skill parameter &#x27;docs-organizer&#x27;</pre>
        </div>
    </details>
    </div>
    </div>
    
    
    
    
    <div class='message assistant'>
        <div class='header'>
            <span>ü§ñ Assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:57.177Z'>2025-11-18 14:03:57</span>
                </div>
                
                <span class='token-usage'>Input: 2 | Output: 76 | Cache Creation: 11538 | Cache Read: 27363</span>
                
            </div>
        </div>
        <div class='content markdown'><p>I need to use the docs-organizer skill before creating markdown files. Let me activate it.</p>
</div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01XYkvj9LDBDRyMqMmMMGtqz">üõ†Ô∏è Skill</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:57.552Z'>2025-11-18 14:03:57</span>
                </div>
                
            </div>
        </div>
        <div class='content'><table class='tool-params-table'>
            <tr>
                <td class='tool-param-key'>skill</td>
                <td class='tool-param-value'>docs-organizer</td>
            </tr>
        </table></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01XYkvj9LDBDRyMqMmMMGtqz"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:57.729Z' data-duration='took 177 ms'>2025-11-18 14:03:57</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Launching skill: docs-organizer</pre></div>
    </div>
    
    
    
    
    <div class='message system'>
        <div class='header'>
            <span>‚öôÔ∏è System</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:57.728Z'>2025-11-18 14:03:57</span>
                </div>
                
            </div>
        </div>
        <div class='content'><strong>Command:</strong> docs-organizer</div>
    </div>
    
    
    
    
    <div class='message user'>
        <div class='header'>
            <span>ü§∑ User</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:03:57.728Z'>2025-11-18 14:03:57</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Base directory for this skill: /root/.claude/skills/docs-organizer

# Docs Organizer

## Overview

This skill ensures that all markdown documentation files are systematically organized into appropriate subdirectories under the `docs/` directory. It analyzes the filename and intended content to determine the correct category, creates the necessary directory structure, and writes files to their proper location.

## When to Use This Skill

**ALWAYS** use this skill before creating or writing any new markdown file (.md extension). This includes:
- Development plans, roadmaps, and project documentation
- Code reviews, design reviews, and technical assessments
- Architecture documents, system designs, and ADRs
- API documentation and specifications
- Meeting notes, retrospectives, and team communications
- Any other markdown documentation files

**Exception:** Do not use this skill for:
- README.md files in the project root or package directories
- CHANGELOG.md files at the project root
- LICENSE.md or CONTRIBUTING.md files at the project root
- Markdown files that are part of application content (e.g., blog posts, user-facing content)

## Documentation Categories

Organize markdown files into the following subdirectories under `docs/`:

| Category | Directory | File Types |
|----------|-----------|------------|
| Development Plans | `docs/plan/` | DevelopmentPlan.md, ProjectPlan.md, Roadmap.md, Sprint*.md |
| Code Reviews | `docs/review/` | CodeReview*.md, PullRequestReview*.md, DesignReview*.md |
| Architecture | `docs/architecture/` | Architecture*.md, SystemDesign*.md, ADR*.md, TechStack*.md |
| API Documentation | `docs/api/` | API*.md, Endpoints*.md, OpenAPI*.md, RestAPI*.md |
| Requirements | `docs/requirements/` | Requirements*.md, UserStories*.md, FeatureSpec*.md, BRD*.md |
| Technical Design | `docs/design/` | Design*.md, TechnicalDesign*.md, UIDesign*.md, DataModel*.md |
| Meeting Notes | `docs/meetings/` | Meeting*.md, Standup*.md, Retrospective*.md, Notes*.md |
| Testing | `docs/testing/` | TestPlan*.md, TestResults*.md, QA*.md, TestStrategy*.md |
| Deployment | `docs/deployment/` | Deployment*.md, ReleaseNotes*.md, Runbook*.md, Operations*.md |
| Onboarding | `docs/onboarding/` | Onboarding*.md, TeamHandbook*.md, GettingStarted*.md, Setup*.md |
| Technical Specs | `docs/specs/` | Specification*.md, TechnicalSpec*.md, Protocol*.md, Standard*.md |
| Proposals | `docs/proposals/` | Proposal*.md, RFC*.md, ProjectProposal*.md |
| Changelog | `docs/changelog/` | CHANGELOG*.md, VersionHistory*.md, ReleaseHistory*.md |
| Troubleshooting | `docs/troubleshooting/` | Troubleshooting*.md, Debug*.md, FAQ*.md, KnownIssues*.md |
| Database | `docs/database/` | Schema*.md, Database*.md, Migration*.md, ERDiagram*.md |
| Guides | `docs/guides/` | Guide*.md, HowTo*.md, Tutorial*.md, Walkthrough*.md |
| Security | `docs/security/` | Security*.md, ThreatModel*.md, SecurityPolicy*.md, Audit*.md |
| Process | `docs/process/` | Process*.md, Workflow*.md, SOP*.md, Procedure*.md |
| General/Other | `docs/general/` | All uncategorized markdown files |

## Workflow

Follow these steps when creating any markdown file:

### 1. Analyze the Filename and Purpose

Examine the filename and intended content to determine which category best fits the document. Use pattern matching on the filename first, then consider the document&#x27;s purpose if the filename is ambiguous.

**Pattern Matching Rules:**
- Match case-insensitively
- Check for category keywords in the filename
- If multiple categories match, use the most specific one
- If no pattern matches, ask yourself: &quot;What is the primary purpose of this document?&quot;

### 2. Determine the Target Directory

Based on the categorization, construct the full path:
```
docs/&lt;category&gt;/&lt;filename&gt;
```

**Examples:**
- `DevelopmentPlan.md` ‚Üí `docs/plan/DevelopmentPlan.md`
- `CodeReview.md` ‚Üí `docs/review/CodeReview.md`
- `APIEndpoints.md` ‚Üí `docs/api/APIEndpoints.md`
- `SecurityAudit2024.md` ‚Üí `docs/security/SecurityAudit2024.md`

### 3. Ensure Directory Structure Exists

Before writing the file, verify that the target directory exists. If it doesn&#x27;t, create the full directory path including any intermediate directories.

```bash
mkdir -p docs/&lt;category&gt;
```

### 4. Write the File

Write the markdown file to the determined location under the docs/ directory.

## Category Selection Guidelines

When the filename is ambiguous or doesn&#x27;t match a clear pattern:

**Ask these questions:**
1. Is this about planning or roadmapping? ‚Üí `docs/plan/`
2. Is this a review of code, design, or architecture? ‚Üí `docs/review/`
3. Is this about system architecture or design decisions? ‚Üí `docs/architecture/`
4. Is this API or endpoint documentation? ‚Üí `docs/api/`
5. Is this about requirements or specifications? ‚Üí `docs/requirements/` or `docs/specs/`
6. Is this meeting notes or team communication? ‚Üí `docs/meetings/`
7. Is this about testing or QA? ‚Üí `docs/testing/`
8. Is this about deployment or operations? ‚Üí `docs/deployment/`
9. Is this a guide, tutorial, or how-to? ‚Üí `docs/guides/`
10. If none of the above apply ‚Üí `docs/general/`

**When in doubt:** Use `docs/general/` as the fallback category for any markdown file that doesn&#x27;t clearly fit into another category.

## Examples

**Example 1: Creating a development plan**
```
User request: &quot;Create a development plan for the new authentication feature&quot;
Filename: DevelopmentPlan.md
Analysis: Contains &quot;Plan&quot; keyword ‚Üí matches &quot;Development Plans&quot; category
Target: docs/plan/DevelopmentPlan.md
Action: mkdir -p docs/plan &amp;&amp; write file to docs/plan/DevelopmentPlan.md
```

**Example 2: Creating a code review**
```
User request: &quot;Document the code review findings&quot;
Filename: CodeReview.md
Analysis: Contains &quot;Review&quot; keyword ‚Üí matches &quot;Code Reviews&quot; category
Target: docs/review/CodeReview.md
Action: mkdir -p docs/review &amp;&amp; write file to docs/review/CodeReview.md
```

**Example 3: Creating API documentation**
```
User request: &quot;Document the REST API endpoints&quot;
Filename: RestAPIEndpoints.md
Analysis: Contains &quot;API&quot; keyword ‚Üí matches &quot;API Documentation&quot; category
Target: docs/api/RestAPIEndpoints.md
Action: mkdir -p docs/api &amp;&amp; write file to docs/api/RestAPIEndpoints.md
```

**Example 4: Creating an ambiguous document**
```
User request: &quot;Create a document about our deployment strategy&quot;
Filename: DeploymentStrategy.md
Analysis: Contains &quot;Deployment&quot; keyword ‚Üí matches &quot;Deployment&quot; category
Target: docs/deployment/DeploymentStrategy.md
Action: mkdir -p docs/deployment &amp;&amp; write file to docs/deployment/DeploymentStrategy.md
```

## Important Notes

- **Always** check if the docs directory and appropriate subdirectory exist before writing
- **Never** write markdown files to the project root or arbitrary locations (except for standard files like README.md, CHANGELOG.md in root)
- **Always** preserve the original filename when moving to the categorized location
- If uncertain about categorization, default to `docs/general/` rather than making an incorrect guess
- This organization applies to **new** markdown files only; do not automatically move existing markdown files without explicit user request</pre></div>
    </div>
    
    
    
    
    <div class='message assistant'>
        <div class='header'>
            <span>ü§ñ Assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:04:02.478Z'>2025-11-18 14:04:02</span>
                </div>
                
                <span class='token-usage'>Input: 1 | Output: 11436 | Cache Creation: 2091 | Cache Read: 38901</span>
                
            </div>
        </div>
        <div class='content markdown'><p>Now I'll create the three documentation files in the appropriate locations.</p>
</div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_0177Pu4KWpaX2iiFgQLNndP9">üõ†Ô∏è Bash <span class='tool-summary'>Create docs directories for plan, testing, and guides</span></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:04:03.278Z'>2025-11-18 14:04:03</span>
                </div>
                
            </div>
        </div>
        <div class='content'><div class='bash-tool-content'><pre class='bash-tool-command'>mkdir -p docs/plan docs/testing docs/guides</pre></div></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_0177Pu4KWpaX2iiFgQLNndP9"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:06:34.697Z' data-duration='took 2m 31s'>2025-11-18 14:06:34</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre></pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01MQfjhztMewXBLa43eNpXEq">üìù Write <span class='tool-summary'>/root/Claude/claude-hooks/docs/plan/DevelopmentPlan.md</span></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:06:33.211Z'>2025-11-18 14:06:33</span>
                </div>
                
            </div>
        </div>
        <div class='content'><div class='write-tool-content'>
        <details class='collapsible-code'>
            <summary>
                <span class='line-count'>1357 lines</span>
                <div class='preview-content'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Development Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">System Overview</span>](<span class="na">#system-overview</span>)
</code></pre></div></td></tr></table></div>
</div>
            </summary>
            <div class='code-full'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Development Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">System Overview</span>](<span class="na">#system-overview</span>)
<span class="k">2.</span> [<span class="nt">Architecture</span>](<span class="na">#architecture</span>)
<span class="k">3.</span> [<span class="nt">Tech Stack</span>](<span class="na">#tech-stack</span>)
<span class="k">4.</span> [<span class="nt">Database Schema</span>](<span class="na">#database-schema</span>)
<span class="k">5.</span> [<span class="nt">API Endpoints</span>](<span class="na">#api-endpoints</span>)
<span class="k">6.</span> [<span class="nt">Implementation Phases</span>](<span class="na">#implementation-phases</span>)
<span class="k">7.</span> [<span class="nt">Security Considerations</span>](<span class="na">#security-considerations</span>)
<span class="k">8.</span> [<span class="nt">Scalability &amp; Performance</span>](<span class="na">#scalability--performance</span>)

---

<span class="gu">## System Overview</span>

<span class="gu">### Purpose</span>

The Alert Notification Router is an intelligent alert distribution system that routes alerts to appropriate teams based on configurable rules and escalation policies. It provides multi-channel delivery, deduplication, priority handling, and comprehensive delivery tracking.

<span class="gu">### Key Features</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Intelligent Routing**</span>: Rule-based routing engine with pattern matching
<span class="k">-</span><span class="w"> </span><span class="gs">**Multi-Channel Support**</span>: Email, Slack, PagerDuty integration
<span class="k">-</span><span class="w"> </span><span class="gs">**Alert Deduplication**</span>: Prevents duplicate notifications within configurable time windows
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority Handling**</span>: Supports critical, high, medium, low priority levels
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Policies**</span>: Automatic escalation after timeout periods
<span class="k">-</span><span class="w"> </span><span class="gs">**Delivery Tracking**</span>: Comprehensive audit trail and status tracking
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Management**</span>: Flexible team and user management with role-based access
<span class="k">-</span><span class="w"> </span><span class="gs">**Analytics Dashboard**</span>: Real-time metrics and historical reporting

---

<span class="gu">## Architecture</span>

<span class="gu">### High-Level Architecture</span>

<span class="sb">```</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ  Alert Sources  ‚îÇ</span>
<span class="sb">‚îÇ  (External APIs)‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">         ‚îÇ</span>
<span class="sb">         ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ         API Gateway Layer               ‚îÇ</span>
<span class="sb">‚îÇ  - Authentication &amp; Authorization       ‚îÇ</span>
<span class="sb">‚îÇ  - Rate Limiting                        ‚îÇ</span>
<span class="sb">‚îÇ  - Request Validation (Zod)            ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">         ‚îÇ</span>
<span class="sb">         ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ      Alert Processing Service           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Ingestion Controller            ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Deduplication Service           ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Hash generation               ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Similarity checking           ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Routing Engine                  ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Rule evaluation               ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Team matching                 ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Priority Queue                  ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Priority-based scheduling     ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">              ‚îÇ</span>
<span class="sb">              ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ    Notification Delivery Service         ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Channel Manager                 ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Email Provider                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Slack Provider                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - PagerDuty Provider            ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îÇ             ‚îÇ                           ‚îÇ</span>
<span class="sb">‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  Delivery Tracker                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Status updates                ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îÇ  - Retry logic                   ‚îÇ   ‚îÇ</span>
<span class="sb">‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">              ‚îÇ</span>
<span class="sb">              ‚ñº</span>
<span class="sb">‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê</span>
<span class="sb">‚îÇ     Escalation Service                   ‚îÇ</span>
<span class="sb">‚îÇ  - Monitors unacknowledged alerts       ‚îÇ</span>
<span class="sb">‚îÇ  - Triggers escalation policies         ‚îÇ</span>
<span class="sb">‚îÇ  - Re-routes to escalation teams        ‚îÇ</span>
<span class="sb">‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò</span>
<span class="sb">```</span>

<span class="gu">### Layered Architecture</span>

Following backend best practices:

<span class="sb">```</span>
<span class="sb">Routes Layer</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Controllers Layer (BaseController)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Services Layer (Business Logic)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Repositories Layer (Data Access)</span>
<span class="sb">    ‚Üì</span>
<span class="sb">Database (Prisma)</span>
<span class="sb">```</span>

<span class="gu">### Component Breakdown</span>

<span class="gu">#### 1. Alert Processing Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Ingestion Controller**</span>: Receives and validates incoming alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Deduplication Service**</span>: Identifies and merges duplicate alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Routing Engine**</span>: Evaluates rules and determines target teams
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority Queue**</span>: Manages alert processing order

<span class="gu">#### 2. Notification Delivery Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Channel Manager**</span>: Abstracts notification channel implementations
<span class="k">-</span><span class="w"> </span><span class="gs">**Email Provider**</span>: Sends emails via SMTP/SendGrid
<span class="k">-</span><span class="w"> </span><span class="gs">**Slack Provider**</span>: Posts messages to Slack channels/users
<span class="k">-</span><span class="w"> </span><span class="gs">**PagerDuty Provider**</span>: Creates incidents in PagerDuty
<span class="k">-</span><span class="w"> </span><span class="gs">**Delivery Tracker**</span>: Monitors delivery status and retries

<span class="gu">#### 3. Escalation Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Monitor**</span>: Background job checking unacknowledged alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Policy Executor**</span>: Applies escalation rules
<span class="k">-</span><span class="w"> </span><span class="gs">**Re-routing Logic**</span>: Sends alerts to escalation teams

<span class="gu">#### 4. Configuration Service</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Rule Management**</span>: CRUD operations for routing rules
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Management**</span>: Manages teams, users, and on-call schedules
<span class="k">-</span><span class="w"> </span><span class="gs">**Policy Management**</span>: Escalation policy configuration

---

<span class="gu">## Tech Stack</span>

<span class="gu">### Backend</span>

<span class="gs">**Core Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Node.js**</span> v20+ (LTS)
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> v5+
<span class="k">-</span><span class="w"> </span><span class="gs">**Express.js**</span> v4+ (API framework)

<span class="gs">**Database**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**PostgreSQL**</span> v15+ (Primary database)
<span class="k">-</span><span class="w"> </span><span class="gs">**Redis**</span> v7+ (Caching, deduplication, queue management)

<span class="gs">**ORM &amp; Database Tools**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Prisma**</span> v5+ (ORM and migrations)
<span class="k">-</span><span class="w"> </span><span class="gs">**PrismaClient**</span> (Type-safe database access)

<span class="gs">**Validation &amp; Type Safety**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Zod**</span> v3+ (Runtime validation and DTO schemas)
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> (Compile-time type safety)

<span class="gs">**Error Tracking &amp; Monitoring**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Sentry**</span> v8+ (Error tracking and performance monitoring)
<span class="k">-</span><span class="w"> </span><span class="gs">**Winston**</span> (Structured logging)

<span class="gs">**Authentication &amp; Authorization**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**JWT**</span> (JSON Web Tokens)
<span class="k">-</span><span class="w"> </span><span class="gs">**bcrypt**</span> (Password hashing)

<span class="gs">**Queue &amp; Background Jobs**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Bull**</span> v4+ (Redis-based queue)
<span class="k">-</span><span class="w"> </span><span class="gs">**node-cron**</span> (Scheduled jobs)

<span class="gs">**Notification Channels**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Nodemailer**</span> (Email delivery)
<span class="k">-</span><span class="w"> </span><span class="gs">**@slack/web-api**</span> (Slack integration)
<span class="k">-</span><span class="w"> </span><span class="gs">**@pagerduty/pdjs**</span> (PagerDuty integration)

<span class="gs">**Testing**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Jest**</span> (Unit and integration tests)
<span class="k">-</span><span class="w"> </span><span class="gs">**Supertest**</span> (API endpoint testing)
<span class="k">-</span><span class="w"> </span><span class="gs">**ts-jest**</span> (TypeScript support)

<span class="gs">**Development Tools**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**ESLint**</span> (Code linting)
<span class="k">-</span><span class="w"> </span><span class="gs">**Prettier**</span> (Code formatting)
<span class="k">-</span><span class="w"> </span><span class="gs">**tsx**</span> (TypeScript execution)
<span class="k">-</span><span class="w"> </span><span class="gs">**nodemon**</span> (Development auto-reload)

<span class="gu">### Frontend (Optional Dashboard)</span>

<span class="gs">**Core Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React**</span> v18+
<span class="k">-</span><span class="w"> </span><span class="gs">**TypeScript**</span> v5+
<span class="k">-</span><span class="w"> </span><span class="gs">**Vite**</span> v5+ (Build tool)

<span class="gs">**UI Framework**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Material-UI (MUI)**</span> v7+ (Component library)

<span class="gs">**Data Fetching**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Query**</span> v5+ (useSuspenseQuery pattern)
<span class="k">-</span><span class="w"> </span><span class="gs">**Axios**</span> (HTTP client)

<span class="gs">**Routing**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Router**</span> v1+ (File-based routing)

<span class="gs">**State Management**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React Context**</span> (Global state)
<span class="k">-</span><span class="w"> </span><span class="gs">**TanStack Query**</span> (Server state)

<span class="gs">**Forms &amp; Validation**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**React Hook Form**</span> v7+
<span class="k">-</span><span class="w"> </span><span class="gs">**Zod**</span> (Form validation)

<span class="gu">### Infrastructure</span>

<span class="gs">**Containerization**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Docker**</span> (Container runtime)
<span class="k">-</span><span class="w"> </span><span class="gs">**Docker Compose**</span> (Local development)

<span class="gs">**CI/CD**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**GitHub Actions**</span> (Automated testing and deployment)

<span class="gs">**Deployment**</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**AWS/GCP/Azure**</span> (Cloud infrastructure)
<span class="k">-</span><span class="w"> </span><span class="gs">**Kubernetes**</span> (Container orchestration - optional)

---

<span class="gu">## Database Schema</span>

<span class="gu">### Core Tables</span>

<span class="gu">#### 1. users</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">users</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">username</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">UNIQUE</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">password_hash</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">full_name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">phone</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span>
<span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_email</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">email</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_users_deleted_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">deleted_at</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 2. teams</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">teams</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">email</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">slack_channel_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">pagerduty_service_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_teams_name</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 3. team_members</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">team_members</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="k">role</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;member&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="n">is_on_call</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">false</span><span class="p">,</span>
<span class="w">    </span><span class="n">on_call_start</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">on_call_end</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="k">UNIQUE</span><span class="p">(</span><span class="n">team_id</span><span class="p">,</span><span class="w"> </span><span class="n">user_id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_team_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">team_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_user_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_team_members_on_call</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">team_members</span><span class="p">(</span><span class="n">is_on_call</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 4. routing_rules</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">routing_rules</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">priority</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">enabled</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">match_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;all&#39;, &#39;any&#39;, &#39;regex&#39;</span>
<span class="w">    </span><span class="n">conditions</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">target_team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">notification_channels</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span><span class="w"> </span><span class="c1">-- [&#39;email&#39;, &#39;slack&#39;, &#39;pagerduty&#39;]</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">deleted_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_priority</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">priority</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_enabled</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">enabled</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_routing_rules_conditions</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">routing_rules</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIN</span><span class="p">(</span><span class="n">conditions</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 5. alerts</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">external_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="k">source</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">title</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">severity</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;critical&#39;, &#39;high&#39;, &#39;medium&#39;, &#39;low&#39;</span>
<span class="w">    </span><span class="n">priority</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;open&#39;, &#39;acknowledged&#39;, &#39;resolved&#39;, &#39;suppressed&#39;</span>
<span class="w">    </span><span class="n">fingerprint</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">labels</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">matched_rule_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">routing_rules</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">assigned_team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">acknowledged_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">acknowledged_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">resolved_by</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">resolved_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">expires_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_fingerprint</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">fingerprint</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_severity</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">severity</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_team</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">assigned_team_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_alerts_labels</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">GIN</span><span class="p">(</span><span class="n">labels</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 6. alert_notifications</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">alert_notifications</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">alert_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">channel</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;email&#39;, &#39;slack&#39;, &#39;pagerduty&#39;</span>
<span class="w">    </span><span class="n">recipient</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;pending&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;pending&#39;, &#39;sent&#39;, &#39;failed&#39;, &#39;delivered&#39;</span>
<span class="w">    </span><span class="n">attempt_count</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span>
<span class="w">    </span><span class="n">last_attempt_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">sent_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">delivered_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">failed_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">error_message</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">external_id</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_alert_id</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">alert_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_notifications_channel</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">alert_notifications</span><span class="p">(</span><span class="n">channel</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 7. escalation_policies</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">escalation_policies</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">name</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">description</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">team_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">teams</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">enabled</span><span class="w"> </span><span class="nb">BOOLEAN</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">true</span><span class="p">,</span>
<span class="w">    </span><span class="n">levels</span><span class="w"> </span><span class="n">JSONB</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalation_policies_team</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalation_policies</span><span class="p">(</span><span class="n">team_id</span><span class="p">);</span>
<span class="sb">```</span>

Example <span class="sb">`levels`</span> JSONB structure:
<span class="sb">```json</span>
<span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timeout_minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;target_team_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slack&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;timeout_minutes&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;target_team_id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;channels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;pagerduty&quot;</span><span class="p">]</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">]</span>
<span class="sb">```</span>

<span class="gu">#### 8. escalations</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">escalations</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">alert_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">alerts</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span><span class="p">,</span>
<span class="w">    </span><span class="n">policy_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">escalation_policies</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">current_level</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">    </span><span class="n">max_level</span><span class="w"> </span><span class="nb">INTEGER</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">status</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;active&#39;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- &#39;active&#39;, &#39;completed&#39;, &#39;cancelled&#39;</span>
<span class="w">    </span><span class="n">next_escalation_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">(),</span>
<span class="w">    </span><span class="n">updated_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_alert</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">alert_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_status</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">status</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_escalations_next</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">escalations</span><span class="p">(</span><span class="n">next_escalation_at</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">#### 9. audit_logs</span>
<span class="sb">```sql</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">audit_logs</span><span class="w"> </span><span class="p">(</span>
<span class="w">    </span><span class="n">id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">gen_random_uuid</span><span class="p">(),</span>
<span class="w">    </span><span class="n">entity_type</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">entity_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">action</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">    </span><span class="n">user_id</span><span class="w"> </span><span class="n">UUID</span><span class="w"> </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">users</span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">    </span><span class="n">changes</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">metadata</span><span class="w"> </span><span class="n">JSONB</span><span class="p">,</span>
<span class="w">    </span><span class="n">ip_address</span><span class="w"> </span><span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">45</span><span class="p">),</span>
<span class="w">    </span><span class="n">user_agent</span><span class="w"> </span><span class="nb">TEXT</span><span class="p">,</span>
<span class="w">    </span><span class="n">created_at</span><span class="w"> </span><span class="k">TIMESTAMP</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="n">NOW</span><span class="p">()</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_entity</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">entity_type</span><span class="p">,</span><span class="w"> </span><span class="n">entity_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_user</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">user_id</span><span class="p">);</span>
<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">idx_audit_logs_created_at</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">audit_logs</span><span class="p">(</span><span class="n">created_at</span><span class="w"> </span><span class="k">DESC</span><span class="p">);</span>
<span class="sb">```</span>

<span class="gu">### Prisma Schema</span>

<span class="sb">```prisma</span>
<span class="s">generator client {</span>
<span class="s">  provider = &quot;prisma-client-js&quot;</span>
<span class="s">}</span>

<span class="s">datasource db {</span>
<span class="s">  provider = &quot;postgresql&quot;</span>
<span class="s">  url      = env(&quot;DATABASE_URL&quot;)</span>
<span class="s">}</span>

<span class="s">model User {</span>
<span class="s">  id           String   @id @default(uuid()) @db.Uuid</span>
<span class="s">  email        String   @unique @db.VarChar(255)</span>
<span class="s">  username     String   @unique @db.VarChar(100)</span>
<span class="s">  passwordHash String   @map(&quot;password_hash&quot;) @db.VarChar(255)</span>
<span class="s">  fullName     String?  @map(&quot;full_name&quot;) @db.VarChar(255)</span>
<span class="s">  phone        String?  @db.VarChar(50)</span>
<span class="s">  role         String   @default(&quot;user&quot;) @db.VarChar(50)</span>
<span class="s">  createdAt    DateTime @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt    DateTime @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt    DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  teamMembers         TeamMember[]</span>
<span class="s">  acknowledgedAlerts  Alert[]       @relation(&quot;AcknowledgedBy&quot;)</span>
<span class="s">  resolvedAlerts      Alert[]       @relation(&quot;ResolvedBy&quot;)</span>
<span class="s">  auditLogs           AuditLog[]</span>

<span class="s">  @@index([email])</span>
<span class="s">  @@index([deletedAt])</span>
<span class="s">  @@map(&quot;users&quot;)</span>
<span class="s">}</span>

<span class="s">model Team {</span>
<span class="s">  id                 String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name               String    @db.VarChar(255)</span>
<span class="s">  description        String?   @db.Text</span>
<span class="s">  email              String?   @db.VarChar(255)</span>
<span class="s">  slackChannelId     String?   @map(&quot;slack_channel_id&quot;) @db.VarChar(100)</span>
<span class="s">  pagerdutyServiceId String?   @map(&quot;pagerduty_service_id&quot;) @db.VarChar(100)</span>
<span class="s">  createdAt          DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt          DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt          DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  members            TeamMember[]</span>
<span class="s">  routingRules       RoutingRule[]</span>
<span class="s">  alerts             Alert[]</span>
<span class="s">  escalationPolicies EscalationPolicy[]</span>

<span class="s">  @@index([name])</span>
<span class="s">  @@map(&quot;teams&quot;)</span>
<span class="s">}</span>

<span class="s">model TeamMember {</span>
<span class="s">  id           String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  teamId       String    @map(&quot;team_id&quot;) @db.Uuid</span>
<span class="s">  userId       String    @map(&quot;user_id&quot;) @db.Uuid</span>
<span class="s">  role         String    @default(&quot;member&quot;) @db.VarChar(50)</span>
<span class="s">  isOnCall     Boolean   @default(false) @map(&quot;is_on_call&quot;)</span>
<span class="s">  onCallStart  DateTime? @map(&quot;on_call_start&quot;)</span>
<span class="s">  onCallEnd    DateTime? @map(&quot;on_call_end&quot;)</span>
<span class="s">  createdAt    DateTime  @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)</span>
<span class="s">  user User @relation(fields: [userId], references: [id], onDelete: Cascade)</span>

<span class="s">  @@unique([teamId, userId])</span>
<span class="s">  @@index([teamId])</span>
<span class="s">  @@index([userId])</span>
<span class="s">  @@index([isOnCall])</span>
<span class="s">  @@map(&quot;team_members&quot;)</span>
<span class="s">}</span>

<span class="s">model RoutingRule {</span>
<span class="s">  id                   String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name                 String    @db.VarChar(255)</span>
<span class="s">  description          String?   @db.Text</span>
<span class="s">  priority             Int       @default(0)</span>
<span class="s">  enabled              Boolean   @default(true)</span>
<span class="s">  matchType            String    @map(&quot;match_type&quot;) @db.VarChar(50)</span>
<span class="s">  conditions           Json      @db.JsonB</span>
<span class="s">  targetTeamId         String?   @map(&quot;target_team_id&quot;) @db.Uuid</span>
<span class="s">  notificationChannels Json?     @map(&quot;notification_channels&quot;) @db.JsonB</span>
<span class="s">  createdAt            DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt            DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  deletedAt            DateTime? @map(&quot;deleted_at&quot;)</span>

<span class="s">  targetTeam Team?   @relation(fields: [targetTeamId], references: [id], onDelete: SetNull)</span>
<span class="s">  alerts     Alert[]</span>

<span class="s">  @@index([priority(sort: Desc)])</span>
<span class="s">  @@index([enabled])</span>
<span class="s">  @@map(&quot;routing_rules&quot;)</span>
<span class="s">}</span>

<span class="s">model Alert {</span>
<span class="s">  id              String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  externalId      String?   @map(&quot;external_id&quot;) @db.VarChar(255)</span>
<span class="s">  source          String    @db.VarChar(255)</span>
<span class="s">  title           String    @db.VarChar(500)</span>
<span class="s">  description     String?   @db.Text</span>
<span class="s">  severity        String    @db.VarChar(50)</span>
<span class="s">  priority        Int       @default(0)</span>
<span class="s">  status          String    @default(&quot;open&quot;) @db.VarChar(50)</span>
<span class="s">  fingerprint     String    @db.VarChar(64)</span>
<span class="s">  labels          Json?     @db.JsonB</span>
<span class="s">  metadata        Json?     @db.JsonB</span>
<span class="s">  matchedRuleId   String?   @map(&quot;matched_rule_id&quot;) @db.Uuid</span>
<span class="s">  assignedTeamId  String?   @map(&quot;assigned_team_id&quot;) @db.Uuid</span>
<span class="s">  acknowledgedBy  String?   @map(&quot;acknowledged_by&quot;) @db.Uuid</span>
<span class="s">  acknowledgedAt  DateTime? @map(&quot;acknowledged_at&quot;)</span>
<span class="s">  resolvedBy      String?   @map(&quot;resolved_by&quot;) @db.Uuid</span>
<span class="s">  resolvedAt      DateTime? @map(&quot;resolved_at&quot;)</span>
<span class="s">  createdAt       DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt       DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>
<span class="s">  expiresAt       DateTime? @map(&quot;expires_at&quot;)</span>

<span class="s">  matchedRule       RoutingRule?        @relation(fields: [matchedRuleId], references: [id])</span>
<span class="s">  assignedTeam      Team?               @relation(fields: [assignedTeamId], references: [id])</span>
<span class="s">  acknowledger      User?               @relation(&quot;AcknowledgedBy&quot;, fields: [acknowledgedBy], references: [id])</span>
<span class="s">  resolver          User?               @relation(&quot;ResolvedBy&quot;, fields: [resolvedBy], references: [id])</span>
<span class="s">  notifications     AlertNotification[]</span>
<span class="s">  escalations       Escalation[]</span>

<span class="s">  @@index([fingerprint])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([severity])</span>
<span class="s">  @@index([assignedTeamId])</span>
<span class="s">  @@index([createdAt(sort: Desc)])</span>
<span class="s">  @@map(&quot;alerts&quot;)</span>
<span class="s">}</span>

<span class="s">model AlertNotification {</span>
<span class="s">  id            String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  alertId       String    @map(&quot;alert_id&quot;) @db.Uuid</span>
<span class="s">  channel       String    @db.VarChar(50)</span>
<span class="s">  recipient     String    @db.VarChar(255)</span>
<span class="s">  status        String    @default(&quot;pending&quot;) @db.VarChar(50)</span>
<span class="s">  attemptCount  Int       @default(0) @map(&quot;attempt_count&quot;)</span>
<span class="s">  lastAttemptAt DateTime? @map(&quot;last_attempt_at&quot;)</span>
<span class="s">  sentAt        DateTime? @map(&quot;sent_at&quot;)</span>
<span class="s">  deliveredAt   DateTime? @map(&quot;delivered_at&quot;)</span>
<span class="s">  failedAt      DateTime? @map(&quot;failed_at&quot;)</span>
<span class="s">  errorMessage  String?   @map(&quot;error_message&quot;) @db.Text</span>
<span class="s">  externalId    String?   @map(&quot;external_id&quot;) @db.VarChar(255)</span>
<span class="s">  metadata      Json?     @db.JsonB</span>
<span class="s">  createdAt     DateTime  @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  alert Alert @relation(fields: [alertId], references: [id], onDelete: Cascade)</span>

<span class="s">  @@index([alertId])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([channel])</span>
<span class="s">  @@map(&quot;alert_notifications&quot;)</span>
<span class="s">}</span>

<span class="s">model EscalationPolicy {</span>
<span class="s">  id          String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  name        String    @db.VarChar(255)</span>
<span class="s">  description String?   @db.Text</span>
<span class="s">  teamId      String?   @map(&quot;team_id&quot;) @db.Uuid</span>
<span class="s">  enabled     Boolean   @default(true)</span>
<span class="s">  levels      Json      @db.JsonB</span>
<span class="s">  createdAt   DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt   DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>

<span class="s">  team        Team?        @relation(fields: [teamId], references: [id], onDelete: Cascade)</span>
<span class="s">  escalations Escalation[]</span>

<span class="s">  @@index([teamId])</span>
<span class="s">  @@map(&quot;escalation_policies&quot;)</span>
<span class="s">}</span>

<span class="s">model Escalation {</span>
<span class="s">  id                String    @id @default(uuid()) @db.Uuid</span>
<span class="s">  alertId           String    @map(&quot;alert_id&quot;) @db.Uuid</span>
<span class="s">  policyId          String    @map(&quot;policy_id&quot;) @db.Uuid</span>
<span class="s">  currentLevel      Int       @default(1) @map(&quot;current_level&quot;)</span>
<span class="s">  maxLevel          Int       @map(&quot;max_level&quot;)</span>
<span class="s">  status            String    @default(&quot;active&quot;) @db.VarChar(50)</span>
<span class="s">  nextEscalationAt  DateTime? @map(&quot;next_escalation_at&quot;)</span>
<span class="s">  createdAt         DateTime  @default(now()) @map(&quot;created_at&quot;)</span>
<span class="s">  updatedAt         DateTime  @updatedAt @map(&quot;updated_at&quot;)</span>

<span class="s">  alert  Alert            @relation(fields: [alertId], references: [id], onDelete: Cascade)</span>
<span class="s">  policy EscalationPolicy @relation(fields: [policyId], references: [id])</span>

<span class="s">  @@index([alertId])</span>
<span class="s">  @@index([status])</span>
<span class="s">  @@index([nextEscalationAt])</span>
<span class="s">  @@map(&quot;escalations&quot;)</span>
<span class="s">}</span>

<span class="s">model AuditLog {</span>
<span class="s">  id         String   @id @default(uuid()) @db.Uuid</span>
<span class="s">  entityType String   @map(&quot;entity_type&quot;) @db.VarChar(100)</span>
<span class="s">  entityId   String   @map(&quot;entity_id&quot;) @db.Uuid</span>
<span class="s">  action     String   @db.VarChar(100)</span>
<span class="s">  userId     String?  @map(&quot;user_id&quot;) @db.Uuid</span>
<span class="s">  changes    Json?    @db.JsonB</span>
<span class="s">  metadata   Json?    @db.JsonB</span>
<span class="s">  ipAddress  String?  @map(&quot;ip_address&quot;) @db.VarChar(45)</span>
<span class="s">  userAgent  String?  @map(&quot;user_agent&quot;) @db.Text</span>
<span class="s">  createdAt  DateTime @default(now()) @map(&quot;created_at&quot;)</span>

<span class="s">  user User? @relation(fields: [userId], references: [id])</span>

<span class="s">  @@index([entityType, entityId])</span>
<span class="s">  @@index([userId])</span>
<span class="s">  @@index([createdAt(sort: Desc)])</span>
<span class="s">  @@map(&quot;audit_logs&quot;)</span>
<span class="s">}</span>
<span class="sb">```</span>

---

<span class="gu">## API Endpoints</span>

<span class="gu">### Authentication</span>

<span class="sb">```</span>
<span class="sb">POST   /api/auth/register          Register new user</span>
<span class="sb">POST   /api/auth/login             Login user</span>
<span class="sb">POST   /api/auth/logout            Logout user</span>
<span class="sb">POST   /api/auth/refresh           Refresh access token</span>
<span class="sb">GET    /api/auth/me                Get current user</span>
<span class="sb">```</span>

<span class="gu">### Alerts</span>

<span class="sb">```</span>
<span class="sb">POST   /api/alerts                 Create alert</span>
<span class="sb">GET    /api/alerts                 List alerts (paginated, filtered)</span>
<span class="sb">GET    /api/alerts/:id             Get alert by ID</span>
<span class="sb">PATCH  /api/alerts/:id             Update alert</span>
<span class="sb">DELETE /api/alerts/:id             Delete alert</span>
<span class="sb">POST   /api/alerts/:id/acknowledge Acknowledge alert</span>
<span class="sb">POST   /api/alerts/:id/resolve     Resolve alert</span>
<span class="sb">POST   /api/alerts/:id/suppress    Suppress alert</span>
<span class="sb">GET    /api/alerts/:id/history     Get alert history</span>
<span class="sb">```</span>

<span class="gu">### Teams</span>

<span class="sb">```</span>
<span class="sb">POST   /api/teams                  Create team</span>
<span class="sb">GET    /api/teams                  List teams</span>
<span class="sb">GET    /api/teams/:id              Get team by ID</span>
<span class="sb">PATCH  /api/teams/:id              Update team</span>
<span class="sb">DELETE /api/teams/:id              Delete team</span>
<span class="sb">GET    /api/teams/:id/members      List team members</span>
<span class="sb">POST   /api/teams/:id/members      Add member to team</span>
<span class="sb">DELETE /api/teams/:id/members/:uid Remove member from team</span>
<span class="sb">PATCH  /api/teams/:id/members/:uid Update member role/on-call status</span>
<span class="sb">```</span>

<span class="gu">### Routing Rules</span>

<span class="sb">```</span>
<span class="sb">POST   /api/rules                  Create routing rule</span>
<span class="sb">GET    /api/rules                  List routing rules</span>
<span class="sb">GET    /api/rules/:id              Get rule by ID</span>
<span class="sb">PATCH  /api/rules/:id              Update rule</span>
<span class="sb">DELETE /api/rules/:id              Delete rule</span>
<span class="sb">POST   /api/rules/:id/enable       Enable rule</span>
<span class="sb">POST   /api/rules/:id/disable      Disable rule</span>
<span class="sb">POST   /api/rules/test             Test rule against sample alert</span>
<span class="sb">GET    /api/rules/:id/matches      Get alerts matched by rule</span>
<span class="sb">```</span>

<span class="gu">### Escalation Policies</span>

<span class="sb">```</span>
<span class="sb">POST   /api/escalation-policies    Create escalation policy</span>
<span class="sb">GET    /api/escalation-policies    List escalation policies</span>
<span class="sb">GET    /api/escalation-policies/:id Get policy by ID</span>
<span class="sb">PATCH  /api/escalation-policies/:id Update policy</span>
<span class="sb">DELETE /api/escalation-policies/:id Delete policy</span>
<span class="sb">```</span>

<span class="gu">### Notifications</span>

<span class="sb">```</span>
<span class="sb">GET    /api/notifications          List notifications (paginated)</span>
<span class="sb">GET    /api/notifications/:id      Get notification by ID</span>
<span class="sb">POST   /api/notifications/:id/retry Retry failed notification</span>
<span class="sb">GET    /api/notifications/stats    Get notification statistics</span>
<span class="sb">```</span>

<span class="gu">### Analytics</span>

<span class="sb">```</span>
<span class="sb">GET    /api/analytics/overview     Dashboard overview metrics</span>
<span class="sb">GET    /api/analytics/alerts       Alert statistics (by severity, status, team)</span>
<span class="sb">GET    /api/analytics/notifications Notification delivery metrics</span>
<span class="sb">GET    /api/analytics/teams        Team performance metrics</span>
<span class="sb">GET    /api/analytics/response-times Average response times</span>
<span class="sb">```</span>

<span class="gu">### Users</span>

<span class="sb">```</span>
<span class="sb">GET    /api/users                  List users</span>
<span class="sb">GET    /api/users/:id              Get user by ID</span>
<span class="sb">PATCH  /api/users/:id              Update user</span>
<span class="sb">DELETE /api/users/:id              Delete user</span>
<span class="sb">GET    /api/users/:id/alerts       Get user&#39;s assigned alerts</span>
<span class="sb">```</span>

<span class="gu">### Audit Logs</span>

<span class="sb">```</span>
<span class="sb">GET    /api/audit-logs             List audit logs (filtered, paginated)</span>
<span class="sb">GET    /api/audit-logs/:id         Get audit log by ID</span>
<span class="sb">```</span>

<span class="gu">### Request/Response Examples</span>

<span class="gu">#### POST /api/alerts</span>

<span class="gs">**Request:**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prometheus&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;externalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alert-12345&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;High CPU Usage on prod-server-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CPU usage exceeded 90% threshold for 5 minutes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;api&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;instance&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prod-server-01&quot;</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;metadata&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;metric&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;cpu_usage_percent&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;threshold&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;current_value&quot;</span><span class="p">:</span><span class="w"> </span><span class="mf">95.3</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gs">**Response (201 Created):**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;550e8400-e29b-41d4-a716-446655440000&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;prometheus&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;externalId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alert-12345&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;High CPU Usage on prod-server-01&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;CPU usage exceeded 90% threshold for 5 minutes&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;high&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;open&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;fingerprint&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;abc123def456...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchedRuleId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;660e8400-e29b-41d4-a716-446655440001&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;assignedTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;770e8400-e29b-41d4-a716-446655440002&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;createdAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-18T10:30:00Z&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;updatedAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-18T10:30:00Z&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">#### POST /api/rules</span>

<span class="gs">**Request:**</span>
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Production Critical Alerts&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Route all critical alerts from production to Platform team&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;all&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;severity&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;critical&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;environment&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;production&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;targetTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;770e8400-e29b-41d4-a716-446655440002&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notificationChannels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slack&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;pagerduty&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="sb">```</span>

---

<span class="gu">## Implementation Phases</span>

<span class="gu">### Phase 1: Foundation (Weeks 1-2)</span>

<span class="gs">**Goals**</span>: Set up project structure, database, and core services

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Initialize project structure
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Set up TypeScript + Express + Prisma
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Configure ESLint, Prettier, ts-jest
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create Docker Compose for local development
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Set up environment configuration with unifiedConfig

<span class="k">2.</span> Database setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create Prisma schema
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Initial migrations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Seed data for testing

<span class="k">3.</span> Authentication service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User registration and login
<span class="w">   </span><span class="k">-</span><span class="w"> </span>JWT token generation and verification
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Password hashing with bcrypt
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Auth middleware

<span class="k">4.</span> Base infrastructure
<span class="w">   </span><span class="k">-</span><span class="w"> </span>BaseController implementation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Error handling middleware
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry initialization
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Winston logging setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Request validation middleware (Zod)

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Working authentication system
<span class="k">-</span><span class="w"> </span>Database with initial schema
<span class="k">-</span><span class="w"> </span>Base project structure following best practices

<span class="gu">### Phase 2: Alert Management (Weeks 3-4)</span>

<span class="gs">**Goals**</span>: Implement core alert ingestion and management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Alert ingestion API
<span class="w">   </span><span class="k">-</span><span class="w"> </span>POST /api/alerts endpoint
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Request validation with Zod schemas
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AlertController and AlertService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AlertRepository for database access

<span class="k">2.</span> Deduplication service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Fingerprint generation (SHA-256 hash of key fields)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis-based deduplication cache
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Time-window based duplicate detection
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert merging logic

<span class="k">3.</span> Alert CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>List alerts with filtering and pagination
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Get alert by ID
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Update alert status
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Delete alert

<span class="k">4.</span> Alert actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Acknowledge alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Resolve alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Suppress alert
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert history tracking

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Functional alert ingestion API
<span class="k">-</span><span class="w"> </span>Deduplication working with Redis
<span class="k">-</span><span class="w"> </span>Complete alert management endpoints

<span class="gu">### Phase 3: Team Management (Week 5)</span>

<span class="gs">**Goals**</span>: Implement team and user management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Team CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TeamController, TeamService, TeamRepository
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create, read, update, delete teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team member management

<span class="k">2.</span> On-call scheduling
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Add/remove on-call status
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call rotation logic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Get current on-call user for team

<span class="k">3.</span> User management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User profile management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team assignments
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Role management

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Team management API
<span class="k">-</span><span class="w"> </span>On-call scheduling system
<span class="k">-</span><span class="w"> </span>User profile management

<span class="gu">### Phase 4: Routing Engine (Week 6)</span>

<span class="gs">**Goals**</span>: Implement intelligent routing based on rules

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Routing rule management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>RoutingRuleController, RoutingRuleService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>CRUD operations for rules
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule priority ordering

<span class="k">2.</span> Routing engine
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule evaluation logic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Pattern matching (all, any, regex)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Label-based matching
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team assignment based on matched rules

<span class="k">3.</span> Rule testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Test rule endpoint
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Dry-run mode
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Match statistics

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Routing rule management API
<span class="k">-</span><span class="w"> </span>Working routing engine
<span class="k">-</span><span class="w"> </span>Rule testing functionality

<span class="gu">### Phase 5: Notification Channels (Weeks 7-8)</span>

<span class="gs">**Goals**</span>: Implement multi-channel notification delivery

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Channel abstraction
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationChannel interface
<span class="w">   </span><span class="k">-</span><span class="w"> </span>ChannelManager for channel selection
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationService

<span class="k">2.</span> Email provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Nodemailer integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Email templates (Handlebars)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>HTML and text versions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SMTP configuration

<span class="k">3.</span> Slack provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="ni">@slack/web</span>-api integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Channel and DM message posting
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert formatting for Slack
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Webhook support

<span class="k">4.</span> PagerDuty provider
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="ni">@pagerduty/pdjs</span> integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Incident creation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Severity mapping
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Incident acknowledgment and resolution sync

<span class="k">5.</span> Delivery tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>NotificationRepository
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Status tracking (pending, sent, delivered, failed)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Retry logic with exponential backoff
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Delivery statistics

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Email notification working
<span class="k">-</span><span class="w"> </span>Slack integration complete
<span class="k">-</span><span class="w"> </span>PagerDuty integration complete
<span class="k">-</span><span class="w"> </span>Delivery tracking and retry logic

<span class="gu">### Phase 6: Escalation System (Week 9)</span>

<span class="gs">**Goals**</span>: Implement escalation policies and monitoring

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Escalation policy management
<span class="w">   </span><span class="k">-</span><span class="w"> </span>EscalationPolicyController, EscalationPolicyService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>CRUD operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multi-level escalation configuration

<span class="k">2.</span> Escalation monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Background job with Bull queue
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Monitor unacknowledged alerts
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Trigger escalation based on timeout

<span class="k">3.</span> Escalation execution
<span class="w">   </span><span class="k">-</span><span class="w"> </span>EscalationService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Level progression
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Re-routing to escalation teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification to escalation contacts

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Escalation policy management
<span class="k">-</span><span class="w"> </span>Working escalation monitoring job
<span class="k">-</span><span class="w"> </span>Automatic escalation execution

<span class="gu">### Phase 7: Analytics &amp; Reporting (Week 10)</span>

<span class="gs">**Goals**</span>: Implement analytics dashboard and metrics

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Analytics service
<span class="w">   </span><span class="k">-</span><span class="w"> </span>AnalyticsController, AnalyticsService
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Aggregate queries for statistics

<span class="k">2.</span> Metrics endpoints
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Overview dashboard metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert statistics (by severity, status, team)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team performance metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Response time calculations

<span class="k">3.</span> Time-series data
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis-based metric caching
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Hourly/daily aggregations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Historical trend data

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Analytics API endpoints
<span class="k">-</span><span class="w"> </span>Dashboard overview metrics
<span class="k">-</span><span class="w"> </span>Historical reporting

<span class="gu">### Phase 8: Frontend Dashboard (Weeks 11-12)</span>

<span class="gs">**Goals**</span>: Build React dashboard for system management

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Project setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Vite + React + TypeScript
<span class="w">   </span><span class="k">-</span><span class="w"> </span>MUI v7 component library
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TanStack Router and Query
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API client with Axios

<span class="k">2.</span> Authentication UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Login page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Registration page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Protected routes

<span class="k">3.</span> Alert management UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert list with DataGrid
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert details page
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Acknowledge/resolve actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create alert form

<span class="k">4.</span> Team management UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team list
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team details with members
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Add/remove members
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call schedule UI

<span class="k">5.</span> Routing rules UI
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule list
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule editor
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rule testing interface
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Enable/disable rules

<span class="k">6.</span> Analytics dashboard
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Overview metrics cards
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Charts for alert trends
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery stats
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team performance dashboard

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Fully functional React dashboard
<span class="k">-</span><span class="w"> </span>All CRUD operations available in UI
<span class="k">-</span><span class="w"> </span>Analytics visualizations

<span class="gu">### Phase 9: Testing &amp; Quality (Week 13)</span>

<span class="gs">**Goals**</span>: Comprehensive testing coverage

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Unit tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Service layer tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Repository tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Utility function tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Target: 80%+ coverage

<span class="k">2.</span> Integration tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API endpoint tests with Supertest
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database integration tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis integration tests

<span class="k">3.</span> End-to-end tests
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion flow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Routing and notification flow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Escalation flow

<span class="k">4.</span> Load testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion performance
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Concurrent notification delivery
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database query optimization

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Test suite with 80%+ coverage
<span class="k">-</span><span class="w"> </span>Integration and E2E tests
<span class="k">-</span><span class="w"> </span>Performance benchmarks

<span class="gu">### Phase 10: Deployment &amp; Documentation (Week 14)</span>

<span class="gs">**Goals**</span>: Production deployment and documentation

<span class="gs">**Tasks**</span>:
<span class="k">1.</span> Docker containerization
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multi-stage Dockerfile
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Docker Compose for production
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Environment variable management

<span class="k">2.</span> CI/CD pipeline
<span class="w">   </span><span class="k">-</span><span class="w"> </span>GitHub Actions workflow
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Automated testing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Docker image builds
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deployment automation

<span class="k">3.</span> Infrastructure setup
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Cloud provider setup (AWS/GCP/Azure)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PostgreSQL database
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redis instance
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Load balancer configuration

<span class="k">4.</span> Monitoring and alerting
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry error tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Application metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert on system failures

<span class="k">5.</span> Documentation
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API documentation (OpenAPI/Swagger)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deployment guide
<span class="w">   </span><span class="k">-</span><span class="w"> </span>User guide
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Architecture documentation

<span class="gs">**Deliverables**</span>:
<span class="k">-</span><span class="w"> </span>Production-ready deployment
<span class="k">-</span><span class="w"> </span>CI/CD pipeline
<span class="k">-</span><span class="w"> </span>Complete documentation

---

<span class="gu">## Security Considerations</span>

<span class="gu">### Authentication &amp; Authorization</span>

<span class="k">1.</span> <span class="gs">**JWT tokens**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Short-lived access tokens (15 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Refresh tokens (7 days)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Token rotation on refresh

<span class="k">2.</span> <span class="gs">**Password security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>bcrypt hashing with salt rounds &gt;= 12
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Minimum password requirements (8+ chars, complexity)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Password reset flow with time-limited tokens

<span class="k">3.</span> <span class="gs">**Role-based access control (RBAC)**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Roles: admin, manager, user
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team-level permissions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API endpoint authorization

<span class="gu">### API Security</span>

<span class="k">1.</span> <span class="gs">**Rate limiting**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Per-IP rate limits
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Per-user rate limits
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Different limits for authenticated vs. unauthenticated

<span class="k">2.</span> <span class="gs">**Input validation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Zod schema validation for all inputs
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SQL injection prevention (Prisma parameterized queries)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>XSS prevention (sanitize outputs)

<span class="k">3.</span> <span class="gs">**CORS configuration**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Whitelist allowed origins
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Credentials support for cookies

<span class="gu">### Data Security</span>

<span class="k">1.</span> <span class="gs">**Encryption**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>TLS/SSL for all API traffic
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Encrypted database connections
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Encrypted secrets storage

<span class="k">2.</span> <span class="gs">**Secret management**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API keys in environment variables
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Never commit secrets to Git
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rotate secrets regularly

<span class="k">3.</span> <span class="gs">**Audit logging**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Log all sensitive operations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Track user actions
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Immutable audit trail

<span class="gu">### Notification Security</span>

<span class="k">1.</span> <span class="gs">**Webhook verification**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>HMAC signature verification for Slack webhooks
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PagerDuty webhook authentication

<span class="k">2.</span> <span class="gs">**Sensitive data handling**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Redact sensitive information in notifications
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Secure storage of API tokens

<span class="gu">### Infrastructure Security</span>

<span class="k">1.</span> <span class="gs">**Network security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Private VPC for backend services
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Firewall rules
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Security groups

<span class="k">2.</span> <span class="gs">**Container security**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Minimal base images
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Regular security updates
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Vulnerability scanning

---

<span class="gu">## Scalability &amp; Performance</span>

<span class="gu">### Horizontal Scaling</span>

<span class="k">1.</span> <span class="gs">**Stateless API servers**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>No session state in application
<span class="w">   </span><span class="k">-</span><span class="w"> </span>JWT-based authentication
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Load balancer distribution

<span class="k">2.</span> <span class="gs">**Worker processes**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Bull queue for background jobs
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Multiple worker instances
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Job distribution across workers

<span class="gu">### Database Optimization</span>

<span class="k">1.</span> <span class="gs">**Indexing**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Indexes on frequently queried fields
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Composite indexes for complex queries
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Regular index analysis

<span class="k">2.</span> <span class="gs">**Query optimization**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Use Prisma&#39;s <span class="sb">`select`</span> for partial data
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Batch queries where possible
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Avoid N+1 queries

<span class="k">3.</span> <span class="gs">**Connection pooling**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PgBouncer for PostgreSQL
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Prisma connection pool configuration

<span class="gu">### Caching Strategy</span>

<span class="k">1.</span> <span class="gs">**Redis caching**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Deduplication cache (short TTL: 5 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Routing rule cache (TTL: 10 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team member cache (TTL: 5 minutes)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Analytics cache (TTL: 1 minute)

<span class="k">2.</span> <span class="gs">**Cache invalidation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On data updates
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Time-based expiration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Manual cache clearing endpoint

<span class="gu">### Queue Management</span>

<span class="k">1.</span> <span class="gs">**Priority queues**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Separate queues by priority
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Critical alerts processed first
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Rate limiting per priority level

<span class="k">2.</span> <span class="gs">**Queue monitoring**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Queue length metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Processing time metrics
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Failed job tracking

<span class="gu">### Performance Metrics</span>

<span class="k">1.</span> <span class="gs">**Target metrics**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alert ingestion: &lt; 100ms (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Notification delivery: &lt; 5 seconds (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>API response time: &lt; 200ms (p95)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Database query time: &lt; 50ms (p95)

<span class="k">2.</span> <span class="gs">**Monitoring**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Sentry performance monitoring
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Custom metrics with Prometheus
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Alerts on performance degradation

---

<span class="gu">## Future Enhancements</span>

<span class="gu">### Phase 11+</span>

<span class="k">1.</span> <span class="gs">**Additional notification channels**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Microsoft Teams
<span class="w">   </span><span class="k">-</span><span class="w"> </span>SMS via Twilio
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Webhook callbacks

<span class="k">2.</span> <span class="gs">**Advanced routing**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Machine learning-based routing
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Historical pattern analysis
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Smart team suggestions

<span class="k">3.</span> <span class="gs">**Alert correlation**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Automatic incident grouping
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Root cause analysis
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Impact assessment

<span class="k">4.</span> <span class="gs">**Mobile app**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>iOS and Android apps
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Push notifications
<span class="w">   </span><span class="k">-</span><span class="w"> </span>On-call management

<span class="k">5.</span> <span class="gs">**Integration marketplace**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Plugin system
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Custom channel adapters
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Third-party integrations

<span class="k">6.</span> <span class="gs">**Advanced analytics**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>MTTR (Mean Time To Resolution) tracking
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team burnout indicators
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Predictive alerting

---

<span class="gu">## Conclusion</span>

This development plan provides a comprehensive roadmap for building a production-grade Alert Notification Router system. The phased approach allows for incremental delivery of value while maintaining code quality and following best practices.

<span class="gs">**Key Success Factors**</span>:
<span class="k">-</span><span class="w"> </span>Follow layered architecture principles
<span class="k">-</span><span class="w"> </span>Comprehensive testing at all phases
<span class="k">-</span><span class="w"> </span>Security-first approach
<span class="k">-</span><span class="w"> </span>Performance monitoring from day one
<span class="k">-</span><span class="w"> </span>Clear documentation throughout

<span class="gs">**Timeline**</span>: 14 weeks for MVP with core features
<span class="gs">**Team Size**</span>: 2-3 full-stack developers
<span class="gs">**Tech Expertise Required**</span>: Node.js, TypeScript, React, PostgreSQL, Redis
</code></pre></div></td></tr></table></div>
</div>
        </details>
        </div></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01MQfjhztMewXBLa43eNpXEq"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:06:35.808Z' data-duration='took 2.6s'>2025-11-18 14:06:35</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>File created successfully at: /root/Claude/claude-hooks/docs/plan/DevelopmentPlan.md ...</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01HPEaUyubXCXzT8Gqwoto5c">üìù Todo List</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:06:41.882Z'>2025-11-18 14:06:41</span>
                </div>
                
            </div>
        </div>
        <div class='content'>
    <div class="todo-list">
        
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create DevelopmentPlan.md with architecture and implementation details</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item in_progress medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">üîÑ</span>
                    <span class="todo-content">Create TestingPlan.md with comprehensive test strategy</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item pending medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">‚è≥</span>
                    <span class="todo-content">Create Guide.md with user documentation</span>
                    <span class="todo-id">#</span>
                </div>
            
    </div>
    </div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01HPEaUyubXCXzT8Gqwoto5c"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:09:09.401Z' data-duration='took 2m 27s'>2025-11-18 14:09:09</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01NfunyUF88SZkirREcTQv57">üìù Write <span class='tool-summary'>/root/Claude/claude-hooks/docs/testing/TestingPlan.md</span></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:09:09.277Z'>2025-11-18 14:09:09</span>
                </div>
                
            </div>
        </div>
        <div class='content'><div class='write-tool-content'>
        <details class='collapsible-code'>
            <summary>
                <span class='line-count'>1669 lines</span>
                <div class='preview-content'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Testing Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">Testing Strategy Overview</span>](<span class="na">#testing-strategy-overview</span>)
</code></pre></div></td></tr></table></div>
</div>
            </summary>
            <div class='code-full'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span>
<span class="normal">1391</span>
<span class="normal">1392</span>
<span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span>
<span class="normal">1433</span>
<span class="normal">1434</span>
<span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span>
<span class="normal">1484</span>
<span class="normal">1485</span>
<span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span>
<span class="normal">1513</span>
<span class="normal">1514</span>
<span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span>
<span class="normal">1549</span>
<span class="normal">1550</span>
<span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span>
<span class="normal">1583</span>
<span class="normal">1584</span>
<span class="normal">1585</span>
<span class="normal">1586</span>
<span class="normal">1587</span>
<span class="normal">1588</span>
<span class="normal">1589</span>
<span class="normal">1590</span>
<span class="normal">1591</span>
<span class="normal">1592</span>
<span class="normal">1593</span>
<span class="normal">1594</span>
<span class="normal">1595</span>
<span class="normal">1596</span>
<span class="normal">1597</span>
<span class="normal">1598</span>
<span class="normal">1599</span>
<span class="normal">1600</span>
<span class="normal">1601</span>
<span class="normal">1602</span>
<span class="normal">1603</span>
<span class="normal">1604</span>
<span class="normal">1605</span>
<span class="normal">1606</span>
<span class="normal">1607</span>
<span class="normal">1608</span>
<span class="normal">1609</span>
<span class="normal">1610</span>
<span class="normal">1611</span>
<span class="normal">1612</span>
<span class="normal">1613</span>
<span class="normal">1614</span>
<span class="normal">1615</span>
<span class="normal">1616</span>
<span class="normal">1617</span>
<span class="normal">1618</span>
<span class="normal">1619</span>
<span class="normal">1620</span>
<span class="normal">1621</span>
<span class="normal">1622</span>
<span class="normal">1623</span>
<span class="normal">1624</span>
<span class="normal">1625</span>
<span class="normal">1626</span>
<span class="normal">1627</span>
<span class="normal">1628</span>
<span class="normal">1629</span>
<span class="normal">1630</span>
<span class="normal">1631</span>
<span class="normal">1632</span>
<span class="normal">1633</span>
<span class="normal">1634</span>
<span class="normal">1635</span>
<span class="normal">1636</span>
<span class="normal">1637</span>
<span class="normal">1638</span>
<span class="normal">1639</span>
<span class="normal">1640</span>
<span class="normal">1641</span>
<span class="normal">1642</span>
<span class="normal">1643</span>
<span class="normal">1644</span>
<span class="normal">1645</span>
<span class="normal">1646</span>
<span class="normal">1647</span>
<span class="normal">1648</span>
<span class="normal">1649</span>
<span class="normal">1650</span>
<span class="normal">1651</span>
<span class="normal">1652</span>
<span class="normal">1653</span>
<span class="normal">1654</span>
<span class="normal">1655</span>
<span class="normal">1656</span>
<span class="normal">1657</span>
<span class="normal">1658</span>
<span class="normal">1659</span>
<span class="normal">1660</span>
<span class="normal">1661</span>
<span class="normal">1662</span>
<span class="normal">1663</span>
<span class="normal">1664</span>
<span class="normal">1665</span>
<span class="normal">1666</span>
<span class="normal">1667</span>
<span class="normal">1668</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - Testing Plan</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">Testing Strategy Overview</span>](<span class="na">#testing-strategy-overview</span>)
<span class="k">2.</span> [<span class="nt">Testing Objectives</span>](<span class="na">#testing-objectives</span>)
<span class="k">3.</span> [<span class="nt">Test Types &amp; Coverage</span>](<span class="na">#test-types--coverage</span>)
<span class="k">4.</span> [<span class="nt">Unit Testing</span>](<span class="na">#unit-testing</span>)
<span class="k">5.</span> [<span class="nt">Integration Testing</span>](<span class="na">#integration-testing</span>)
<span class="k">6.</span> [<span class="nt">End-to-End Testing</span>](<span class="na">#end-to-end-testing</span>)
<span class="k">7.</span> [<span class="nt">Performance Testing</span>](<span class="na">#performance-testing</span>)
<span class="k">8.</span> [<span class="nt">Security Testing</span>](<span class="na">#security-testing</span>)
<span class="k">9.</span> [<span class="nt">Test Environment Setup</span>](<span class="na">#test-environment-setup</span>)
<span class="k">10.</span> [<span class="nt">Test Data Management</span>](<span class="na">#test-data-management</span>)
<span class="k">11.</span> [<span class="nt">CI/CD Integration</span>](<span class="na">#cicd-integration</span>)
<span class="k">12.</span> [<span class="nt">Test Coverage Goals</span>](<span class="na">#test-coverage-goals</span>)
<span class="k">13.</span> [<span class="nt">Testing Tools &amp; Frameworks</span>](<span class="na">#testing-tools--frameworks</span>)

---

<span class="gu">## Testing Strategy Overview</span>

<span class="gu">### Philosophy</span>

Our testing strategy follows the <span class="gs">**testing pyramid**</span> approach:
<span class="k">-</span><span class="w"> </span><span class="gs">**70% Unit Tests**</span>: Fast, isolated tests for business logic
<span class="k">-</span><span class="w"> </span><span class="gs">**20% Integration Tests**</span>: Tests for component interactions
<span class="k">-</span><span class="w"> </span><span class="gs">**10% E2E Tests**</span>: Critical user flows and scenarios

<span class="gu">### Principles</span>

<span class="k">1.</span> <span class="gs">**Test-Driven Development (TDD)**</span>: Write tests before implementation when possible
<span class="k">2.</span> <span class="gs">**Fast Feedback**</span>: Tests should run quickly to enable rapid iteration
<span class="k">3.</span> <span class="gs">**Reliable**</span>: Tests should be deterministic and not flaky
<span class="k">4.</span> <span class="gs">**Maintainable**</span>: Tests should be easy to understand and update
<span class="k">5.</span> <span class="gs">**Comprehensive**</span>: Critical paths must have test coverage
<span class="k">6.</span> <span class="gs">**Isolated**</span>: Tests should not depend on external services or each other

---

<span class="gu">## Testing Objectives</span>

<span class="gu">### Primary Goals</span>

<span class="k">1.</span> <span class="gs">**Functional Correctness**</span>: Verify all features work as specified
<span class="k">2.</span> <span class="gs">**Reliability**</span>: Ensure system handles errors gracefully
<span class="k">3.</span> <span class="gs">**Performance**</span>: Meet performance targets (&lt; 100ms alert ingestion, &lt; 5s notification delivery)
<span class="k">4.</span> <span class="gs">**Security**</span>: Validate authentication, authorization, and data protection
<span class="k">5.</span> <span class="gs">**Scalability**</span>: Verify system handles expected load
<span class="k">6.</span> <span class="gs">**Regression Prevention**</span>: Catch bugs before production

<span class="gu">### Quality Metrics</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Code Coverage**</span>: Minimum 80% overall, 90% for critical paths
<span class="k">-</span><span class="w"> </span><span class="gs">**Test Success Rate**</span>: 100% passing tests before deployment
<span class="k">-</span><span class="w"> </span><span class="gs">**Test Execution Time**</span>: &lt; 5 minutes for unit tests, &lt; 15 minutes for full suite
<span class="k">-</span><span class="w"> </span><span class="gs">**Bug Escape Rate**</span>: &lt; 5% of bugs reach production
<span class="k">-</span><span class="w"> </span><span class="gs">**Mean Time to Detect (MTTD)**</span>: &lt; 1 hour for production issues

---

<span class="gu">## Test Types &amp; Coverage</span>

<span class="gu">### 1. Unit Tests (70%)</span>

<span class="gs">**Scope**</span>: Individual functions, methods, and classes in isolation

<span class="gs">**Coverage**</span>:
<span class="k">-</span><span class="w"> </span>All service layer business logic
<span class="k">-</span><span class="w"> </span>All repository data access methods
<span class="k">-</span><span class="w"> </span>Utility functions and helpers
<span class="k">-</span><span class="w"> </span>Validation schemas (Zod)
<span class="k">-</span><span class="w"> </span>Error handling logic

<span class="gs">**Target Coverage**</span>: 85%+

<span class="gu">### 2. Integration Tests (20%)</span>

<span class="gs">**Scope**</span>: Interactions between components

<span class="gs">**Coverage**</span>:
<span class="k">-</span><span class="w"> </span>API endpoints (request ‚Üí controller ‚Üí service ‚Üí repository)
<span class="k">-</span><span class="w"> </span>Database operations (Prisma)
<span class="k">-</span><span class="w"> </span>Redis caching
<span class="k">-</span><span class="w"> </span>Queue operations (Bull)
<span class="k">-</span><span class="w"> </span>External API integrations (mock)

<span class="gs">**Target Coverage**</span>: 80%+

<span class="gu">### 3. End-to-End Tests (10%)</span>

<span class="gs">**Scope**</span>: Complete user workflows

<span class="gs">**Coverage**</span>:
<span class="k">-</span><span class="w"> </span>Alert ingestion ‚Üí routing ‚Üí notification flow
<span class="k">-</span><span class="w"> </span>User authentication and authorization flow
<span class="k">-</span><span class="w"> </span>Escalation policy execution
<span class="k">-</span><span class="w"> </span>Team management workflows

<span class="gs">**Target Coverage**</span>: Critical paths only

<span class="gu">### 4. Performance Tests</span>

<span class="gs">**Scope**</span>: System performance under load

<span class="gs">**Coverage**</span>:
<span class="k">-</span><span class="w"> </span>Alert ingestion throughput
<span class="k">-</span><span class="w"> </span>Concurrent notification delivery
<span class="k">-</span><span class="w"> </span>Database query performance
<span class="k">-</span><span class="w"> </span>API response times

<span class="gu">### 5. Security Tests</span>

<span class="gs">**Scope**</span>: Security vulnerabilities and attack vectors

<span class="gs">**Coverage**</span>:
<span class="k">-</span><span class="w"> </span>Authentication bypass attempts
<span class="k">-</span><span class="w"> </span>Authorization checks
<span class="k">-</span><span class="w"> </span>SQL injection
<span class="k">-</span><span class="w"> </span>XSS attacks
<span class="k">-</span><span class="w"> </span>Rate limiting
<span class="k">-</span><span class="w"> </span>Input validation

---

<span class="gu">## Unit Testing</span>

<span class="gu">### Service Layer Tests</span>

Test business logic in isolation using mocked dependencies.

<span class="gu">#### AlertService Tests</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/unit/services/alertService.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlertService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/services/alertService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlertRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/repositories/AlertRepository&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DeduplicationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/services/deduplicationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">RoutingService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/services/routingService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">NotificationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/services/notificationService&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">Sentry</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@sentry/node&#39;</span><span class="p">;</span>

<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@/repositories/AlertRepository&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@/services/deduplicationService&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@/services/routingService&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@/services/notificationService&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@sentry/node&#39;</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;AlertService&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">alertService</span><span class="o">:</span><span class="w"> </span><span class="kt">AlertService</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockAlertRepository</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">AlertRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockDeduplicationService</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">DeduplicationService</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockRoutingService</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">RoutingService</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">mockNotificationService</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.Mocked</span><span class="o">&lt;</span><span class="nx">NotificationService</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">    </span><span class="nx">beforeEach</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">mockAlertRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlertRepository</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">Mocked</span><span class="o">&lt;</span><span class="nx">AlertRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">mockDeduplicationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DeduplicationService</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">Mocked</span><span class="o">&lt;</span><span class="nx">DeduplicationService</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">mockRoutingService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">RoutingService</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">Mocked</span><span class="o">&lt;</span><span class="nx">RoutingService</span><span class="o">&gt;</span><span class="p">;</span>
<span class="w">        </span><span class="nx">mockNotificationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">NotificationService</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">Mocked</span><span class="o">&lt;</span><span class="nx">NotificationService</span><span class="o">&gt;</span><span class="p">;</span>

<span class="w">        </span><span class="nx">alertService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlertService</span><span class="p">(</span>
<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">,</span>
<span class="w">            </span><span class="nx">mockDeduplicationService</span><span class="p">,</span>
<span class="w">            </span><span class="nx">mockRoutingService</span><span class="p">,</span>
<span class="w">            </span><span class="nx">mockNotificationService</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;createAlert&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should create a new alert when no duplicate exists&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">mockDeduplicationService</span><span class="p">.</span><span class="nx">findDuplicate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="nx">mockRoutingService</span><span class="p">.</span><span class="nx">findMatchingRule</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;rule-1&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">targetTeamId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;team-1&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">notificationChannels</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;slack&#39;</span><span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="p">...</span><span class="nx">alertData</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="nx">alertData</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;alert-1&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockDeduplicationService</span><span class="p">.</span><span class="nx">findDuplicate</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockRoutingService</span><span class="p">.</span><span class="nx">findMatchingRule</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockNotificationService</span><span class="p">.</span><span class="nx">sendNotifications</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
<span class="w">                </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="w"> </span><span class="p">}),</span>
<span class="w">                </span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;slack&#39;</span><span class="p">]</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should merge with existing alert if duplicate found&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">existingAlert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;existing-alert-1&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="p">...</span><span class="nx">alertData</span><span class="p">,</span>
<span class="w">                </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">mockDeduplicationService</span><span class="p">.</span><span class="nx">findDuplicate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="nx">existingAlert</span><span class="p">);</span>
<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="p">...</span><span class="nx">existingAlert</span><span class="p">,</span>
<span class="w">                </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="nx">alertData</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;existing-alert-1&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">count</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle routing errors gracefully&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">mockDeduplicationService</span><span class="p">.</span><span class="nx">findDuplicate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="nx">mockRoutingService</span><span class="p">.</span><span class="nx">findMatchingRule</span><span class="p">.</span><span class="nx">mockRejectedValue</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Routing failed&#39;</span><span class="p">));</span>

<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="nx">alertData</span><span class="p">)).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;Routing failed&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">Sentry</span><span class="p">.</span><span class="nx">captureException</span><span class="p">).</span><span class="nx">toHaveBeenCalled</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should generate correct fingerprint for alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">instance</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;server-01&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="nx">mockDeduplicationService</span><span class="p">.</span><span class="nx">findDuplicate</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="nx">mockRoutingService</span><span class="p">.</span><span class="nx">findMatchingRule</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">.</span><span class="nx">mockImplementation</span><span class="p">((</span><span class="nx">data</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">                </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span><span class="w"> </span><span class="p">})</span>
<span class="w">            </span><span class="p">);</span>

<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="nx">alertData</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">).</span><span class="nx">toHaveBeenCalledWith</span><span class="p">(</span>
<span class="w">                </span><span class="nx">expect</span><span class="p">.</span><span class="nx">objectContaining</span><span class="p">({</span>
<span class="w">                    </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="kt">expect.any</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>
<span class="w">                </span><span class="p">})</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;acknowledgeAlert&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should acknowledge an open alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user-1&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledged&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">acknowledgedBy</span><span class="o">:</span><span class="w"> </span><span class="kt">userId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">acknowledgedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">acknowledgeAlert</span><span class="p">(</span><span class="nx">alertId</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;acknowledged&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">acknowledgedBy</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should throw error if alert is already acknowledged&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user-1&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledged&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alertService</span><span class="p">.</span><span class="nx">acknowledgeAlert</span><span class="p">(</span><span class="nx">alertId</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">)).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span>
<span class="w">                </span><span class="s1">&#39;Alert is already acknowledged&#39;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should throw error if alert not found&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>

<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alertService</span><span class="p">.</span><span class="nx">acknowledgeAlert</span><span class="p">(</span><span class="s1">&#39;invalid-id&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;user-1&#39;</span><span class="p">)).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span>
<span class="w">                </span><span class="s1">&#39;Alert not found&#39;</span>
<span class="w">            </span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;resolveAlert&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should resolve an acknowledged alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">;</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;user-1&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledged&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">mockAlertRepository</span><span class="p">.</span><span class="nx">update</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;resolved&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">resolvedBy</span><span class="o">:</span><span class="w"> </span><span class="kt">userId</span><span class="p">,</span>
<span class="w">                </span><span class="nx">resolvedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">()</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">resolveAlert</span><span class="p">(</span><span class="nx">alertId</span><span class="p">,</span><span class="w"> </span><span class="nx">userId</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;resolved&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">resolvedBy</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">#### Test Coverage Areas</span>

<span class="gs">**Services to Test**</span>:
<span class="k">-</span><span class="w"> </span><span class="sb">`AlertService`</span>: Create, acknowledge, resolve, suppress alerts
<span class="k">-</span><span class="w"> </span><span class="sb">`DeduplicationService`</span>: Fingerprint generation, duplicate detection
<span class="k">-</span><span class="w"> </span><span class="sb">`RoutingService`</span>: Rule evaluation, team matching
<span class="k">-</span><span class="w"> </span><span class="sb">`NotificationService`</span>: Channel selection, notification sending
<span class="k">-</span><span class="w"> </span><span class="sb">`EscalationService`</span>: Policy execution, level progression
<span class="k">-</span><span class="w"> </span><span class="sb">`TeamService`</span>: Team CRUD, member management
<span class="k">-</span><span class="w"> </span><span class="sb">`AuthService`</span>: Registration, login, token generation

<span class="gs">**Repositories to Test**</span>:
<span class="k">-</span><span class="w"> </span><span class="sb">`AlertRepository`</span>: CRUD operations, filtering, pagination
<span class="k">-</span><span class="w"> </span><span class="sb">`TeamRepository`</span>: Team queries, member queries
<span class="k">-</span><span class="w"> </span><span class="sb">`RoutingRuleRepository`</span>: Rule queries with priority ordering
<span class="k">-</span><span class="w"> </span><span class="sb">`NotificationRepository`</span>: Status tracking, retry logic

<span class="gs">**Utilities to Test**</span>:
<span class="k">-</span><span class="w"> </span><span class="sb">`fingerprint.ts`</span>: Fingerprint generation algorithm
<span class="k">-</span><span class="w"> </span><span class="sb">`validators.ts`</span>: Zod schema validation
<span class="k">-</span><span class="w"> </span><span class="sb">`encryption.ts`</span>: Password hashing, token generation
<span class="k">-</span><span class="w"> </span><span class="sb">`dateUtils.ts`</span>: Date formatting, timezone handling

<span class="gu">### Test Patterns</span>

<span class="gu">#### 1. AAA Pattern (Arrange-Act-Assert)</span>

<span class="sb">```typescript</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should calculate priority correctly&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Arrange</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>

<span class="w">    </span><span class="c1">// Act</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">priority</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">calculatePriority</span><span class="p">(</span><span class="nx">alert</span><span class="p">);</span>

<span class="w">    </span><span class="c1">// Assert</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">priority</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">100</span><span class="p">);</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">#### 2. Mocking External Dependencies</span>

<span class="sb">```typescript</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@/repositories/AlertRepository&#39;</span><span class="p">);</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mockRepo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlertRepository</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">jest</span><span class="p">.</span><span class="nx">Mocked</span><span class="o">&lt;</span><span class="nx">AlertRepository</span><span class="o">&gt;</span><span class="p">;</span>
<span class="nx">mockRepo</span><span class="p">.</span><span class="nx">findById</span><span class="p">.</span><span class="nx">mockResolvedValue</span><span class="p">({</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test&#39;</span><span class="w"> </span><span class="p">});</span>
<span class="sb">```</span>

<span class="gu">#### 3. Testing Async Operations</span>

<span class="sb">```typescript</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle async operations&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">#### 4. Testing Error Handling</span>

<span class="sb">```typescript</span>
<span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should throw error on invalid input&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alertService</span><span class="p">.</span><span class="nx">createAlert</span><span class="p">(</span><span class="kc">null</span><span class="p">)).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;Invalid input&#39;</span><span class="p">);</span>
<span class="p">});</span>
<span class="sb">```</span>

---

<span class="gu">## Integration Testing</span>

<span class="gu">### API Endpoint Tests</span>

Test complete request/response cycles with real database interactions.

<span class="gu">#### Alert Endpoints Integration Tests</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/integration/alerts.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;supertest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/app&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">generateAuthToken</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/utils/auth&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Alert API Endpoints&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">authToken</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">userId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">teamId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="w">    </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Set up test database</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>

<span class="w">        </span><span class="c1">// Create test user</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test@example.com&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;testuser&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">passwordHash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashedpassword&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">        </span><span class="nx">authToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateAuthToken</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Create test team</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">team</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test Team&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;team@example.com&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">teamId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">team</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Clean up test data</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;POST /api/alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should create a new alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;CPU usage exceeded 90%&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">service</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;api&#39;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">alertData</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">({</span>
<span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">expect.any</span><span class="p">(</span><span class="nb">String</span><span class="p">),</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;High CPU Usage&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="c1">// Verify in database</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
<span class="w">                </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">response.body.id</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return 400 for invalid alert data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">invalidData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span>
<span class="w">                </span><span class="c1">// Missing required fields</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">invalidData</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">400</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toHaveProperty</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return 401 without authentication&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span><span class="w"> </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="w"> </span><span class="p">})</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">401</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should deduplicate identical alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Duplicate Alert&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">instance</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;server-01&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="c1">// Create first alert</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">alertData</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Create duplicate alert</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">alertData</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Should return the same alert ID or merged alert</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response1</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">response2</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;GET /api/alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// Create test alerts</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">createMany</span><span class="p">({</span>
<span class="w">                </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 1&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp1&#39;</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 2&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledged&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp2&#39;</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;grafana&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 3&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp3&#39;</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should list all alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toHaveProperty</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should filter alerts by severity&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts?severity=critical&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">severity</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;critical&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should filter alerts by status&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts?status=open&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">alert</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should paginate results&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts?limit=2&amp;offset=0&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">data</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">).</span><span class="nx">toHaveProperty</span><span class="p">(</span><span class="s1">&#39;pagination&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pagination</span><span class="p">.</span><span class="nx">total</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="mf">3</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;POST /api/alerts/:id/acknowledge&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">let</span><span class="w"> </span><span class="nx">alertId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>

<span class="w">        </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">                </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test Alert&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test-fp&#39;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">alert</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should acknowledge an alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/api/alerts/</span><span class="si">${</span><span class="nx">alertId</span><span class="si">}</span><span class="sb">/acknowledge`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;acknowledged&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">acknowledgedBy</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">userId</span><span class="p">);</span>

<span class="w">            </span><span class="c1">// Verify in database</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
<span class="w">                </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;acknowledged&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return 404 for non-existent alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts/non-existent-id/acknowledge&#39;</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">                </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">404</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Database Integration Tests</span>

Test Prisma repository operations with real database.

<span class="gs">**File**</span>: <span class="sb">`src/tests/integration/repositories/alertRepository.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AlertRepository</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/repositories/AlertRepository&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">alertRepository</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">AlertRepository</span><span class="p">(</span><span class="nx">prisma</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;AlertRepository&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;create&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should create an alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test Alert&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test-fingerprint&#39;</span>
<span class="w">            </span><span class="p">};</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="nx">alertData</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">).</span><span class="nx">toMatchObject</span><span class="p">(</span><span class="nx">alertData</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">.</span><span class="nx">createdAt</span><span class="p">).</span><span class="nx">toBeInstanceOf</span><span class="p">(</span><span class="nb">Date</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;findByFingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should find alert by fingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;unique-fingerprint&#39;</span><span class="p">;</span>

<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Fingerprint Test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">fingerprint</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">findByFingerprint</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">);</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">.</span><span class="nx">fingerprint</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return null for non-existent fingerprint&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">findByFingerprint</span><span class="p">(</span><span class="s1">&#39;non-existent&#39;</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alert</span><span class="p">).</span><span class="nx">toBeNull</span><span class="p">();</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;findWithFilters&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">beforeEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">createMany</span><span class="p">({</span>
<span class="w">                </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 1&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp1&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;grafana&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 2&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledged&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp2&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">                    </span><span class="p">{</span><span class="w"> </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Alert 3&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;fp3&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should filter by severity&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alerts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">findWithFilters</span><span class="p">({</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="w"> </span><span class="p">});</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alerts</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alerts</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">severity</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;critical&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should filter by multiple conditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">alerts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">alertRepository</span><span class="p">.</span><span class="nx">findWithFilters</span><span class="p">({</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span>
<span class="w">            </span><span class="p">});</span>

<span class="w">            </span><span class="nx">expect</span><span class="p">(</span><span class="nx">alerts</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">2</span><span class="p">);</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Redis Integration Tests</span>

Test caching and queue operations.

<span class="gs">**File**</span>: <span class="sb">`src/tests/integration/redis/deduplication.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Redis</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ioredis&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">DeduplicationService</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/services/deduplicationService&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">redis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Redis</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_TEST_URL</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">deduplicationService</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DeduplicationService</span><span class="p">(</span><span class="nx">redis</span><span class="p">);</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Deduplication with Redis&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">afterEach</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">flushdb</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should store and retrieve alert fingerprints&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;test-fingerprint-123&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">;</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">deduplicationService</span><span class="p">.</span><span class="nx">storeFingerprint</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">,</span><span class="w"> </span><span class="nx">alertId</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">cachedAlertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">deduplicationService</span><span class="p">.</span><span class="nx">getAlertIdByFingerprint</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">);</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">cachedAlertId</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">alertId</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should expire fingerprints after TTL&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fingerprint</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;expiring-fingerprint&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;alert-1&#39;</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ttl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 second</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">deduplicationService</span><span class="p">.</span><span class="nx">storeFingerprint</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">,</span><span class="w"> </span><span class="nx">alertId</span><span class="p">,</span><span class="w"> </span><span class="nx">ttl</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Wait for expiration</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">1500</span><span class="p">));</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">cachedAlertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">deduplicationService</span><span class="p">.</span><span class="nx">getAlertIdByFingerprint</span><span class="p">(</span><span class="nx">fingerprint</span><span class="p">);</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">cachedAlertId</span><span class="p">).</span><span class="nx">toBeNull</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

---

<span class="gu">## End-to-End Testing</span>

<span class="gu">### Complete Alert Flow Test</span>

Test entire alert lifecycle from ingestion to notification delivery.

<span class="gs">**File**</span>: <span class="sb">`src/tests/e2e/alertFlow.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="nx">request</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;supertest&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">app</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/app&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">generateAuthToken</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@/utils/auth&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;E2E: Alert Flow&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">authToken</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">team</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">routingRule</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span>

<span class="w">    </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Set up test environment</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;e2e@example.com&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;e2euser&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">passwordHash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hash&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">authToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateAuthToken</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Create team</span>
<span class="w">        </span><span class="nx">team</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;E2E Test Team&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;team@example.com&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">slackChannelId</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;C123456&#39;</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Create routing rule</span>
<span class="w">        </span><span class="nx">routingRule</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">routingRule</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Production Critical Rule&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="p">,</span>
<span class="w">                </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">matchType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">conditions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;critical&#39;</span><span class="p">],</span>
<span class="w">                    </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="nx">targetTeamId</span><span class="o">:</span><span class="w"> </span><span class="kt">team.id</span><span class="p">,</span>
<span class="w">                </span><span class="nx">notificationChannels</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;slack&#39;</span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">routingRule</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should complete full alert lifecycle&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// 1. Create alert</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">createResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;prometheus&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Critical Production Issue&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Server down&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">service</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;api&#39;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// 2. Verify alert was routed to correct team</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">createResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">assignedTeamId</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">team</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">createResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">matchedRuleId</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="nx">routingRule</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 3. Verify notifications were created</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">notifications</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alertNotification</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">            </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">notifications</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 4. Acknowledge alert</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">ackResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/api/alerts/</span><span class="si">${</span><span class="nx">alertId</span><span class="si">}</span><span class="sb">/acknowledge`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">ackResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;acknowledged&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 5. Resolve alert</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolveResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`/api/alerts/</span><span class="si">${</span><span class="nx">alertId</span><span class="si">}</span><span class="sb">/resolve`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">resolveResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;resolved&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// 6. Verify final state in database</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">finalAlert</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">findUnique</span><span class="p">({</span>
<span class="w">            </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">alertId</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">finalAlert</span><span class="p">.</span><span class="nx">status</span><span class="p">).</span><span class="nx">toBe</span><span class="p">(</span><span class="s1">&#39;resolved&#39;</span><span class="p">);</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">finalAlert</span><span class="p">.</span><span class="nx">resolvedAt</span><span class="p">).</span><span class="nx">toBeDefined</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should trigger escalation for unacknowledged alert&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create escalation policy</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">policy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">escalationPolicy</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">            </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Test Escalation&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">teamId</span><span class="o">:</span><span class="w"> </span><span class="kt">team.id</span><span class="p">,</span>
<span class="w">                </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">                </span><span class="nx">levels</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                    </span><span class="p">{</span>
<span class="w">                        </span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">timeout_minutes</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="c1">// 1 minute for testing</span>
<span class="w">                        </span><span class="nx">target_team_id</span><span class="o">:</span><span class="w"> </span><span class="kt">team.id</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">channels</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">]</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="c1">// Create alert</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">createResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Escalation Test Alert&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">createResponse</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>

<span class="w">        </span><span class="c1">// Wait for escalation timeout</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Promise</span><span class="p">(</span><span class="nx">resolve</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span><span class="w"> </span><span class="mf">61000</span><span class="p">));</span><span class="w"> </span><span class="c1">// 61 seconds</span>

<span class="w">        </span><span class="c1">// Check if escalation was triggered</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">escalations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">escalation</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">            </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">alertId</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">escalations</span><span class="p">.</span><span class="nx">length</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

---

<span class="gu">## Performance Testing</span>

<span class="gu">### Load Testing with Artillery</span>

<span class="gs">**File**</span>: <span class="sb">`tests/performance/alert-ingestion.yml`</span>

<span class="sb">```yaml</span>
<span class="nt">config</span><span class="p">:</span>
<span class="w">  </span><span class="nt">target</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://localhost:3000&quot;</span>
<span class="w">  </span><span class="nt">phases</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">arrivalRate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Warm</span><span class="nv"> </span><span class="s">up&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">120</span>
<span class="w">      </span><span class="nt">arrivalRate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">50</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Sustained</span><span class="nv"> </span><span class="s">load&quot;</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">duration</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
<span class="w">      </span><span class="nt">arrivalRate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Peak</span><span class="nv"> </span><span class="s">load&quot;</span>
<span class="w">  </span><span class="nt">variables</span><span class="p">:</span>
<span class="w">    </span><span class="nt">authToken</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bearer</span><span class="nv"> </span><span class="s">eyJhbGc...&quot;</span>

<span class="nt">scenarios</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Create</span><span class="nv"> </span><span class="s">alerts&quot;</span>
<span class="w">    </span><span class="nt">flow</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">post</span><span class="p">:</span>
<span class="w">          </span><span class="nt">url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;/api/alerts&quot;</span>
<span class="w">          </span><span class="nt">headers</span><span class="p">:</span>
<span class="w">            </span><span class="nt">Authorization</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">authToken</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">          </span><span class="nt">json</span><span class="p">:</span>
<span class="w">            </span><span class="nt">source</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;load-test&quot;</span>
<span class="w">            </span><span class="nt">title</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Load</span><span class="nv"> </span><span class="s">Test</span><span class="nv"> </span><span class="s">Alert</span><span class="nv"> </span><span class="s">{{</span><span class="nv"> </span><span class="s">$randomNumber()</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">severity</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">$randomChoice([&#39;critical&#39;,</span><span class="nv"> </span><span class="s">&#39;high&#39;,</span><span class="nv"> </span><span class="s">&#39;medium&#39;,</span><span class="nv"> </span><span class="s">&#39;low&#39;])</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="w">            </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">              </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test&quot;</span>
<span class="w">              </span><span class="nt">instance</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;server-{{</span><span class="nv"> </span><span class="s">$randomNumber()</span><span class="nv"> </span><span class="s">}}&quot;</span>
<span class="sb">```</span>

<span class="gu">### Performance Test Scripts</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/performance/alertIngestion.test.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;axios&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">API_URL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;http://localhost:3000/api&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">AUTH_TOKEN</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Bearer ...&#39;</span><span class="p">;</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">NUM_REQUESTS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Performance: Alert Ingestion&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle 1000 concurrent alert creations&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">requests</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">NUM_REQUESTS</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span>
<span class="w">            </span><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">API_URL</span><span class="si">}</span><span class="sb">/alerts`</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;perf-test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Performance Test Alert </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">test</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;performance&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Authorization</span><span class="o">:</span><span class="w"> </span><span class="kt">AUTH_TOKEN</span><span class="w"> </span><span class="p">}</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">        </span><span class="p">);</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nb">Promise</span><span class="p">.</span><span class="nx">allSettled</span><span class="p">(</span><span class="nx">requests</span><span class="p">);</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">endTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">successful</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;fulfilled&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">failed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">r</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">r</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;rejected&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">endTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">throughput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">NUM_REQUESTS</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">duration</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">;</span><span class="w"> </span><span class="c1">// requests per second</span>

<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Successful: </span><span class="si">${</span><span class="nx">successful</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Failed: </span><span class="si">${</span><span class="nx">failed</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Duration: </span><span class="si">${</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
<span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`Throughput: </span><span class="si">${</span><span class="nx">throughput</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb"> req/s`</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Performance assertions</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">successful</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="nx">NUM_REQUESTS</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.95</span><span class="p">);</span><span class="w"> </span><span class="c1">// 95% success rate</span>
<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">throughput</span><span class="p">).</span><span class="nx">toBeGreaterThan</span><span class="p">(</span><span class="mf">50</span><span class="p">);</span><span class="w"> </span><span class="c1">// At least 50 req/s</span>
<span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">60000</span><span class="p">);</span><span class="w"> </span><span class="c1">// 60 second timeout</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Database Query Performance</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>

<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Performance: Database Queries&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// Create 10,000 test alerts</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">alerts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">(</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">i</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">            </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;perf-test&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="sb">`Alert </span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
<span class="w">            </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">][</span><span class="nx">i</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="mf">4</span><span class="p">],</span>
<span class="w">            </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">fingerprint</span><span class="o">:</span><span class="w"> </span><span class="sb">`fp-</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">`</span>
<span class="w">        </span><span class="p">}));</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">createMany</span><span class="p">({</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">alerts</span><span class="w"> </span><span class="p">});</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({</span><span class="w"> </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;perf-test&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">});</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should query alerts with pagination in &lt;50ms&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">            </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;open&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="nx">take</span><span class="o">:</span><span class="w"> </span><span class="kt">20</span><span class="p">,</span>
<span class="w">            </span><span class="nx">skip</span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="p">,</span>
<span class="w">            </span><span class="nx">orderBy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">createdAt</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;desc&#39;</span><span class="w"> </span><span class="p">}</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">duration</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="mf">50</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should filter alerts by severity in &lt;50ms&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">findMany</span><span class="p">({</span>
<span class="w">            </span><span class="nx">where</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;critical&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="nx">take</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
<span class="w">        </span><span class="p">});</span>

<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">duration</span><span class="p">).</span><span class="nx">toBeLessThan</span><span class="p">(</span><span class="mf">50</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

---

<span class="gu">## Security Testing</span>

<span class="gu">### Authentication Tests</span>

<span class="sb">```typescript</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Security: Authentication&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should reject requests without token&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">401</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should reject requests with invalid token&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Bearer invalid-token&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">401</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should reject requests with expired token&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">expiredToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateExpiredToken</span><span class="p">();</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">expiredToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">401</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Authorization Tests</span>

<span class="sb">```typescript</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Security: Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should prevent non-admin from deleting alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">userToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateTokenForRole</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/api/alerts/alert-1&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">userToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">403</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should allow admin to delete alerts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">adminToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">generateTokenForRole</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">);</span>

<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/api/alerts/alert-1&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">adminToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">200</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Input Validation Tests</span>

<span class="sb">```typescript</span>
<span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Security: Input Validation&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should reject SQL injection attempts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/alerts?severity=critical\&#39; OR \&#39;1\&#39;=\&#39;1&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">400</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should sanitize XSS attempts&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">request</span><span class="p">(</span><span class="nx">app</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/api/alerts&#39;</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;Authorization&#39;</span><span class="p">,</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="nx">authToken</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<span class="w">            </span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
<span class="w">                </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;test&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&lt;script&gt;alert(&quot;XSS&quot;)&lt;/script&gt;&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;high&#39;</span>
<span class="w">            </span><span class="p">})</span>
<span class="w">            </span><span class="p">.</span><span class="nx">expect</span><span class="p">(</span><span class="mf">201</span><span class="p">);</span>

<span class="w">        </span><span class="nx">expect</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">title</span><span class="p">).</span><span class="nx">not</span><span class="p">.</span><span class="nx">toContain</span><span class="p">(</span><span class="s1">&#39;&lt;script&gt;&#39;</span><span class="p">);</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">});</span>
<span class="sb">```</span>

---

<span class="gu">## Test Environment Setup</span>

<span class="gu">### Docker Compose for Testing</span>

<span class="gs">**File**</span>: <span class="sb">`docker-compose.test.yml`</span>

<span class="sb">```yaml</span>
<span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;3.8&#39;</span>

<span class="nt">services</span><span class="p">:</span>
<span class="w">  </span><span class="nt">postgres-test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
<span class="w">    </span><span class="nt">environment</span><span class="p">:</span>
<span class="w">      </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">alert_router_test</span>
<span class="w">      </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">      </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">testpass</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;5433:5432&quot;</span>
<span class="w">    </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/data</span>

<span class="w">  </span><span class="nt">redis-test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;6380:6379&quot;</span>
<span class="w">    </span><span class="nt">tmpfs</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/data</span>
<span class="sb">```</span>

<span class="gu">### Test Environment Variables</span>

<span class="gs">**File**</span>: <span class="sb">`.env.test`</span>

<span class="sb">```env</span>
<span class="s">NODE_ENV=test</span>
<span class="s">DATABASE_URL=postgresql://test:testpass@localhost:5433/alert_router_test</span>
<span class="s">REDIS_URL=redis://localhost:6380</span>
<span class="s">JWT_SECRET=test-secret-key</span>
<span class="s">JWT_EXPIRY=15m</span>
<span class="s">SENTRY_DSN=</span>
<span class="s">LOG_LEVEL=error</span>
<span class="sb">```</span>

<span class="gu">### Jest Configuration</span>

<span class="gs">**File**</span>: <span class="sb">`jest.config.js`</span>

<span class="sb">```javascript</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">preset</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ts-jest&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">testEnvironment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;node&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">roots</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;&lt;rootDir&gt;/src&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">testMatch</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;**/__tests__/**/*.ts&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;**/?(*.)+(spec|test).ts&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">transform</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="s1">&#39;^.+\\.ts$&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;ts-jest&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">collectCoverageFrom</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="s1">&#39;src/**/*.ts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;!src/**/*.d.ts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;!src/**/*.test.ts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;!src/**/*.spec.ts&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="s1">&#39;!src/tests/**&#39;</span><span class="p">,</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nx">coverageThreshold</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nb">global</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">branches</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span>
<span class="w">            </span><span class="nx">functions</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span>
<span class="w">            </span><span class="nx">lines</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span>
<span class="w">            </span><span class="nx">statements</span><span class="o">:</span><span class="w"> </span><span class="mf">80</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">    </span><span class="nx">setupFilesAfterEnv</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;&lt;rootDir&gt;/src/tests/setup.ts&#39;</span><span class="p">],</span>
<span class="w">    </span><span class="nx">testTimeout</span><span class="o">:</span><span class="w"> </span><span class="mf">30000</span><span class="p">,</span>
<span class="w">    </span><span class="nx">maxWorkers</span><span class="o">:</span><span class="w"> </span><span class="mf">4</span><span class="p">,</span>
<span class="p">};</span>
<span class="sb">```</span>

<span class="gu">### Test Setup File</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/setup.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>
<span class="k">import</span><span class="w"> </span><span class="nx">Redis</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ioredis&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">redis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Redis</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">REDIS_URL</span><span class="p">);</span>

<span class="nx">beforeAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Run migrations</span>
<span class="w">    </span><span class="c1">// Note: In real setup, use Prisma migrate for test database</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$connect</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">afterAll</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">$disconnect</span><span class="p">();</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">redis</span><span class="p">.</span><span class="nx">quit</span><span class="p">();</span>
<span class="p">});</span>

<span class="c1">// Mock Sentry in tests</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@sentry/node&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">    </span><span class="nx">captureException</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">captureMessage</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="w">    </span><span class="nx">init</span><span class="o">:</span><span class="w"> </span><span class="kt">jest.fn</span><span class="p">(),</span>
<span class="p">}));</span>

<span class="c1">// Mock external notification services</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;nodemailer&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@slack/web-api&#39;</span><span class="p">);</span>
<span class="nx">jest</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="s1">&#39;@pagerduty/pdjs&#39;</span><span class="p">);</span>
<span class="sb">```</span>

---

<span class="gu">## Test Data Management</span>

<span class="gu">### Test Data Factories</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/factories/alertFactory.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">faker</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@faker-js/faker&#39;</span><span class="p">;</span>

<span class="k">export</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">alertFactory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">build</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">overrides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
<span class="w">        </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.company.name</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.lorem.sentence</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.lorem.paragraph</span><span class="p">(),</span>
<span class="w">        </span><span class="nx">severity</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.helpers.arrayElement</span><span class="p">([</span><span class="s1">&#39;critical&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;high&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;medium&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;low&#39;</span><span class="p">]),</span>
<span class="w">        </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.helpers.arrayElement</span><span class="p">([</span><span class="s1">&#39;production&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;staging&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;development&#39;</span><span class="p">]),</span>
<span class="w">            </span><span class="nx">service</span><span class="o">:</span><span class="w"> </span><span class="kt">faker.internet.domainWord</span><span class="p">(),</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">...</span><span class="nx">overrides</span><span class="p">,</span>
<span class="w">    </span><span class="p">}),</span>

<span class="w">    </span><span class="nx">buildMany</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">overrides</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{})</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">({</span><span class="w"> </span><span class="nx">length</span><span class="o">:</span><span class="w"> </span><span class="kt">count</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">alertFactory</span><span class="p">.</span><span class="nx">build</span><span class="p">(</span><span class="nx">overrides</span><span class="p">));</span>
<span class="w">    </span><span class="p">},</span>
<span class="p">};</span>
<span class="sb">```</span>

<span class="gu">### Seed Data</span>

<span class="gs">**File**</span>: <span class="sb">`src/tests/seeds/testData.ts`</span>

<span class="sb">```typescript</span>
<span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@prisma/client&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">();</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">seedTestData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Create test users</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">admin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin@test.com&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">passwordHash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashed&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user@test.com&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">username</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">passwordHash</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;hashed&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;user&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Create test teams</span>
<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">platformTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Platform Team&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;platform@test.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">devTeam</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Development Team&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;dev@test.com&#39;</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="c1">// Create routing rules</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">routingRule</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
<span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Production Alerts&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">priority</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="p">,</span>
<span class="w">            </span><span class="nx">enabled</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
<span class="w">            </span><span class="nx">matchType</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">conditions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">environment</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;production&#39;</span><span class="w"> </span><span class="p">},</span>
<span class="w">            </span><span class="p">},</span>
<span class="w">            </span><span class="nx">targetTeamId</span><span class="o">:</span><span class="w"> </span><span class="kt">platformTeam.id</span><span class="p">,</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">    </span><span class="p">});</span>

<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">admin</span><span class="p">,</span><span class="w"> </span><span class="nx">user</span><span class="p">,</span><span class="w"> </span><span class="nx">platformTeam</span><span class="p">,</span><span class="w"> </span><span class="nx">devTeam</span><span class="w"> </span><span class="p">};</span>
<span class="p">}</span>

<span class="k">export</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">cleanupTestData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">alert</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">routingRule</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">team</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">prisma</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">deleteMany</span><span class="p">({});</span>
<span class="p">}</span>
<span class="sb">```</span>

---

<span class="gu">## CI/CD Integration</span>

<span class="gu">### GitHub Actions Workflow</span>

<span class="gs">**File**</span>: <span class="sb">`.github/workflows/test.yml`</span>

<span class="sb">```yaml</span>
<span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Tests</span>

<span class="nt">on</span><span class="p">:</span>
<span class="w">  </span><span class="nt">push</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>
<span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span>
<span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">main</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">develop</span><span class="p p-Indicator">]</span>

<span class="nt">jobs</span><span class="p">:</span>
<span class="w">  </span><span class="nt">test</span><span class="p">:</span>
<span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ubuntu-latest</span>

<span class="w">    </span><span class="nt">services</span><span class="p">:</span>
<span class="w">      </span><span class="nt">postgres</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:15-alpine</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test_db</span>
<span class="w">          </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">          </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432:5432</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">          </span><span class="no">--health-cmd pg_isready</span>
<span class="w">          </span><span class="no">--health-interval 10s</span>
<span class="w">          </span><span class="no">--health-timeout 5s</span>
<span class="w">          </span><span class="no">--health-retries 5</span>

<span class="w">      </span><span class="nt">redis</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis:7-alpine</span>
<span class="w">        </span><span class="nt">ports</span><span class="p">:</span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6379:6379</span>
<span class="w">        </span><span class="nt">options</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
<span class="w">          </span><span class="no">--health-cmd &quot;redis-cli ping&quot;</span>
<span class="w">          </span><span class="no">--health-interval 10s</span>
<span class="w">          </span><span class="no">--health-timeout 5s</span>
<span class="w">          </span><span class="no">--health-retries 5</span>

<span class="w">    </span><span class="nt">steps</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/checkout@v3</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Setup Node.js</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">actions/setup-node@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">node-version</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;20&#39;</span>
<span class="w">          </span><span class="nt">cache</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;npm&#39;</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Install dependencies</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm ci</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run linter</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run lint</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run type check</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run type-check</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run Prisma migrations</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://test:test@localhost:5432/test_db</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npx prisma migrate deploy</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run unit tests</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://test:test@localhost:5432/test_db</span>
<span class="w">          </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis://localhost:6379</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:unit</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run integration tests</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://test:test@localhost:5432/test_db</span>
<span class="w">          </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis://localhost:6379</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:integration</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Run E2E tests</span>
<span class="w">        </span><span class="nt">env</span><span class="p">:</span>
<span class="w">          </span><span class="nt">DATABASE_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgresql://test:test@localhost:5432/test_db</span>
<span class="w">          </span><span class="nt">REDIS_URL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">redis://localhost:6379</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:e2e</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Generate coverage report</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:coverage</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Upload coverage to Codecov</span>
<span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codecov/codecov-action@v3</span>
<span class="w">        </span><span class="nt">with</span><span class="p">:</span>
<span class="w">          </span><span class="nt">files</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./coverage/lcov.info</span>
<span class="w">          </span><span class="nt">fail_ci_if_error</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>

<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Check coverage thresholds</span>
<span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">npm run test:coverage:check</span>
<span class="sb">```</span>

<span class="gu">### NPM Scripts</span>

<span class="gs">**File**</span>: <span class="sb">`package.json`</span> (test scripts)

<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;test&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:unit&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --testPathPattern=tests/unit&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:integration&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --testPathPattern=tests/integration --runInBand&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:e2e&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --testPathPattern=tests/e2e --runInBand&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:coverage&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --coverage&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:coverage:check&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --coverage --coverageThreshold=&#39;{\&quot;global\&quot;:{\&quot;branches\&quot;:80,\&quot;functions\&quot;:80,\&quot;lines\&quot;:80,\&quot;statements\&quot;:80}}&#39;&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:watch&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jest --watch&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;test:debug&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node --inspect-brk node_modules/.bin/jest --runInBand&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="sb">```</span>

---

<span class="gu">## Test Coverage Goals</span>

<span class="gu">### Overall Coverage Targets</span>

| Component | Target Coverage |
|-----------|----------------|
| <span class="gs">**Services**</span> | 90% |
| <span class="gs">**Controllers**</span> | 85% |
| <span class="gs">**Repositories**</span> | 90% |
| <span class="gs">**Utilities**</span> | 95% |
| <span class="gs">**Middleware**</span> | 85% |
| <span class="gs">**Overall**</span> | 80% |

<span class="gu">### Critical Path Coverage</span>

Must have 100% coverage:
<span class="k">-</span><span class="w"> </span>Authentication and authorization logic
<span class="k">-</span><span class="w"> </span>Alert deduplication logic
<span class="k">-</span><span class="w"> </span>Routing engine
<span class="k">-</span><span class="w"> </span>Escalation logic
<span class="k">-</span><span class="w"> </span>Financial/billing logic (if applicable)

<span class="gu">### Coverage Reporting</span>

<span class="k">1.</span> <span class="gs">**Generate HTML report**</span>: <span class="sb">`npm run test:coverage`</span>
<span class="k">2.</span> <span class="gs">**View report**</span>: Open <span class="sb">`coverage/lcov-report/index.html`</span>
<span class="k">3.</span> <span class="gs">**CI Integration**</span>: Automatically upload to Codecov
<span class="k">4.</span> <span class="gs">**PR Comments**</span>: Show coverage diff in pull requests

---

<span class="gu">## Testing Tools &amp; Frameworks</span>

<span class="gu">### Core Testing Tools</span>

| Tool | Purpose | Version |
|------|---------|---------|
| <span class="gs">**Jest**</span> | Test framework and runner | v29+ |
| <span class="gs">**ts-jest**</span> | TypeScript support for Jest | v29+ |
| <span class="gs">**Supertest**</span> | HTTP endpoint testing | v6+ |
| <span class="gs">**@faker-js/faker**</span> | Test data generation | v8+ |
| <span class="gs">**Prisma Test Environment**</span> | Isolated test database | Custom |

<span class="gu">### Mocking Libraries</span>

| Library | Purpose |
|---------|---------|
| <span class="gs">**jest.mock()**</span> | Built-in mocking |
| <span class="gs">**jest.spyOn()**</span> | Function spying |
| <span class="gs">**Mock Service Worker (MSW)**</span> | API mocking (optional) |

<span class="gu">### Performance Testing</span>

| Tool | Purpose |
|------|---------|
| <span class="gs">**Artillery**</span> | Load testing |
| <span class="gs">**Clinic.js**</span> | Node.js performance profiling |
| <span class="gs">**autocannon**</span> | HTTP benchmarking |

<span class="gu">### Security Testing</span>

| Tool | Purpose |
|------|---------|
| <span class="gs">**npm audit**</span> | Dependency vulnerability scanning |
| <span class="gs">**Snyk**</span> | Security vulnerability detection |
| <span class="gs">**OWASP ZAP**</span> | Penetration testing (optional) |

---

<span class="gu">## Test Execution Strategy</span>

<span class="gu">### Local Development</span>

<span class="sb">```bash</span>
<span class="c1"># Run all tests</span>
npm<span class="w"> </span><span class="nb">test</span>

<span class="c1"># Run specific test suite</span>
npm<span class="w"> </span>run<span class="w"> </span>test:unit
npm<span class="w"> </span>run<span class="w"> </span>test:integration
npm<span class="w"> </span>run<span class="w"> </span>test:e2e

<span class="c1"># Watch mode for TDD</span>
npm<span class="w"> </span>run<span class="w"> </span>test:watch

<span class="c1"># Debug tests</span>
npm<span class="w"> </span>run<span class="w"> </span>test:debug
<span class="sb">```</span>

<span class="gu">### Pre-commit Hooks</span>

<span class="gs">**File**</span>: <span class="sb">`.husky/pre-commit`</span>

<span class="sb">```bash</span>
<span class="ch">#!/bin/sh</span>
.<span class="w"> </span><span class="s2">&quot;</span><span class="k">$(</span>dirname<span class="w"> </span><span class="s2">&quot;</span><span class="nv">$0</span><span class="s2">&quot;</span><span class="k">)</span><span class="s2">/_/husky.sh&quot;</span>

<span class="c1"># Run linter</span>
npm<span class="w"> </span>run<span class="w"> </span>lint

<span class="c1"># Run unit tests</span>
npm<span class="w"> </span>run<span class="w"> </span>test:unit

<span class="c1"># Check TypeScript</span>
npm<span class="w"> </span>run<span class="w"> </span>type-check
<span class="sb">```</span>

<span class="gu">### Pull Request Process</span>

<span class="k">1.</span> All tests must pass
<span class="k">2.</span> Coverage must not decrease
<span class="k">3.</span> New code must have accompanying tests
<span class="k">4.</span> Integration tests for new endpoints
<span class="k">5.</span> E2E tests for new workflows

---

<span class="gu">## Conclusion</span>

This comprehensive testing plan ensures high code quality, reliability, and maintainability of the Alert Notification Router system. By following the testing pyramid and maintaining high coverage, we can confidently deliver features and catch bugs early in the development cycle.

<span class="gs">**Key Takeaways**</span>:
<span class="k">-</span><span class="w"> </span>Write tests alongside code (TDD when possible)
<span class="k">-</span><span class="w"> </span>Maintain 80%+ overall coverage, 90%+ for critical paths
<span class="k">-</span><span class="w"> </span>Run fast unit tests frequently, integration tests before commits
<span class="k">-</span><span class="w"> </span>Automate testing in CI/CD pipeline
<span class="k">-</span><span class="w"> </span>Monitor and improve test performance
<span class="k">-</span><span class="w"> </span>Keep tests maintainable and well-documented
</code></pre></div></td></tr></table></div>
</div>
        </details>
        </div></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01NfunyUF88SZkirREcTQv57"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:09:09.545Z' data-duration='took 268 ms'>2025-11-18 14:09:09</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>File created successfully at: /root/Claude/claude-hooks/docs/testing/TestingPlan.md ...</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_011jK5BrZL3sh4mHqYvQ1T5Y">üìù Todo List</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:09:18.112Z'>2025-11-18 14:09:18</span>
                </div>
                
            </div>
        </div>
        <div class='content'>
    <div class="todo-list">
        
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create DevelopmentPlan.md with architecture and implementation details</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create TestingPlan.md with comprehensive test strategy</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item in_progress medium">
                    <input type="checkbox"   readonly>
                    <span class="todo-status">üîÑ</span>
                    <span class="todo-content">Create Guide.md with user documentation</span>
                    <span class="todo-id">#</span>
                </div>
            
    </div>
    </div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_011jK5BrZL3sh4mHqYvQ1T5Y"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:29.880Z' data-duration='took 2m 11s'>2025-11-18 14:11:29</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01QYxAwhYApcB3wxQucmUYSs">üìù Write <span class='tool-summary'>/root/Claude/claude-hooks/docs/guides/Guide.md</span></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:29.708Z'>2025-11-18 14:11:29</span>
                </div>
                
            </div>
        </div>
        <div class='content'><div class='write-tool-content'>
        <details class='collapsible-code'>
            <summary>
                <span class='line-count'>1313 lines</span>
                <div class='preview-content'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - User Guide</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">Introduction</span>](<span class="na">#introduction</span>)
</code></pre></div></td></tr></table></div>
</div>
            </summary>
            <div class='code-full'><div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="gh"># Alert Notification Router - User Guide</span>

<span class="gu">## Table of Contents</span>

<span class="k">1.</span> [<span class="nt">Introduction</span>](<span class="na">#introduction</span>)
<span class="k">2.</span> [<span class="nt">Getting Started</span>](<span class="na">#getting-started</span>)
<span class="k">3.</span> [<span class="nt">Installation</span>](<span class="na">#installation</span>)
<span class="k">4.</span> [<span class="nt">Configuration</span>](<span class="na">#configuration</span>)
<span class="k">5.</span> [<span class="nt">Core Concepts</span>](<span class="na">#core-concepts</span>)
<span class="k">6.</span> [<span class="nt">Managing Teams</span>](<span class="na">#managing-teams</span>)
<span class="k">7.</span> [<span class="nt">Creating Routing Rules</span>](<span class="na">#creating-routing-rules</span>)
<span class="k">8.</span> [<span class="nt">Setting Up Notification Channels</span>](<span class="na">#setting-up-notification-channels</span>)
<span class="k">9.</span> [<span class="nt">Working with Alerts</span>](<span class="na">#working-with-alerts</span>)
<span class="k">10.</span> [<span class="nt">Escalation Policies</span>](<span class="na">#escalation-policies</span>)
<span class="k">11.</span> [<span class="nt">API Usage</span>](<span class="na">#api-usage</span>)
<span class="k">12.</span> [<span class="nt">Dashboard Guide</span>](<span class="na">#dashboard-guide</span>)
<span class="k">13.</span> [<span class="nt">Best Practices</span>](<span class="na">#best-practices</span>)
<span class="k">14.</span> [<span class="nt">Troubleshooting</span>](<span class="na">#troubleshooting</span>)
<span class="k">15.</span> [<span class="nt">FAQ</span>](<span class="na">#faq</span>)

---

<span class="gu">## Introduction</span>

<span class="gu">### What is Alert Notification Router?</span>

Alert Notification Router is an intelligent alert management system that automatically routes alerts to the appropriate teams based on configurable rules. It supports multiple notification channels (Email, Slack, PagerDuty), provides alert deduplication, priority handling, escalation policies, and comprehensive delivery tracking.

<span class="gu">### Key Features</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**Intelligent Routing**</span>: Automatically route alerts to the right team based on severity, source, labels, and custom conditions
<span class="k">-</span><span class="w"> </span><span class="gs">**Multi-Channel Notifications**</span>: Send alerts via Email, Slack, and PagerDuty
<span class="k">-</span><span class="w"> </span><span class="gs">**Alert Deduplication**</span>: Prevent duplicate alerts from overwhelming your teams
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority Management**</span>: Prioritize critical alerts for faster response
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Policies**</span>: Automatically escalate unacknowledged alerts to higher-level teams
<span class="k">-</span><span class="w"> </span><span class="gs">**Delivery Tracking**</span>: Monitor notification delivery status and retry failed deliveries
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Management**</span>: Organize users into teams with on-call schedules
<span class="k">-</span><span class="w"> </span><span class="gs">**Analytics Dashboard**</span>: Track alert metrics, response times, and team performance

<span class="gu">### Who Should Use This?</span>

<span class="k">-</span><span class="w"> </span><span class="gs">**DevOps Teams**</span>: Monitor infrastructure and application alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**SRE Teams**</span>: Manage incident response and on-call rotations
<span class="k">-</span><span class="w"> </span><span class="gs">**Engineering Teams**</span>: Route alerts to appropriate service owners
<span class="k">-</span><span class="w"> </span><span class="gs">**Operations Teams**</span>: Centralize alert management across multiple systems

---

<span class="gu">## Getting Started</span>

<span class="gu">### Prerequisites</span>

Before installing Alert Notification Router, ensure you have:

<span class="k">-</span><span class="w"> </span><span class="gs">**Node.js**</span> v20 or higher
<span class="k">-</span><span class="w"> </span><span class="gs">**PostgreSQL**</span> v15 or higher
<span class="k">-</span><span class="w"> </span><span class="gs">**Redis**</span> v7 or higher
<span class="k">-</span><span class="w"> </span><span class="gs">**Docker**</span> (optional, for containerized deployment)
<span class="k">-</span><span class="w"> </span><span class="gs">**SMTP server**</span> or <span class="gs">**SendGrid account**</span> (for email notifications)
<span class="k">-</span><span class="w"> </span><span class="gs">**Slack workspace**</span> (optional, for Slack notifications)
<span class="k">-</span><span class="w"> </span><span class="gs">**PagerDuty account**</span> (optional, for PagerDuty integration)

<span class="gu">### Quick Start (5 Minutes)</span>

<span class="k">1.</span> <span class="gs">**Clone the repository**</span>
<span class="sb">```bash</span>
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/your-org/alert-notification-router.git
<span class="nb">cd</span><span class="w"> </span>alert-notification-router
<span class="sb">```</span>

<span class="k">2.</span> <span class="gs">**Install dependencies**</span>
<span class="sb">```bash</span>
npm<span class="w"> </span>install
<span class="sb">```</span>

<span class="k">3.</span> <span class="gs">**Set up environment variables**</span>
<span class="sb">```bash</span>
cp<span class="w"> </span>.env.example<span class="w"> </span>.env
<span class="c1"># Edit .env with your configuration</span>
<span class="sb">```</span>

<span class="k">4.</span> <span class="gs">**Start Docker services**</span>
<span class="sb">```bash</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>postgres<span class="w"> </span>redis
<span class="sb">```</span>

<span class="k">5.</span> <span class="gs">**Run database migrations**</span>
<span class="sb">```bash</span>
npx<span class="w"> </span>prisma<span class="w"> </span>migrate<span class="w"> </span>deploy
<span class="sb">```</span>

<span class="k">6.</span> <span class="gs">**Seed initial data**</span> (optional)
<span class="sb">```bash</span>
npm<span class="w"> </span>run<span class="w"> </span>seed
<span class="sb">```</span>

<span class="k">7.</span> <span class="gs">**Start the application**</span>
<span class="sb">```bash</span>
npm<span class="w"> </span>run<span class="w"> </span>dev
<span class="sb">```</span>

<span class="k">8.</span> <span class="gs">**Access the dashboard**</span>
Open your browser to <span class="sb">`http://localhost:3000`</span>

---

<span class="gu">## Installation</span>

<span class="gu">### Option 1: Local Development Setup</span>

<span class="gu">#### 1. Install Dependencies</span>

<span class="sb">```bash</span>
npm<span class="w"> </span>install
<span class="sb">```</span>

<span class="gu">#### 2. Configure Environment Variables</span>

Create a <span class="sb">`.env`</span> file in the project root:

<span class="sb">```env</span>
<span class="s"># Application</span>
<span class="s">NODE_ENV=development</span>
<span class="s">PORT=3000</span>
<span class="s">API_BASE_URL=http://localhost:3000</span>

<span class="s"># Database</span>
<span class="s">DATABASE_URL=postgresql://user:password@localhost:5432/alert_router</span>

<span class="s"># Redis</span>
<span class="s">REDIS_URL=redis://localhost:6379</span>

<span class="s"># JWT Authentication</span>
<span class="s">JWT_SECRET=your-secret-key-change-this-in-production</span>
<span class="s">JWT_EXPIRY=15m</span>
<span class="s">JWT_REFRESH_EXPIRY=7d</span>

<span class="s"># Email Configuration</span>
<span class="s">SMTP_HOST=smtp.gmail.com</span>
<span class="s">SMTP_PORT=587</span>
<span class="s">SMTP_SECURE=false</span>
<span class="s">SMTP_USER=your-email@gmail.com</span>
<span class="s">SMTP_PASSWORD=your-app-password</span>
<span class="s">EMAIL_FROM=Alert Router &lt;alerts@example.com&gt;</span>

<span class="s"># Slack Integration</span>
<span class="s">SLACK_BOT_TOKEN=xoxb-your-bot-token</span>
<span class="s">SLACK_SIGNING_SECRET=your-signing-secret</span>

<span class="s"># PagerDuty Integration</span>
<span class="s">PAGERDUTY_API_KEY=your-api-key</span>
<span class="s">PAGERDUTY_EMAIL=your-email@example.com</span>

<span class="s"># Sentry (Error Tracking)</span>
<span class="s">SENTRY_DSN=https://your-sentry-dsn@sentry.io/project-id</span>

<span class="s"># Logging</span>
<span class="s">LOG_LEVEL=info</span>

<span class="s"># Deduplication</span>
<span class="s">DEDUPLICATION_WINDOW_MINUTES=5</span>

<span class="s"># Escalation</span>
<span class="s">ESCALATION_CHECK_INTERVAL_MINUTES=5</span>
<span class="sb">```</span>

<span class="gu">#### 3. Start PostgreSQL and Redis</span>

Using Docker:
<span class="sb">```bash</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d<span class="w"> </span>postgres<span class="w"> </span>redis
<span class="sb">```</span>

Or install locally (macOS):
<span class="sb">```bash</span>
brew<span class="w"> </span>install<span class="w"> </span>postgresql<span class="w"> </span>redis
brew<span class="w"> </span>services<span class="w"> </span>start<span class="w"> </span>postgresql
brew<span class="w"> </span>services<span class="w"> </span>start<span class="w"> </span>redis
<span class="sb">```</span>

<span class="gu">#### 4. Run Database Migrations</span>

<span class="sb">```bash</span>
npx<span class="w"> </span>prisma<span class="w"> </span>migrate<span class="w"> </span>deploy
<span class="sb">```</span>

<span class="gu">#### 5. Start the Application</span>

<span class="sb">```bash</span>
<span class="c1"># Development mode with hot reload</span>
npm<span class="w"> </span>run<span class="w"> </span>dev

<span class="c1"># Production mode</span>
npm<span class="w"> </span>run<span class="w"> </span>build
npm<span class="w"> </span>start
<span class="sb">```</span>

<span class="gu">### Option 2: Docker Deployment</span>

<span class="gu">#### 1. Build Docker Image</span>

<span class="sb">```bash</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>alert-router:latest<span class="w"> </span>.
<span class="sb">```</span>

<span class="gu">#### 2. Run with Docker Compose</span>

<span class="sb">```bash</span>
docker-compose<span class="w"> </span>up<span class="w"> </span>-d
<span class="sb">```</span>

This will start:
<span class="k">-</span><span class="w"> </span>Application server (port 3000)
<span class="k">-</span><span class="w"> </span>PostgreSQL database (port 5432)
<span class="k">-</span><span class="w"> </span>Redis cache (port 6379)

<span class="gu">### Option 3: Cloud Deployment</span>

<span class="gu">#### Deploy to AWS ECS</span>

<span class="k">1.</span> Build and push Docker image to ECR
<span class="k">2.</span> Create ECS task definition
<span class="k">3.</span> Set up RDS PostgreSQL and ElastiCache Redis
<span class="k">4.</span> Configure environment variables in ECS task
<span class="k">5.</span> Create ECS service with load balancer

<span class="gu">#### Deploy to Google Cloud Run</span>

<span class="sb">```bash</span>
<span class="c1"># Build and push to GCR</span>
gcloud<span class="w"> </span>builds<span class="w"> </span>submit<span class="w"> </span>--tag<span class="w"> </span>gcr.io/PROJECT_ID/alert-router

<span class="c1"># Deploy to Cloud Run</span>
gcloud<span class="w"> </span>run<span class="w"> </span>deploy<span class="w"> </span>alert-router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--image<span class="w"> </span>gcr.io/PROJECT_ID/alert-router<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--platform<span class="w"> </span>managed<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--region<span class="w"> </span>us-central1<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--set-env-vars<span class="w"> </span><span class="nv">DATABASE_URL</span><span class="o">=</span>postgresql://...
<span class="sb">```</span>

---

<span class="gu">## Configuration</span>

<span class="gu">### Database Configuration</span>

<span class="gu">#### PostgreSQL Connection</span>

The <span class="sb">`DATABASE_URL`</span> environment variable configures the PostgreSQL connection:

<span class="sb">```</span>
<span class="sb">postgresql://[user]:[password]@[host]:[port]/[database]?schema=public</span>
<span class="sb">```</span>

<span class="gs">**Example**</span>:
<span class="sb">```</span>
<span class="sb">DATABASE_URL=postgresql://admin:secure_password@localhost:5432/alert_router?schema=public</span>
<span class="sb">```</span>

<span class="gu">#### Connection Pool Settings</span>

Configure Prisma connection pool in <span class="sb">`prisma/schema.prisma`</span>:

<span class="sb">```prisma</span>
<span class="s">datasource db {</span>
<span class="s">  provider = &quot;postgresql&quot;</span>
<span class="s">  url      = env(&quot;DATABASE_URL&quot;)</span>
<span class="s">}</span>

<span class="s">generator client {</span>
<span class="s">  provider = &quot;prisma-client-js&quot;</span>
<span class="s">  previewFeatures = [&quot;postgresqlExtensions&quot;]</span>
<span class="s">}</span>
<span class="sb">```</span>

<span class="gu">### Redis Configuration</span>

Configure Redis for caching and deduplication:

<span class="sb">```env</span>
<span class="s">REDIS_URL=redis://localhost:6379</span>
<span class="s">REDIS_PASSWORD=your-redis-password  # If authentication enabled</span>
<span class="s">REDIS_TLS=false                      # Set to true for TLS connections</span>
<span class="sb">```</span>

<span class="gu">### Email Configuration</span>

<span class="gu">#### SMTP Configuration</span>

<span class="sb">```env</span>
<span class="s">SMTP_HOST=smtp.gmail.com</span>
<span class="s">SMTP_PORT=587</span>
<span class="s">SMTP_SECURE=false</span>
<span class="s">SMTP_USER=your-email@gmail.com</span>
<span class="s">SMTP_PASSWORD=your-app-password</span>
<span class="s">EMAIL_FROM=Alert Router &lt;alerts@example.com&gt;</span>
<span class="sb">```</span>

<span class="gu">#### SendGrid Configuration</span>

<span class="sb">```env</span>
<span class="s">SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
<span class="s">EMAIL_FROM=Alert Router &lt;alerts@example.com&gt;</span>
<span class="sb">```</span>

<span class="gu">### Slack Configuration</span>

<span class="k">1.</span> <span class="gs">**Create a Slack App**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Go to https://api.slack.com/apps
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Click &quot;Create New App&quot;
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Choose &quot;From scratch&quot;
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Name your app &quot;Alert Router&quot;

<span class="k">2.</span> <span class="gs">**Add Bot Token Scopes**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Navigate to &quot;OAuth &amp; Permissions&quot;
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Add scopes: <span class="sb">`chat:write`</span>, <span class="sb">`chat:write.public`</span>, <span class="sb">`channels:read`</span>, <span class="sb">`users:read`</span>

<span class="k">3.</span> <span class="gs">**Install App to Workspace**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Click &quot;Install to Workspace&quot;
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Copy the &quot;Bot User OAuth Token&quot;

<span class="k">4.</span> <span class="gs">**Configure Environment Variables**</span>
<span class="sb">```env</span>
<span class="s">SLACK_BOT_TOKEN=xoxb-your-bot-token</span>
<span class="s">SLACK_SIGNING_SECRET=your-signing-secret</span>
<span class="sb">```</span>

<span class="k">5.</span> <span class="gs">**Invite Bot to Channels**</span>
<span class="sb">```</span>
<span class="sb">/invite @AlertRouter</span>
<span class="sb">```</span>

<span class="gu">### PagerDuty Configuration</span>

<span class="k">1.</span> <span class="gs">**Create API Key**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Go to PagerDuty ‚Üí Configuration ‚Üí API Access
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create a new API key with full access

<span class="k">2.</span> <span class="gs">**Get Service Integration Key**</span>
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Navigate to Services ‚Üí Your Service ‚Üí Integrations
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Create &quot;Events API V2&quot; integration
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Copy the Integration Key

<span class="k">3.</span> <span class="gs">**Configure Environment Variables**</span>
<span class="sb">```env</span>
<span class="s">PAGERDUTY_API_KEY=your-api-key</span>
<span class="s">PAGERDUTY_EMAIL=your-email@example.com</span>
<span class="sb">```</span>

---

<span class="gu">## Core Concepts</span>

<span class="gu">### Alerts</span>

An <span class="gs">**alert**</span> is a notification about an event or condition that requires attention. Alerts have:

<span class="k">-</span><span class="w"> </span><span class="gs">**Source**</span>: Where the alert came from (e.g., Prometheus, Grafana, custom app)
<span class="k">-</span><span class="w"> </span><span class="gs">**Severity**</span>: Critical, high, medium, or low
<span class="k">-</span><span class="w"> </span><span class="gs">**Status**</span>: Open, acknowledged, resolved, or suppressed
<span class="k">-</span><span class="w"> </span><span class="gs">**Labels**</span>: Key-value pairs for categorization (e.g., <span class="sb">`environment: production`</span>)
<span class="k">-</span><span class="w"> </span><span class="gs">**Fingerprint**</span>: Unique identifier for deduplication

<span class="gu">### Teams</span>

A <span class="gs">**team**</span> is a group of users responsible for handling specific types of alerts. Teams have:

<span class="k">-</span><span class="w"> </span><span class="gs">**Members**</span>: Users assigned to the team
<span class="k">-</span><span class="w"> </span><span class="gs">**On-call Schedule**</span>: Rotating on-call assignments
<span class="k">-</span><span class="w"> </span><span class="gs">**Notification Channels**</span>: Preferred communication methods
<span class="k">-</span><span class="w"> </span><span class="gs">**Escalation Policies**</span>: Rules for escalating unacknowledged alerts

<span class="gu">### Routing Rules</span>

<span class="gs">**Routing rules**</span> determine which team receives an alert based on conditions like:

<span class="k">-</span><span class="w"> </span>Alert severity
<span class="k">-</span><span class="w"> </span>Alert source
<span class="k">-</span><span class="w"> </span>Label matching
<span class="k">-</span><span class="w"> </span>Regex patterns

Rules are evaluated in priority order, and the first matching rule determines the target team.

<span class="gu">### Notification Channels</span>

<span class="gs">**Notification channels**</span> are the methods used to deliver alerts:

<span class="k">-</span><span class="w"> </span><span class="gs">**Email**</span>: Send alerts to team email addresses or individual members
<span class="k">-</span><span class="w"> </span><span class="gs">**Slack**</span>: Post alerts to Slack channels or direct messages
<span class="k">-</span><span class="w"> </span><span class="gs">**PagerDuty**</span>: Create incidents in PagerDuty

<span class="gu">### Escalation Policies</span>

<span class="gs">**Escalation policies**</span> define what happens when alerts are not acknowledged within a timeout period:

<span class="k">-</span><span class="w"> </span><span class="gs">**Level 1**</span>: Initial notification to primary team (timeout: 15 minutes)
<span class="k">-</span><span class="w"> </span><span class="gs">**Level 2**</span>: Escalate to secondary team (timeout: 30 minutes)
<span class="k">-</span><span class="w"> </span><span class="gs">**Level 3**</span>: Escalate to leadership or on-call manager

<span class="gu">### Deduplication</span>

<span class="gs">**Deduplication**</span> prevents multiple identical alerts from being sent. Alerts with the same fingerprint within a time window are merged into a single alert with an incremented count.

---

<span class="gu">## Managing Teams</span>

<span class="gu">### Creating a Team</span>

<span class="gu">#### Via API</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/teams<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;Platform Team&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;Infrastructure and platform services&quot;,</span>
<span class="s1">    &quot;email&quot;: &quot;platform@example.com&quot;,</span>
<span class="s1">    &quot;slackChannelId&quot;: &quot;C123456789&quot;,</span>
<span class="s1">    &quot;pagerdutyServiceId&quot;: &quot;PSERVICE1&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">#### Via Dashboard</span>

<span class="k">1.</span> Navigate to <span class="gs">**Teams**</span> ‚Üí <span class="gs">**Create Team**</span>
<span class="k">2.</span> Fill in team details:
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Team name
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Description
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Contact email
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Slack channel ID (optional)
<span class="w">   </span><span class="k">-</span><span class="w"> </span>PagerDuty service ID (optional)
<span class="k">3.</span> Click <span class="gs">**Create Team**</span>

<span class="gu">### Adding Team Members</span>

<span class="gu">#### Via API</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/teams/<span class="o">{</span>teamId<span class="o">}</span>/members<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;userId&quot;: &quot;user-id-123&quot;,</span>
<span class="s1">    &quot;role&quot;: &quot;member&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">#### Via Dashboard</span>

<span class="k">1.</span> Navigate to <span class="gs">**Teams**</span> ‚Üí Select team ‚Üí <span class="gs">**Members**</span>
<span class="k">2.</span> Click <span class="gs">**Add Member**</span>
<span class="k">3.</span> Select user from dropdown
<span class="k">4.</span> Assign role (member, lead, manager)
<span class="k">5.</span> Click <span class="gs">**Add**</span>

<span class="gu">### Setting On-Call Schedules</span>

<span class="gu">#### Mark User as On-Call</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>PATCH<span class="w"> </span>http://localhost:3000/api/teams/<span class="o">{</span>teamId<span class="o">}</span>/members/<span class="o">{</span>userId<span class="o">}</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;isOnCall&quot;: true,</span>
<span class="s1">    &quot;onCallStart&quot;: &quot;2025-11-18T00:00:00Z&quot;,</span>
<span class="s1">    &quot;onCallEnd&quot;: &quot;2025-11-25T00:00:00Z&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">#### Via Dashboard</span>

<span class="k">1.</span> Navigate to <span class="gs">**Teams**</span> ‚Üí Select team ‚Üí <span class="gs">**On-Call Schedule**</span>
<span class="k">2.</span> Click <span class="gs">**Edit Schedule**</span>
<span class="k">3.</span> Select user and set on-call period
<span class="k">4.</span> Save changes

---

<span class="gu">## Creating Routing Rules</span>

Routing rules determine how alerts are distributed to teams.

<span class="gu">### Rule Structure</span>

A routing rule consists of:

<span class="k">-</span><span class="w"> </span><span class="gs">**Name**</span>: Descriptive name (e.g., &quot;Production Critical Alerts&quot;)
<span class="k">-</span><span class="w"> </span><span class="gs">**Priority**</span>: Higher numbers evaluated first (0-1000)
<span class="k">-</span><span class="w"> </span><span class="gs">**Enabled**</span>: Whether the rule is active
<span class="k">-</span><span class="w"> </span><span class="gs">**Match Type**</span>: <span class="sb">`all`</span> (AND), <span class="sb">`any`</span> (OR), or <span class="sb">`regex`</span>
<span class="k">-</span><span class="w"> </span><span class="gs">**Conditions**</span>: Criteria for matching alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Target Team**</span>: Team to receive matching alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Notification Channels**</span>: Which channels to use

<span class="gu">### Example: Route Critical Production Alerts</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/rules<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;Production Critical Alerts&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;Route all critical alerts from production to Platform team&quot;,</span>
<span class="s1">    &quot;priority&quot;: 100,</span>
<span class="s1">    &quot;enabled&quot;: true,</span>
<span class="s1">    &quot;matchType&quot;: &quot;all&quot;,</span>
<span class="s1">    &quot;conditions&quot;: {</span>
<span class="s1">      &quot;severity&quot;: [&quot;critical&quot;],</span>
<span class="s1">      &quot;labels&quot;: {</span>
<span class="s1">        &quot;environment&quot;: &quot;production&quot;</span>
<span class="s1">      }</span>
<span class="s1">    },</span>
<span class="s1">    &quot;targetTeamId&quot;: &quot;team-platform-id&quot;,</span>
<span class="s1">    &quot;notificationChannels&quot;: [&quot;email&quot;, &quot;slack&quot;, &quot;pagerduty&quot;]</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">### Example: Route Database Alerts</span>

<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Database Alerts&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">90</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;any&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;source&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;prometheus&quot;</span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;component&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;database&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;targetTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;team-database-id&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notificationChannels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;email&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;slack&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">### Example: Route by Regex Pattern</span>

<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;API Error Alerts&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;priority&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">80</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;enabled&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;matchType&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;regex&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;conditions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;.*API.*error.*&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;labels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;service&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;api-.*&quot;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">  </span><span class="p">},</span>
<span class="w">  </span><span class="nt">&quot;targetTeamId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;team-backend-id&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;notificationChannels&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;slack&quot;</span><span class="p">]</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">### Rule Priority and Evaluation</span>

Rules are evaluated in <span class="gs">**descending priority order**</span> (highest first). The <span class="gs">**first matching rule**</span> determines the target team.

<span class="gs">**Example Priority Scheme**</span>:
<span class="k">-</span><span class="w"> </span><span class="gs">**100-199**</span>: Critical production alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**80-99**</span>: High-priority service-specific alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**50-79**</span>: Medium-priority alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**1-49**</span>: Low-priority and catch-all rules
<span class="k">-</span><span class="w"> </span><span class="gs">**0**</span>: Default rule (no conditions, matches everything)

<span class="gu">### Testing Rules</span>

Before enabling a rule, test it against sample alerts:

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/rules/test<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;rule&quot;: {</span>
<span class="s1">      &quot;matchType&quot;: &quot;all&quot;,</span>
<span class="s1">      &quot;conditions&quot;: {</span>
<span class="s1">        &quot;severity&quot;: [&quot;critical&quot;],</span>
<span class="s1">        &quot;labels&quot;: {</span>
<span class="s1">          &quot;environment&quot;: &quot;production&quot;</span>
<span class="s1">        }</span>
<span class="s1">      }</span>
<span class="s1">    },</span>
<span class="s1">    &quot;alert&quot;: {</span>
<span class="s1">      &quot;severity&quot;: &quot;critical&quot;,</span>
<span class="s1">      &quot;labels&quot;: {</span>
<span class="s1">        &quot;environment&quot;: &quot;production&quot;,</span>
<span class="s1">        &quot;service&quot;: &quot;api&quot;</span>
<span class="s1">      }</span>
<span class="s1">    }</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gs">**Response**</span>:
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;matches&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;explanation&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Alert matches all conditions&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

---

<span class="gu">## Setting Up Notification Channels</span>

<span class="gu">### Email Notifications</span>

Email notifications are sent to:
<span class="k">-</span><span class="w"> </span>Team email address
<span class="k">-</span><span class="w"> </span>On-call team members
<span class="k">-</span><span class="w"> </span>Individual users (if specified)

<span class="gs">**Email Template Customization**</span>:

Edit <span class="sb">`src/templates/email/alert.hbs`</span>:

<span class="sb">```html</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Alert Notification<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">h2</span><span class="p">&gt;</span>{{ severity }} Alert: {{ title }}<span class="p">&lt;/</span><span class="nt">h2</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Source:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ source }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Description:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ description }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Time:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span> {{ createdAt }}<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>Labels:<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">ul</span><span class="p">&gt;</span>
        {{#each labels}}
        <span class="p">&lt;</span><span class="nt">li</span><span class="p">&gt;</span>{{ @key }}: {{ this }}<span class="p">&lt;/</span><span class="nt">li</span><span class="p">&gt;</span>
        {{/each}}
    <span class="p">&lt;/</span><span class="nt">ul</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ alertUrl }}&quot;</span><span class="p">&gt;</span>View Alert<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="sb">```</span>

<span class="gu">### Slack Notifications</span>

<span class="gu">#### 1. Configure Slack Channel</span>

When creating a team, specify the Slack channel ID:

<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Platform Team&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;slackChannelId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;C123456789&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

To find a channel ID:
<span class="k">1.</span> Right-click on the channel in Slack
<span class="k">2.</span> Select &quot;View channel details&quot;
<span class="k">3.</span> Scroll down to find the Channel ID

<span class="gu">#### 2. Customize Slack Message Format</span>

Edit <span class="sb">`src/services/notificationChannels/slackProvider.ts`</span>:

<span class="sb">```typescript</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">channel</span><span class="o">:</span><span class="w"> </span><span class="kt">channelId</span><span class="p">,</span>
<span class="w">    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`*</span><span class="si">${</span><span class="nx">alert</span><span class="p">.</span><span class="nx">severity</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">* Alert`</span><span class="p">,</span>
<span class="w">    </span><span class="nx">blocks</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;header&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;plain_text&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`üö® </span><span class="si">${</span><span class="nx">alert</span><span class="p">.</span><span class="nx">severity</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb"> Alert`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;section&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">fields</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mrkdwn&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`*Title:*\n</span><span class="si">${</span><span class="nx">alert</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mrkdwn&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`*Source:*\n</span><span class="si">${</span><span class="nx">alert</span><span class="p">.</span><span class="nx">source</span><span class="si">}</span><span class="sb">`</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;section&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;mrkdwn&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`*Description:*\n</span><span class="si">${</span><span class="nx">alert</span><span class="p">.</span><span class="nx">description</span><span class="si">}</span><span class="sb">`</span>
<span class="w">            </span><span class="p">}</span>
<span class="w">        </span><span class="p">},</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;actions&#39;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">elements</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;plain_text&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Acknowledge&#39;</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">alert.id</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">action_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;acknowledge_alert&#39;</span>
<span class="w">                </span><span class="p">},</span>
<span class="w">                </span><span class="p">{</span>
<span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;button&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;plain_text&#39;</span><span class="p">,</span>
<span class="w">                        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Resolve&#39;</span>
<span class="w">                    </span><span class="p">},</span>
<span class="w">                    </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">alert.id</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">action_id</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;resolve_alert&#39;</span><span class="p">,</span>
<span class="w">                    </span><span class="nx">style</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;primary&#39;</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">};</span>
<span class="sb">```</span>

<span class="gu">### PagerDuty Integration</span>

<span class="gu">#### 1. Configure PagerDuty Service</span>

When creating a team, specify the PagerDuty service ID:

<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Platform Team&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;pagerdutyServiceId&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;PSERVICE1&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">#### 2. Severity Mapping</span>

PagerDuty incidents are created with severity mapping:

<span class="k">-</span><span class="w"> </span><span class="gs">**Critical**</span> ‚Üí PagerDuty P1
<span class="k">-</span><span class="w"> </span><span class="gs">**High**</span> ‚Üí PagerDuty P2
<span class="k">-</span><span class="w"> </span><span class="gs">**Medium**</span> ‚Üí PagerDuty P3
<span class="k">-</span><span class="w"> </span><span class="gs">**Low**</span> ‚Üí PagerDuty P4

<span class="gu">#### 3. Incident Synchronization</span>

When an alert is acknowledged or resolved in Alert Router, the corresponding PagerDuty incident is automatically updated.

---

<span class="gu">## Working with Alerts</span>

<span class="gu">### Creating Alerts</span>

<span class="gu">#### Via API</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/alerts<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;source&quot;: &quot;prometheus&quot;,</span>
<span class="s1">    &quot;externalId&quot;: &quot;alert-12345&quot;,</span>
<span class="s1">    &quot;title&quot;: &quot;High CPU Usage on prod-server-01&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;CPU usage exceeded 90% threshold for 5 minutes&quot;,</span>
<span class="s1">    &quot;severity&quot;: &quot;high&quot;,</span>
<span class="s1">    &quot;labels&quot;: {</span>
<span class="s1">      &quot;environment&quot;: &quot;production&quot;,</span>
<span class="s1">      &quot;service&quot;: &quot;api&quot;,</span>
<span class="s1">      &quot;instance&quot;: &quot;prod-server-01&quot;,</span>
<span class="s1">      &quot;region&quot;: &quot;us-east-1&quot;</span>
<span class="s1">    },</span>
<span class="s1">    &quot;metadata&quot;: {</span>
<span class="s1">      &quot;metric&quot;: &quot;cpu_usage_percent&quot;,</span>
<span class="s1">      &quot;threshold&quot;: 90,</span>
<span class="s1">      &quot;current_value&quot;: 95.3,</span>
<span class="s1">      &quot;duration_minutes&quot;: 5</span>
<span class="s1">    }</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">#### Via Dashboard</span>

<span class="k">1.</span> Navigate to <span class="gs">**Alerts**</span> ‚Üí <span class="gs">**Create Alert**</span>
<span class="k">2.</span> Fill in alert details
<span class="k">3.</span> Add labels (key-value pairs)
<span class="k">4.</span> Click <span class="gs">**Create**</span>

<span class="gu">### Viewing Alerts</span>

<span class="gu">#### List All Alerts</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>http://localhost:3000/api/alerts<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

<span class="gu">#### Filter Alerts</span>

<span class="sb">```bash</span>
<span class="c1"># By severity</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/alerts?severity=critical&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>

<span class="c1"># By status</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/alerts?status=open&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>

<span class="c1"># By team</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/alerts?teamId=team-123&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>

<span class="c1"># Multiple filters</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/alerts?severity=critical&amp;status=open&amp;environment=production&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

<span class="gu">#### Pagination</span>

<span class="sb">```bash</span>
curl<span class="w"> </span><span class="s2">&quot;http://localhost:3000/api/alerts?limit=20&amp;offset=0&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

<span class="gu">### Acknowledging Alerts</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/alerts/<span class="o">{</span>alertId<span class="o">}</span>/acknowledge<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

<span class="gs">**Response**</span>:
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;alert-123&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;status&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;acknowledged&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;acknowledgedBy&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-456&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;acknowledgedAt&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2025-11-18T10:30:00Z&quot;</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">### Resolving Alerts</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/alerts/<span class="o">{</span>alertId<span class="o">}</span>/resolve<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;resolution&quot;: &quot;Increased CPU capacity by adding 2 more instances&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">### Suppressing Alerts</span>

Temporarily suppress alerts (e.g., during maintenance):

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/alerts/<span class="o">{</span>alertId<span class="o">}</span>/suppress<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;reason&quot;: &quot;Scheduled maintenance window&quot;,</span>
<span class="s1">    &quot;suppressUntil&quot;: &quot;2025-11-18T14:00:00Z&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">### Alert History</span>

View complete alert history including state changes:

<span class="sb">```bash</span>
curl<span class="w"> </span>http://localhost:3000/api/alerts/<span class="o">{</span>alertId<span class="o">}</span>/history<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

---

<span class="gu">## Escalation Policies</span>

Escalation policies ensure that unacknowledged critical alerts are escalated to higher-level teams or on-call managers.

<span class="gu">### Creating an Escalation Policy</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/escalation-policies<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;name&quot;: &quot;Platform Team Escalation&quot;,</span>
<span class="s1">    &quot;description&quot;: &quot;Escalation policy for platform alerts&quot;,</span>
<span class="s1">    &quot;teamId&quot;: &quot;team-platform-id&quot;,</span>
<span class="s1">    &quot;enabled&quot;: true,</span>
<span class="s1">    &quot;levels&quot;: [</span>
<span class="s1">      {</span>
<span class="s1">        &quot;level&quot;: 1,</span>
<span class="s1">        &quot;timeout_minutes&quot;: 15,</span>
<span class="s1">        &quot;target_team_id&quot;: &quot;team-platform-id&quot;,</span>
<span class="s1">        &quot;channels&quot;: [&quot;email&quot;, &quot;slack&quot;]</span>
<span class="s1">      },</span>
<span class="s1">      {</span>
<span class="s1">        &quot;level&quot;: 2,</span>
<span class="s1">        &quot;timeout_minutes&quot;: 30,</span>
<span class="s1">        &quot;target_team_id&quot;: &quot;team-senior-engineers-id&quot;,</span>
<span class="s1">        &quot;channels&quot;: [&quot;slack&quot;, &quot;pagerduty&quot;]</span>
<span class="s1">      },</span>
<span class="s1">      {</span>
<span class="s1">        &quot;level&quot;: 3,</span>
<span class="s1">        &quot;timeout_minutes&quot;: 60,</span>
<span class="s1">        &quot;target_team_id&quot;: &quot;team-leadership-id&quot;,</span>
<span class="s1">        &quot;channels&quot;: [&quot;pagerduty&quot;]</span>
<span class="s1">      }</span>
<span class="s1">    ]</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">### How Escalation Works</span>

<span class="k">1.</span> <span class="gs">**Alert Created**</span>: Alert is sent to Level 1 team
<span class="k">2.</span> <span class="gs">**Timeout Check**</span>: System checks every 5 minutes for unacknowledged alerts
<span class="k">3.</span> <span class="gs">**Escalation Triggered**</span>: If alert remains unacknowledged after timeout, escalate to Level 2
<span class="k">4.</span> <span class="gs">**Repeat**</span>: Continue escalating through levels until alert is acknowledged or final level reached
<span class="k">5.</span> <span class="gs">**Acknowledgment**</span>: Escalation stops when alert is acknowledged at any level

<span class="gu">### Viewing Active Escalations</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>http://localhost:3000/api/escalation-policies<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

---

<span class="gu">## API Usage</span>

<span class="gu">### Authentication</span>

All API requests require JWT authentication via the <span class="sb">`Authorization`</span> header.

<span class="gu">#### Register a User</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/auth/register<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;email&quot;: &quot;user@example.com&quot;,</span>
<span class="s1">    &quot;username&quot;: &quot;johndoe&quot;,</span>
<span class="s1">    &quot;password&quot;: &quot;SecurePassword123!&quot;,</span>
<span class="s1">    &quot;fullName&quot;: &quot;John Doe&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gu">#### Login</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>-X<span class="w"> </span>POST<span class="w"> </span>http://localhost:3000/api/auth/login<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Content-Type: application/json&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-d<span class="w"> </span><span class="s1">&#39;{</span>
<span class="s1">    &quot;email&quot;: &quot;user@example.com&quot;,</span>
<span class="s1">    &quot;password&quot;: &quot;SecurePassword123!&quot;</span>
<span class="s1">  }&#39;</span>
<span class="sb">```</span>

<span class="gs">**Response**</span>:
<span class="sb">```json</span>
<span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;accessToken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;refreshToken&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user-123&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;email&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user@example.com&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;username&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;johndoe&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;role&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
<span class="sb">```</span>

<span class="gu">#### Use Access Token</span>

<span class="sb">```bash</span>
curl<span class="w"> </span>http://localhost:3000/api/alerts<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...&quot;</span>
<span class="sb">```</span>

<span class="gu">### API Documentation</span>

Full API documentation is available via Swagger:

<span class="sb">```</span>
<span class="sb">http://localhost:3000/api-docs</span>
<span class="sb">```</span>

---

<span class="gu">## Dashboard Guide</span>

The web dashboard provides a user-friendly interface for managing alerts, teams, and routing rules.

<span class="gu">### Dashboard Overview</span>

The main dashboard shows:

<span class="k">-</span><span class="w"> </span><span class="gs">**Active Alerts**</span>: Count of open, acknowledged, and resolved alerts
<span class="k">-</span><span class="w"> </span><span class="gs">**Alert Trends**</span>: Time-series chart of alerts by severity
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Performance**</span>: Average response times per team
<span class="k">-</span><span class="w"> </span><span class="gs">**Notification Delivery**</span>: Success rate by channel
<span class="k">-</span><span class="w"> </span><span class="gs">**Recent Alerts**</span>: List of latest alerts with quick actions

<span class="gu">### Managing Alerts</span>

<span class="k">1.</span> <span class="gs">**View All Alerts**</span>: Navigate to <span class="gs">**Alerts**</span> page
<span class="k">2.</span> <span class="gs">**Filter**</span>: Use severity, status, team, and date filters
<span class="k">3.</span> <span class="gs">**Acknowledge**</span>: Click <span class="gs">**Acknowledge**</span> button next to alert
<span class="k">4.</span> <span class="gs">**Resolve**</span>: Click <span class="gs">**Resolve**</span> button and add resolution notes
<span class="k">5.</span> <span class="gs">**Details**</span>: Click alert title to view full details

<span class="gu">### Creating Teams</span>

<span class="k">1.</span> Navigate to <span class="gs">**Teams**</span> ‚Üí <span class="gs">**Create Team**</span>
<span class="k">2.</span> Fill in team information
<span class="k">3.</span> Add members by searching for users
<span class="k">4.</span> Configure notification preferences
<span class="k">5.</span> Save team

<span class="gu">### Creating Routing Rules</span>

<span class="k">1.</span> Navigate to <span class="gs">**Rules**</span> ‚Üí <span class="gs">**Create Rule**</span>
<span class="k">2.</span> Enter rule name and description
<span class="k">3.</span> Set priority (higher = evaluated first)
<span class="k">4.</span> Choose match type (all, any, regex)
<span class="k">5.</span> Add conditions:
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Severity
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Source
<span class="w">   </span><span class="k">-</span><span class="w"> </span>Labels
<span class="k">6.</span> Select target team
<span class="k">7.</span> Choose notification channels
<span class="k">8.</span> Test rule (optional)
<span class="k">9.</span> Enable and save

<span class="gu">### Analytics</span>

Navigate to <span class="gs">**Analytics**</span> to view:

<span class="k">-</span><span class="w"> </span><span class="gs">**Alert Volume**</span>: Daily/weekly/monthly alert counts
<span class="k">-</span><span class="w"> </span><span class="gs">**Response Times**</span>: Average time to acknowledge and resolve
<span class="k">-</span><span class="w"> </span><span class="gs">**Team Performance**</span>: Alerts handled per team
<span class="k">-</span><span class="w"> </span><span class="gs">**Channel Performance**</span>: Delivery success rates
<span class="k">-</span><span class="w"> </span><span class="gs">**MTTR**</span>: Mean Time To Resolution

---

<span class="gu">## Best Practices</span>

<span class="gu">### Routing Rules</span>

<span class="k">1.</span> <span class="gs">**Use Clear Naming**</span>: Name rules descriptively (e.g., &quot;Production Database Critical Alerts&quot;)
<span class="k">2.</span> <span class="gs">**Set Appropriate Priorities**</span>: Critical alerts should have highest priority rules
<span class="k">3.</span> <span class="gs">**Test Before Enabling**</span>: Always test rules with sample alerts
<span class="k">4.</span> <span class="gs">**Avoid Overlapping Rules**</span>: Ensure rules don&#39;t conflict (first match wins)
<span class="k">5.</span> <span class="gs">**Default Catch-All Rule**</span>: Create a low-priority rule that matches everything as a fallback

<span class="gu">### Alert Management</span>

<span class="k">1.</span> <span class="gs">**Acknowledge Promptly**</span>: Acknowledge alerts within 5 minutes to prevent escalation
<span class="k">2.</span> <span class="gs">**Add Context**</span>: When resolving, add notes about resolution steps
<span class="k">3.</span> <span class="gs">**Use Labels Consistently**</span>: Standardize label keys (environment, service, region)
<span class="k">4.</span> <span class="gs">**Set Appropriate Severity**</span>: Reserve &quot;critical&quot; for truly critical issues
<span class="k">5.</span> <span class="gs">**Clean Up Resolved Alerts**</span>: Archive or delete old resolved alerts periodically

<span class="gu">### Team Organization</span>

<span class="k">1.</span> <span class="gs">**Logical Grouping**</span>: Group users by responsibility (e.g., Database Team, API Team)
<span class="k">2.</span> <span class="gs">**On-Call Rotation**</span>: Maintain fair on-call rotation schedules
<span class="k">3.</span> <span class="gs">**Multiple Teams**</span>: Users can be members of multiple teams
<span class="k">4.</span> <span class="gs">**Team Hierarchy**</span>: Set up escalation chains (Level 1 ‚Üí Level 2 ‚Üí Level 3)

<span class="gu">### Notification Channels</span>

<span class="k">1.</span> <span class="gs">**Channel Selection**</span>: Use appropriate channels based on severity
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="gs">**Email**</span>: Low to medium severity
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="gs">**Slack**</span>: Medium to high severity
<span class="w">   </span><span class="k">-</span><span class="w"> </span><span class="gs">**PagerDuty**</span>: High to critical severity
<span class="k">2.</span> <span class="gs">**Avoid Alert Fatigue**</span>: Don&#39;t send all alerts to all channels
<span class="k">3.</span> <span class="gs">**Test Integrations**</span>: Regularly test Slack and PagerDuty integrations
<span class="k">4.</span> <span class="gs">**Monitor Delivery**</span>: Check notification delivery success rates

<span class="gu">### Security</span>

<span class="k">1.</span> <span class="gs">**Strong Passwords**</span>: Enforce strong password policies
<span class="k">2.</span> <span class="gs">**JWT Secrets**</span>: Use strong, randomly generated JWT secrets
<span class="k">3.</span> <span class="gs">**API Keys**</span>: Rotate API keys regularly
<span class="k">4.</span> <span class="gs">**Rate Limiting**</span>: Enable rate limiting to prevent abuse
<span class="k">5.</span> <span class="gs">**HTTPS Only**</span>: Always use HTTPS in production

---

<span class="gu">## Troubleshooting</span>

<span class="gu">### Common Issues</span>

<span class="gu">#### Alerts Not Being Routed</span>

<span class="gs">**Symptoms**</span>: Alerts are created but not assigned to any team

<span class="gs">**Solutions**</span>:
<span class="k">1.</span> Check if any routing rules are enabled
<span class="k">2.</span> Verify rule conditions match alert properties
<span class="k">3.</span> Check rule priority order
<span class="k">4.</span> Create a default catch-all rule

<span class="sb">```bash</span>
<span class="c1"># Check active rules</span>
curl<span class="w"> </span>http://localhost:3000/api/rules?enabled<span class="o">=</span><span class="nb">true</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>-H<span class="w"> </span><span class="s2">&quot;Authorization: Bearer YOUR_TOKEN&quot;</span>
<span class="sb">```</span>

<span class="gu">#### Notifications Not Sending</span>

<span class="gs">**Symptoms**</span>: Alerts are routed but notifications fail

<span class="gs">**Solutions**</span>:

<span class="gs">**Email Issues**</span>:
<span class="k">1.</span> Verify SMTP credentials in <span class="sb">`.env`</span>
<span class="k">2.</span> Check firewall allows SMTP port (587/465)
<span class="k">3.</span> Review logs: <span class="sb">`docker logs alert-router | grep email`</span>

<span class="sb">```bash</span>
<span class="c1"># Test email configuration</span>
npm<span class="w"> </span>run<span class="w"> </span>test:email
<span class="sb">```</span>

<span class="gs">**Slack Issues**</span>:
<span class="k">1.</span> Verify Slack bot token is valid
<span class="k">2.</span> Check bot is invited to channels
<span class="k">3.</span> Verify bot has correct permissions

<span class="sb">```bash</span>
<span class="c1"># Test Slack integration</span>
npm<span class="w"> </span>run<span class="w"> </span>test:slack
<span class="sb">```</span>

<span class="gs">**PagerDuty Issues**</span>:
<span class="k">1.</span> Verify API key is valid
<span class="k">2.</span> Check service ID is correct
<span class="k">3.</span> Review PagerDuty incident creation logs

<span class="gu">#### Database Connection Errors</span>

<span class="gs">**Symptoms**</span>: <span class="sb">`ECONNREFUSED`</span> or connection timeout errors

<span class="gs">**Solutions**</span>:
<span class="k">1.</span> Verify PostgreSQL is running: <span class="sb">`docker ps`</span>
<span class="k">2.</span> Check DATABASE_URL format
<span class="k">3.</span> Ensure database exists: <span class="sb">`psql -U user -l`</span>
<span class="k">4.</span> Run migrations: <span class="sb">`npx prisma migrate deploy`</span>

<span class="gu">#### Redis Connection Errors</span>

<span class="gs">**Symptoms**</span>: Deduplication not working, caching errors

<span class="gs">**Solutions**</span>:
<span class="k">1.</span> Verify Redis is running: <span class="sb">`docker ps`</span>
<span class="k">2.</span> Check REDIS_URL format
<span class="k">3.</span> Test Redis connection: <span class="sb">`redis-cli ping`</span>

<span class="gu">#### High Memory Usage</span>

<span class="gs">**Symptoms**</span>: Application consuming excessive memory

<span class="gs">**Solutions**</span>:
<span class="k">1.</span> Enable connection pooling
<span class="k">2.</span> Adjust Prisma connection pool size
<span class="k">3.</span> Review queue size limits
<span class="k">4.</span> Monitor for memory leaks with Clinic.js

<span class="sb">```bash</span>
<span class="c1"># Profile memory usage</span>
npm<span class="w"> </span>run<span class="w"> </span>profile:memory
<span class="sb">```</span>

<span class="gu">### Debugging</span>

Enable debug logging:

<span class="sb">```env</span>
<span class="s">LOG_LEVEL=debug</span>
<span class="sb">```</span>

View application logs:

<span class="sb">```bash</span>
<span class="c1"># Docker</span>
docker<span class="w"> </span>logs<span class="w"> </span>-f<span class="w"> </span>alert-router

<span class="c1"># Local</span>
tail<span class="w"> </span>-f<span class="w"> </span>logs/app.log
<span class="sb">```</span>

Enable Prisma query logging:

<span class="sb">```typescript</span>
<span class="c1">// In instrument.ts or prisma setup</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">prisma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PrismaClient</span><span class="p">({</span>
<span class="w">    </span><span class="nx">log</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;warn&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;error&#39;</span><span class="p">],</span>
<span class="p">});</span>
<span class="sb">```</span>

<span class="gu">### Getting Help</span>

<span class="k">1.</span> <span class="gs">**Check Logs**</span>: Review application logs for errors
<span class="k">2.</span> <span class="gs">**GitHub Issues**</span>: Search for similar issues at https://github.com/your-org/alert-router/issues
<span class="k">3.</span> <span class="gs">**Documentation**</span>: Review API documentation at <span class="sb">`/api-docs`</span>
<span class="k">4.</span> <span class="gs">**Support**</span>: Contact support at support@example.com

---

<span class="gu">## FAQ</span>

<span class="gu">### General Questions</span>

<span class="gs">**Q: Can I integrate with monitoring systems like Prometheus or Grafana?**</span>

A: Yes! Configure your monitoring system to send alerts to our API endpoint:
<span class="sb">```</span>
<span class="sb">POST http://your-domain.com/api/alerts</span>
<span class="sb">```</span>

<span class="gs">**Q: How many alerts can the system handle?**</span>

A: The system can handle 1000+ alerts per minute with proper infrastructure (PostgreSQL, Redis, multiple workers).

<span class="gs">**Q: Is there a mobile app?**</span>

A: Not yet, but it&#39;s on the roadmap. For now, use Slack or PagerDuty mobile apps for notifications.

<span class="gu">### Routing &amp; Notifications</span>

<span class="gs">**Q: What happens if no routing rule matches an alert?**</span>

A: If no rule matches, the alert is created but not assigned to any team. Create a default catch-all rule to prevent this.

<span class="gs">**Q: Can I route the same alert to multiple teams?**</span>

A: Currently, each alert is routed to one team. Use escalation policies to notify additional teams after a timeout.

<span class="gs">**Q: How quickly are notifications sent?**</span>

A: Notifications are sent within 5 seconds of alert creation (target p95 performance).

<span class="gu">### Deduplication</span>

<span class="gs">**Q: How long is the deduplication window?**</span>

A: Default is 5 minutes, configurable via <span class="sb">`DEDUPLICATION_WINDOW_MINUTES`</span> environment variable.

<span class="gs">**Q: What happens to duplicate alerts?**</span>

A: Duplicates increment a counter on the original alert and update the &quot;last seen&quot; timestamp.

<span class="gu">### Escalation</span>

<span class="gs">**Q: Can I skip escalation levels?**</span>

A: No, escalation proceeds sequentially through levels. Design your policy with appropriate timeout values.

<span class="gs">**Q: What stops an escalation?**</span>

A: Acknowledging or resolving the alert stops all escalation.

<span class="gu">### Security</span>

<span class="gs">**Q: How are API keys and passwords stored?**</span>

A: Passwords are hashed with bcrypt (12 rounds). API keys are encrypted at rest.

<span class="gs">**Q: Can I use SSO/SAML for authentication?**</span>

A: SAML/SSO support is planned for a future release.

<span class="gs">**Q: Is the system GDPR compliant?**</span>

A: Yes, audit logs can be configured to anonymize personal data.

<span class="gu">### Performance</span>

<span class="gs">**Q: How do I scale the system for high load?**</span>

A: Run multiple application instances behind a load balancer. Use PostgreSQL read replicas and Redis cluster.

<span class="gs">**Q: What are the resource requirements?**</span>

A: Minimum: 2 CPU cores, 4GB RAM. Recommended: 4+ cores, 8GB+ RAM for production.

---

<span class="gu">## Conclusion</span>

You&#39;re now ready to use the Alert Notification Router! For more advanced topics, refer to:

<span class="k">-</span><span class="w"> </span>[<span class="nt">Development Plan</span>](<span class="na">../plan/DevelopmentPlan.md</span>) - Architecture and implementation details
<span class="k">-</span><span class="w"> </span>[<span class="nt">Testing Plan</span>](<span class="na">../testing/TestingPlan.md</span>) - Testing strategy and test cases
<span class="k">-</span><span class="w"> </span>[<span class="nt">API Documentation</span>](<span class="na">http://localhost:3000/api-docs</span>) - Full API reference

Need help? Contact support@example.com or open an issue on GitHub.

---

<span class="gs">**Version**</span>: 1.0.0
<span class="gs">**Last Updated**</span>: November 18, 2025
<span class="gs">**License**</span>: MIT
</code></pre></div></td></tr></table></div>
</div>
        </details>
        </div></div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01QYxAwhYApcB3wxQucmUYSs"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:29.994Z' data-duration='took 286 ms'>2025-11-18 14:11:29</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>File created successfully at: /root/Claude/claude-hooks/docs/guides/Guide.md ...</pre></div>
    </div>
    
    
    
    
    <div class='message tool_use paired-message pair_first'>
        <div class='header'>
            <span title="ID: toolu_01WQ5zTorFTht4yhiTG7Xg1L">üìù Todo List</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:37.769Z'>2025-11-18 14:11:37</span>
                </div>
                
            </div>
        </div>
        <div class='content'>
    <div class="todo-list">
        
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create DevelopmentPlan.md with architecture and implementation details</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create TestingPlan.md with comprehensive test strategy</span>
                    <span class="todo-id">#</span>
                </div>
            
                <div class="todo-item completed medium">
                    <input type="checkbox" checked disabled readonly>
                    <span class="todo-status">‚úÖ</span>
                    <span class="todo-content">Create Guide.md with user documentation</span>
                    <span class="todo-id">#</span>
                </div>
            
    </div>
    </div>
    </div>
    
    
    
    
    <div class='message tool_result paired-message pair_last'>
        <div class='header'>
            <span title="ID: toolu_01WQ5zTorFTht4yhiTG7Xg1L"></span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:38.050Z' data-duration='took 281 ms'>2025-11-18 14:11:38</span>
                </div>
                
            </div>
        </div>
        <div class='content'><pre>Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable</pre></div>
    </div>
    
    
    
    
    <div class='message assistant'>
        <div class='header'>
            <span>ü§ñ Assistant</span>
            <div class='header-info'>
                <div class='timestamp-row'>
                    <span class='timestamp' data-timestamp='2025-11-18T14:11:54.581Z'>2025-11-18 14:11:54</span>
                </div>
                
                <span class='token-usage'>Input: 4 | Output: 591 | Cache Creation: 211 | Cache Read: 75242</span>
                
            </div>
        </div>
        <div class='content markdown'><p>Perfect! I've successfully created all three comprehensive documentation files for your Alert Notification Router system:</p>
<h2>Documentation Created</h2>
<h3>1. <strong>DevelopmentPlan.md</strong> ‚Üí <code>docs/plan/DevelopmentPlan.md</code></h3>
<p>Comprehensive development plan including:</p>
<ul>
<li>System architecture with layered design (Routes ‚Üí Controllers ‚Üí Services ‚Üí Repositories)</li>
<li>Complete tech stack (Node.js, TypeScript, Express, Prisma, PostgreSQL, Redis)</li>
<li>Detailed database schema with 9 core tables and complete Prisma schema</li>
<li>RESTful API endpoints for all features</li>
<li>10-phase implementation plan (14 weeks total)</li>
<li>Security considerations and best practices</li>
<li>Scalability and performance guidelines</li>
</ul>
<h3>2. <strong>TestingPlan.md</strong> ‚Üí <code>docs/testing/TestingPlan.md</code></h3>
<p>Comprehensive testing strategy including:</p>
<ul>
<li>Testing pyramid approach (70% unit, 20% integration, 10% E2E)</li>
<li>Detailed test examples for all layers (services, repositories, controllers)</li>
<li>Integration tests for API endpoints and database operations</li>
<li>End-to-end tests for complete alert workflows</li>
<li>Performance testing with Artillery and custom scripts</li>
<li>Security testing (authentication, authorization, input validation)</li>
<li>Test environment setup with Docker Compose</li>
<li>CI/CD integration with GitHub Actions</li>
<li>80%+ code coverage goals</li>
</ul>
<h3>3. <strong>Guide.md</strong> ‚Üí `docs/guides/Guide.md**</h3>
<p>Complete user documentation including:</p>
<ul>
<li>Quick start guide (5-minute setup)</li>
<li>Three installation options (local, Docker, cloud deployment)</li>
<li>Configuration guide for all notification channels (Email, Slack, PagerDuty)</li>
<li>Core concepts explanation (alerts, teams, routing rules, escalation)</li>
<li>Step-by-step guides for common tasks</li>
<li>API usage examples with curl commands</li>
<li>Dashboard navigation guide</li>
<li>Best practices for routing rules, alert management, and team organization</li>
<li>Troubleshooting section with common issues and solutions</li>
<li>Comprehensive FAQ</li>
</ul>
<h2>Key Features Covered</h2>
<p>The system includes:</p>
<ul>
<li><strong>Intelligent routing</strong> with configurable rules and pattern matching</li>
<li><strong>Multi-channel notifications</strong> (Email, Slack, PagerDuty)</li>
<li><strong>Alert deduplication</strong> using fingerprints and Redis caching</li>
<li><strong>Priority handling</strong> for critical alerts</li>
<li><strong>Escalation policies</strong> with multi-level escalation</li>
<li><strong>Delivery tracking</strong> with retry logic</li>
<li><strong>Team management</strong> with on-call schedules</li>
<li><strong>Analytics dashboard</strong> with metrics and reporting</li>
</ul>
<p>All documentation follows best practices from the backend-dev-guidelines and frontend-dev-guidelines skills, ensuring production-quality code structure and modern development patterns.</p>
</div>
    </div>
    
    

    <button class="timeline-toggle floating-btn" id="toggleTimeline" title="Show timeline">üìÜ</button>
    <button class="filter-messages floating-btn" id="filterMessages" title="Search & Filter">üîç</button>
    <button class="toggle-details floating-btn" id="toggleDetails" title="Toggle all details">üìã</button>
    <a class="scroll-top floating-btn" title="Scroll to top" href="#title">üîù</a>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const toggleButton = document.getElementById('toggleDetails');
            const timelineButton = document.getElementById('toggleTimeline');
            const filterButton = document.getElementById('filterMessages');
            const filterToolbar = document.querySelector('.filter-toolbar');
            const selectAllButton = document.getElementById('selectAll');
            const selectNoneButton = document.getElementById('selectNone');
            const closeToolbarButton = document.getElementById('closeToolbar');
            const filterToggles = document.querySelectorAll('.filter-toggle');

            // Timezone conversion (included as component)
            // Convert timestamps to user's timezone
// This function can be called directly or will auto-run on DOMContentLoaded if included standalone
(function() {
    function convertTimestampsToLocalTimezone() {
        const timestampElements = Array.from(document.querySelectorAll('.timestamp[data-timestamp]'));

        if (timestampElements.length === 0) return;

        const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

        const localFormatter = new Intl.DateTimeFormat(undefined, {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false,
            timeZone: userTimezone
        });

        const utcFormatter = new Intl.DateTimeFormat(undefined, {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit',
            second: '2-digit',
            hour12: false,
            timeZone: 'UTC'
        });

        const tzNameFormatter = new Intl.DateTimeFormat('en', {
            timeZoneName: 'short',
            timeZone: userTimezone
        });

        // Process timestamps in batches to keep page responsive
        const batchSize = 25;
        const scheduleWork = window.requestIdleCallback || function(cb) { setTimeout(cb, 16); };

        function processBatch(startIndex) {
            const endIndex = Math.min(startIndex + batchSize, timestampElements.length);

            for (let i = startIndex; i < endIndex; i++) {
                const element = timestampElements[i];
                const rawTimestamp = element.getAttribute('data-timestamp');
                const rawTimestampEnd = element.getAttribute('data-timestamp-end');
                const duration = element.getAttribute('data-duration');

                if (!rawTimestamp) continue;

                try {
                    // Parse the ISO timestamp
                    const date = new Date(rawTimestamp);
                    if (isNaN(date.getTime())) continue; // Invalid date

                    const localTime = localFormatter.format(date).replace(/, /g, ' ');
                    const utcTime = utcFormatter.format(date).replace(/, /g, ' ');

                    // Get timezone abbreviation (reuse formatter)
                    const timezoneName = tzNameFormatter.formatToParts(date).find(part => part.type === 'timeZoneName')?.value || userTimezone;

                    // Handle time ranges (earliest to latest)
                    if (rawTimestampEnd) {
                        const dateEnd = new Date(rawTimestampEnd);
                        if (!isNaN(dateEnd.getTime())) {
                            const localTimeEnd = localFormatter.format(dateEnd).replace(/, /g, ' ');
                            const utcTimeEnd = utcFormatter.format(dateEnd).replace(/, /g, ' ');

                            // Update the element with range
                            if (localTime !== utcTime || localTimeEnd !== utcTimeEnd) {
                                element.innerHTML = localTime + ' to ' + localTimeEnd + ' <span style="color: #888; font-size: 0.9em;">(' + timezoneName + ')</span>';
                                element.title = 'UTC: ' + utcTime + ' to ' + utcTimeEnd;
                            } else {
                                // If they're the same (user is in UTC), just show UTC
                                element.innerHTML = utcTime + ' to ' + utcTimeEnd + ' <span style="color: #888; font-size: 0.9em;">(UTC)</span>';
                                element.title = 'UTC: ' + utcTime + ' to ' + utcTimeEnd;
                            }
                        }
                    } else {
                        // Single timestamp
                        if (localTime !== utcTime) {
                            element.innerHTML = localTime + ' <span style="color: #888; font-size: 0.9em;">(' + timezoneName + ')</span>';
                            element.title = duration ? duration : 'UTC: ' + utcTime;
                        } else {
                            // If they're the same (user is in UTC), just show UTC
                            element.innerHTML = utcTime + ' <span style="color: #888; font-size: 0.9em;">(UTC)</span>';
                            element.title = duration ? duration : 'UTC: ' + utcTime;
                        }
                    }

                } catch (error) {
                    // If conversion fails, leave the original timestamp
                    console.warn('Failed to convert timestamp:', rawTimestamp, error);
                }
            }

            // Schedule next batch if there are more timestamps
            if (endIndex < timestampElements.length) {
                scheduleWork(function() {
                    processBatch(endIndex);
                });
            }
        }

        // Start processing the first batch
        scheduleWork(function() {
            processBatch(0);
        });
    }

    // Execute immediately - assumes this is included within a DOMContentLoaded handler
    convertTimestampsToLocalTimezone();
})();

            // Parse URL parameters
            function getUrlParams() {
                const params = new URLSearchParams(window.location.search);
                return {
                    filter: params.get('filter')  // e.g., "user,assistant"
                };
            }

            // Apply filters from URL parameters
            function applyUrlFilters() {
                const urlParams = getUrlParams();

                // Apply message type filter
                if (urlParams.filter) {
                    const types = urlParams.filter.split(',').map(t => t.trim().toLowerCase());

                    // Deactivate all toggles first
                    filterToggles.forEach(toggle => {
                        toggle.classList.remove('active');
                    });

                    // Activate only the specified types
                    types.forEach(type => {
                        const toggle = document.querySelector(`[data-type="${type}"]`);
                        if (toggle) {
                            toggle.classList.add('active');
                        }
                    });

                    // Show filter toolbar if filters are applied
                    filterToolbar.classList.add('visible');
                    filterButton.classList.add('active');
                }
            }

            // Timeline toggle functionality
            if (timelineButton) {
                timelineButton.addEventListener('click', function () {
                    if (window.toggleTimeline) {
                        window.toggleTimeline();
                    }
                });
            }

            // Toggle details functionality
            function updateToggleButton() {
                const allDetails = document.querySelectorAll('details.collapsible-details');
                const openCount = document.querySelectorAll('details[open].collapsible-details').length;
                const totalCount = allDetails.length;

                if (totalCount === 0) {
                    toggleButton.style.display = 'none';
                    return;
                }

                // If more than half are open, show "close all" state, otherwise show "open all"
                const mostlyOpen = openCount > totalCount / 2;
                toggleButton.textContent = mostlyOpen ? 'üì¶' : 'üóÉÔ∏è';
                toggleButton.title = mostlyOpen ? 'Close all details' : 'Open all details';
            }

            function toggleAllDetails() {
                const allDetails = document.querySelectorAll('details.collapsible-details');
                const openCount = document.querySelectorAll('details[open].collapsible-details').length;
                const shouldOpen = openCount <= allDetails.length / 2;

                allDetails.forEach(details => {
                    if (shouldOpen) {
                        details.setAttribute('open', '');
                    } else {
                        details.removeAttribute('open');
                    }
                });

                updateToggleButton();
            }

            toggleButton.addEventListener('click', toggleAllDetails);

            // Filter toolbar toggle functionality
            function toggleFilterToolbar() {
                const isVisible = filterToolbar.classList.contains('visible');
                if (isVisible) {
                    filterToolbar.classList.remove('visible');
                    filterButton.classList.remove('active');
                    filterButton.title = 'Search & Filter';
                } else {
                    filterToolbar.classList.add('visible');
                    filterButton.classList.add('active');
                    filterButton.title = 'Close';
                    // Focus search input when opening
                    const searchInput = document.getElementById('searchInput');
                    if (searchInput) {
                        setTimeout(() => searchInput.focus(), 100);
                    }
                }
            }

            filterButton.addEventListener('click', toggleFilterToolbar);
            if (closeToolbarButton) {
                closeToolbarButton.addEventListener('click', toggleFilterToolbar);
            }

            // Count messages by type and update button labels
            function updateMessageCounts() {
                const messageTypes = ['user', 'assistant', 'sidechain', 'system', 'thinking', 'image'];

                messageTypes.forEach(type => {
                    const messages = document.querySelectorAll(`.message.${type}:not(.session-header)`);
                    const count = messages.length;
                    const toggle = document.querySelector(`[data-type="${type}"]`);
                    const countSpan = toggle ? toggle.querySelector('.count') : null;

                    if (countSpan) {
                        countSpan.textContent = `(${count})`;

                        // Hide toggles for message types with 0 count
                        if (count === 0) {
                            toggle.style.display = 'none';
                        } else {
                            toggle.style.display = 'flex';
                        }
                    }
                });

                // Handle combined "tool" filter (tool_use + tool_result)
                const toolMessages = document.querySelectorAll(`.message.tool_use:not(.session-header), .message.tool_result:not(.session-header)`);
                const toolCount = toolMessages.length;
                const toolToggle = document.querySelector(`[data-type="tool"]`);
                const toolCountSpan = toolToggle ? toolToggle.querySelector('.count') : null;

                if (toolCountSpan) {
                    toolCountSpan.textContent = `(${toolCount})`;
                    if (toolCount === 0) {
                        toolToggle.style.display = 'none';
                    } else {
                        toolToggle.style.display = 'flex';
                    }
                }
            }

            // Filter functionality
            function applyFilter() {
                const activeTypes = Array.from(filterToggles)
                    .filter(toggle => toggle.classList.contains('active'))
                    .map(toggle => toggle.dataset.type);

                // Expand "tool" to include both tool_use and tool_result
                const expandedTypes = [];
                activeTypes.forEach(type => {
                    if (type === 'tool') {
                        expandedTypes.push('tool_use', 'tool_result');
                    } else {
                        expandedTypes.push(type);
                    }
                });

                // Show/hide messages based on active toggle buttons
                const allMessages = document.querySelectorAll('.message:not(.session-header)');
                allMessages.forEach(message => {
                    let shouldShow = false;

                    // Special handling for sidechain messages
                    if (message.classList.contains('sidechain')) {
                        // For sidechain messages, show if both sidechain filter is active AND their message type filter is active
                        const sidechainActive = expandedTypes.includes('sidechain');
                        const messageTypeActive = expandedTypes.some(type =>
                            type !== 'sidechain' && message.classList.contains(type)
                        );
                        shouldShow = sidechainActive && messageTypeActive;
                    } else {
                        // For non-sidechain messages, show if any of their types are active
                        shouldShow = expandedTypes.some(type => message.classList.contains(type));
                    }

                    if (shouldShow) {
                        message.classList.remove('filtered-hidden');
                    } else {
                        message.classList.add('filtered-hidden');
                    }
                });

                // Update visible counts in real-time
                updateVisibleCounts();

                // Update filter button appearance based on whether all types are selected
                const allTypesSelected = activeTypes.length === filterToggles.length;
                if (!allTypesSelected && filterToolbar.classList.contains('visible')) {
                    filterButton.classList.add('active');
                } else if (allTypesSelected && filterToolbar.classList.contains('visible')) {
                    filterButton.classList.add('active');
                }
            }

            function updateVisibleCounts() {
                const messageTypes = ['user', 'assistant', 'sidechain', 'system', 'thinking', 'image'];

                messageTypes.forEach(type => {
                    const visibleMessages = document.querySelectorAll(`.message.${type}:not(.session-header):not(.filtered-hidden)`);
                    const totalMessages = document.querySelectorAll(`.message.${type}:not(.session-header)`);
                    const visibleCount = visibleMessages.length;
                    const totalCount = totalMessages.length;

                    const toggle = document.querySelector(`[data-type="${type}"]`);
                    const countSpan = toggle ? toggle.querySelector('.count') : null;

                    if (countSpan && totalCount > 0) {
                        // Show "visible/total" format when filtering is active
                        const activeTypes = Array.from(filterToggles)
                            .filter(toggle => toggle.classList.contains('active'))
                            .map(toggle => toggle.dataset.type);

                        const isFiltering = activeTypes.length < filterToggles.length;

                        if (isFiltering && visibleCount !== totalCount) {
                            countSpan.textContent = `(${visibleCount}/${totalCount})`;
                        } else {
                            countSpan.textContent = `(${totalCount})`;
                        }
                    }
                });

                // Handle combined "tool" filter separately
                const visibleToolMessages = document.querySelectorAll(`.message.tool_use:not(.session-header):not(.filtered-hidden), .message.tool_result:not(.session-header):not(.filtered-hidden)`);
                const totalToolMessages = document.querySelectorAll(`.message.tool_use:not(.session-header), .message.tool_result:not(.session-header)`);
                const visibleToolCount = visibleToolMessages.length;
                const totalToolCount = totalToolMessages.length;

                const toolToggle = document.querySelector(`[data-type="tool"]`);
                const toolCountSpan = toolToggle ? toolToggle.querySelector('.count') : null;

                if (toolCountSpan && totalToolCount > 0) {
                    const activeTypes = Array.from(filterToggles)
                        .filter(toggle => toggle.classList.contains('active'))
                        .map(toggle => toggle.dataset.type);

                    const isFiltering = activeTypes.length < filterToggles.length;

                    if (isFiltering && visibleToolCount !== totalToolCount) {
                        toolCountSpan.textContent = `(${visibleToolCount}/${totalToolCount})`;
                    } else {
                        toolCountSpan.textContent = `(${totalToolCount})`;
                    }
                }
            }

            function toggleFilter(button) {
                button.classList.toggle('active');
                applyFilter();
            }

            function selectAllTypes() {
                filterToggles.forEach(toggle => {
                    toggle.classList.add('active');
                });
                applyFilter();
            }

            function selectNoTypes() {
                filterToggles.forEach(toggle => {
                    toggle.classList.remove('active');
                });
                applyFilter();
            }

            // Event listeners for filter toggles
            filterToggles.forEach(toggle => {
                toggle.addEventListener('click', () => toggleFilter(toggle));
            });

            selectAllButton.addEventListener('click', selectAllTypes);
            selectNoneButton.addEventListener('click', selectNoTypes);

            // Initialize button state and message counts
            updateToggleButton();
            updateMessageCounts();

            // Apply URL filters first (if any)
            applyUrlFilters();

            // Apply all filters on page load
            applyFilter();
        });
    </script>
    <!-- Search functionality script -->
    
    <!-- Search Component -->


<script>
(function() {
    // Search state
    let searchState = {
        query: '',
        useRegex: false,
        searchInFiltered: true,
        currentMatchIndex: 0,
        matches: [],
        searchIndex: null,
        isIndexPage: window.location.pathname.includes('index.html') ||
                      window.location.pathname.endsWith('projects/') ||
                      (!window.location.pathname.includes('.html') && window.location.pathname.endsWith('/'))
    };

    // DOM elements
    const searchContainer = document.getElementById('searchContainer');
    const searchInput = document.getElementById('searchInput');
    const searchClear = document.getElementById('searchClear');
    const searchHint = document.querySelector('.search-hint');
    const searchResultsInfo = document.getElementById('searchResultsInfo');
    const searchResultCount = document.getElementById('searchResultCount');
    const searchPrev = document.getElementById('searchPrev');
    const searchNext = document.getElementById('searchNext');
    const searchRegex = document.getElementById('searchRegex');
    const searchInFiltered = document.getElementById('searchInFiltered');
    const searchResultsPanel = document.getElementById('searchResultsPanel');
    const searchResultsContent = document.getElementById('searchResultsContent');
    const searchResultsClose = document.getElementById('searchResultsClose');

    // Initialize search
    function initSearch() {
        // Build search index from page content
        buildSearchIndex();

        // Restore previous search state from localStorage
        restoreSearchState();

        // Set up event listeners
        setupEventListeners();

        // Initialize UI state
        updateSearchInputState();
    }

    // Build search index from current page
    function buildSearchIndex() {
        searchState.searchIndex = [];
        
        if (searchState.isIndexPage) {
            // Index page: index projects with individual sessions
            document.querySelectorAll('.project-card').forEach(card => {
                const projectName = card.querySelector('.project-name a')?.textContent || '';
                const projectStats = card.querySelector('.project-stats')?.textContent || '';
                const projectLink = card.querySelector('.project-name a')?.getAttribute('href') || '';
                
                // Index the project itself
                searchState.searchIndex.push({
                    type: 'project',
                    name: projectName,
                    stats: projectStats,
                    element: card,
                    link: projectLink,
                    searchText: `${projectName} ${projectStats}`,
                    originalText: `${projectName} ${projectStats}`
                });
                
                // Index individual sessions within the project
                card.querySelectorAll('.session-link').forEach(link => {
                    const sessionText = link.textContent || '';
                    const sessionHref = link.getAttribute('href') || '';
                    const sessionPreview = link.querySelector('.session-preview')?.textContent?.trim() || '';
                    const sessionMeta = link.querySelector('.session-link-meta')?.textContent || '';
                    
                    searchState.searchIndex.push({
                        type: 'session',
                        projectName: projectName,
                        sessionText: sessionText,
                        sessionPreview: sessionPreview,
                        sessionMeta: sessionMeta,
                        element: card,
                        link: sessionHref,
                        searchText: `${projectName} ${sessionText} ${sessionPreview} ${sessionMeta}`,
                        originalText: `${sessionText} ${sessionPreview}`
                    });
                });
            });
        } else {
            // Transcript page: index messages
            document.querySelectorAll('.message:not(.session-header)').forEach(message => {
                const header = message.querySelector('.header span')?.textContent || '';
                const content = message.querySelector('.content')?.textContent || '';
                const timestamp = message.querySelector('.timestamp')?.textContent || '';
                const sessionId = findSessionForMessage(message);
                
                searchState.searchIndex.push({
                    type: 'message',
                    header: header,
                    content: content,
                    timestamp: timestamp,
                    sessionId: sessionId,
                    element: message,
                    searchText: `${header} ${content}`.toLowerCase(),
                    originalText: `${header} ${content}`
                });
            });
        }
    }

    // Find session ID for a message
    function findSessionForMessage(messageElement) {
        let prev = messageElement.previousElementSibling;
        while (prev) {
            if (prev.classList.contains('session-header')) {
                return prev.id.replace('session-', '');
            }
            prev = prev.previousElementSibling;
        }
        return null;
    }

    // Create excerpt with context around matches
    function createExcerpt(text, query, contextLength = 50) {
        if (!text || !query) return '';
        
        // Create search pattern (always case-insensitive)
        let pattern;
        try {
            if (searchState.useRegex) {
                pattern = new RegExp(query, 'gi');
            } else {
                const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                pattern = new RegExp(escapedQuery, 'gi');
            }
        } catch (e) {
            return text.substring(0, 100) + (text.length > 100 ? '...' : '');
        }

        const matches = [...text.matchAll(pattern)];
        if (matches.length === 0) {
            return text.substring(0, 100) + (text.length > 100 ? '...' : '');
        }

        // Collect all excerpts with context
        const excerpts = [];
        const processedRanges = [];

        matches.forEach(match => {
            const start = Math.max(0, match.index - contextLength);
            const end = Math.min(text.length, match.index + match[0].length + contextLength);
            
            // Check for overlap with existing ranges
            const overlaps = processedRanges.find(range => 
                (start >= range.start && start <= range.end) ||
                (end >= range.start && end <= range.end) ||
                (start <= range.start && end >= range.end)
            );

            if (overlaps) {
                // Extend the existing range
                overlaps.start = Math.min(overlaps.start, start);
                overlaps.end = Math.max(overlaps.end, end);
            } else {
                processedRanges.push({ start, end });
            }
        });

        // Sort by start position and create excerpts
        processedRanges.sort((a, b) => a.start - b.start);
        
        processedRanges.forEach(range => {
            let excerpt = text.substring(range.start, range.end);
            
            // Add ellipsis if needed
            if (range.start > 0) excerpt = '...' + excerpt;
            if (range.end < text.length) excerpt = excerpt + '...';
            
            excerpts.push(excerpt);
        });

        return excerpts.join(' ');
    }

    // Count actual matches in text (always case-insensitive)
    function countMatches(text, query) {
        if (!text || !query) return 0;

        try {
            let pattern;
            if (searchState.useRegex) {
                pattern = new RegExp(query, 'gi');
            } else {
                const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                pattern = new RegExp(escapedQuery, 'gi');
            }

            const matches = text.match(pattern);
            return matches ? matches.length : 0;
        } catch (e) {
            return 0;
        }
    }

    // Toggle search hint and clear button visibility based on input content
    function updateSearchInputState() {
        const hasContent = searchInput && searchInput.value.length > 0;

        // Toggle hint visibility
        if (searchHint) {
            if (hasContent) {
                searchHint.classList.add('hidden');
            } else {
                searchHint.classList.remove('hidden');
            }
        }

        // Toggle clear button visibility
        if (searchClear) {
            if (hasContent) {
                searchClear.classList.add('visible');
            } else {
                searchClear.classList.remove('visible');
            }
        }
    }

    // Setup event listeners
    function setupEventListeners() {
        // Search input
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            updateSearchInputState();
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => performSearch(e.target.value), 300);
        });

        // Clear button
        searchClear.addEventListener('click', clearSearch);

        // Search options
        searchRegex.addEventListener('change', () => {
            searchState.useRegex = searchRegex.checked;
            if (searchState.query) performSearch(searchState.query);
        });

        searchInFiltered.addEventListener('change', () => {
            searchState.searchInFiltered = searchInFiltered.checked;
            if (searchState.query) performSearch(searchState.query);
        });

        // Navigation buttons
        searchPrev.addEventListener('click', () => navigateMatch(-1));
        searchNext.addEventListener('click', () => navigateMatch(1));

        // Close results panel
        if (searchResultsClose) {
            searchResultsClose.addEventListener('click', () => {
                searchResultsPanel.classList.remove('visible');
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', handleKeyboardShortcuts);
    }

    // Perform search
    let isSearching = false;
    function performSearch(query) {
        // Prevent concurrent searches
        if (isSearching) return;
        isSearching = true;

        searchState.query = query;
        searchClear.classList.toggle('visible', query.length > 0);
        
        // Clear previous highlights
        clearHighlights();
        
        if (!query) {
            searchState.matches = [];
            updateSearchUI();
            if (searchState.isIndexPage && searchResultsPanel) {
                searchResultsPanel.classList.remove('visible');
            }
            isSearching = false;
            return;
        }

        // Save search state
        saveSearchState();
        
        // Create search pattern (always case-insensitive)
        let searchPattern;
        try {
            if (searchState.useRegex) {
                searchPattern = new RegExp(query, 'gi');
            } else {
                const escapedQuery = query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                searchPattern = new RegExp(escapedQuery, 'gi');
            }
        } catch (e) {
            // Invalid regex
            searchState.matches = [];
            updateSearchUI();
            isSearching = false;
            return;
        }

        // Search through index
        searchState.matches = [];
        let totalMatchCount = 0;
        
        searchState.searchIndex.forEach(item => {
            // Check if element is visible (for transcript pages with filters)
            if (!searchState.isIndexPage && searchState.searchInFiltered) {
                if (item.element.classList.contains('filtered-hidden')) {
                    return;
                }
            }

            // Always use case-insensitive search
            const searchText = item.searchText.toLowerCase();
            const searchQuery = query.toLowerCase();

            // Check if item matches the search
            let matchesItem = false;
            if (searchState.useRegex) {
                searchPattern.lastIndex = 0;  // Reset lastIndex before each test to avoid skipping matches
                matchesItem = searchPattern.test(searchText);
            } else {
                matchesItem = searchText.includes(searchQuery);
            }

            if (matchesItem) {
                // Count actual matches in this item
                const matchCount = countMatches(item.originalText || item.searchText, query);
                totalMatchCount += matchCount;
                
                // Add match count and excerpt to the item
                const matchItem = {
                    ...item,
                    matchCount: matchCount,
                    excerpt: createExcerpt(item.originalText || item.searchText, query)
                };
                
                searchState.matches.push(matchItem);
                
                // Highlight matches in the element
                if (!searchState.isIndexPage) {
                    highlightInElement(item.element, searchPattern);
                }
            }
        });
        
        searchState.totalMatchCount = totalMatchCount;

        searchState.currentMatchIndex = searchState.matches.length > 0 ? 0 : -1;
        updateSearchUI();
        
        // Show results panel for index page
        if (searchState.isIndexPage && searchResultsPanel) {
            displayIndexSearchResults();
        }
        
        // Navigate to first match
        if (searchState.matches.length > 0 && !searchState.isIndexPage) {
            navigateToMatch(0);
        }

        // Reset searching flag
        isSearching = false;
    }

    // Highlight text in element
    function highlightInElement(element, pattern) {
        const walker = document.createTreeWalker(
            element,
            NodeFilter.SHOW_TEXT,
            null,
            false
        );

        const textNodes = [];
        let node;
        while (node = walker.nextNode()) {
            if (node.nodeValue.trim()) {
                textNodes.push(node);
            }
        }

        textNodes.forEach(textNode => {
            const text = textNode.nodeValue;
            const matches = [...text.matchAll(pattern)];
            
            if (matches.length > 0) {
                const fragment = document.createDocumentFragment();
                let lastIndex = 0;
                
                matches.forEach(match => {
                    // Add text before match
                    if (match.index > lastIndex) {
                        fragment.appendChild(
                            document.createTextNode(text.substring(lastIndex, match.index))
                        );
                    }
                    
                    // Add highlighted match
                    const span = document.createElement('span');
                    span.className = 'search-highlight';
                    span.textContent = match[0];
                    fragment.appendChild(span);
                    
                    lastIndex = match.index + match[0].length;
                });
                
                // Add remaining text
                if (lastIndex < text.length) {
                    fragment.appendChild(
                        document.createTextNode(text.substring(lastIndex))
                    );
                }
                
                textNode.parentNode.replaceChild(fragment, textNode);
            }
        });
    }

    // Clear all highlights
    function clearHighlights() {
        document.querySelectorAll('.search-highlight').forEach(highlight => {
            const parent = highlight.parentNode;
            parent.replaceChild(document.createTextNode(highlight.textContent), highlight);
            parent.normalize();
        });
    }

    // Navigate between matches
    function navigateMatch(direction) {
        if (searchState.matches.length === 0) return;
        
        searchState.currentMatchIndex += direction;
        
        if (searchState.currentMatchIndex < 0) {
            searchState.currentMatchIndex = searchState.matches.length - 1;
        } else if (searchState.currentMatchIndex >= searchState.matches.length) {
            searchState.currentMatchIndex = 0;
        }
        
        navigateToMatch(searchState.currentMatchIndex);
    }

    // Navigate to specific match
    function navigateToMatch(index) {
        if (index < 0 || index >= searchState.matches.length) return;
        
        // Update current highlight
        document.querySelectorAll('.search-highlight.current').forEach(el => {
            el.classList.remove('current');
        });
        
        const match = searchState.matches[index];
        const highlights = match.element.querySelectorAll('.search-highlight');
        if (highlights.length > 0) {
            highlights[0].classList.add('current');
            highlights[0].scrollIntoView({ behavior: 'smooth', block: 'center' });
        } else {
            match.element.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        
        updateSearchUI();
    }

    // Display search results for index page
    function displayIndexSearchResults() {
        if (!searchResultsPanel || !searchResultsContent) return;
        
        searchResultsPanel.classList.add('visible');
        
        if (searchState.matches.length === 0) {
            searchResultsContent.innerHTML = '<div class="search-no-results">No results found</div>';
            return;
        }
        
        // Group results by project and type
        const groupedResults = {};
        searchState.matches.forEach(match => {
            const key = match.projectName || match.name || 'Unknown';
            if (!groupedResults[key]) {
                groupedResults[key] = { projects: [], sessions: [] };
            }
            
            if (match.type === 'project') {
                groupedResults[key].projects.push(match);
            } else if (match.type === 'session') {
                groupedResults[key].sessions.push(match);
            }
        });
        
        let html = '';
        Object.entries(groupedResults).forEach(([projectName, groups]) => {
            const totalMatches = [...groups.projects, ...groups.sessions];
            const totalMatchCount = totalMatches.reduce((sum, match) => sum + match.matchCount, 0);
            
            html += `
                <div class="search-result-group">
                    <div class="search-result-group-title">
                        ${projectName}
                        <span class="search-result-count">${totalMatchCount} matches in ${totalMatches.length} items</span>
                    </div>
            `;
            
            // Show project matches first
            groups.projects.forEach(match => {
                html += `
                    <div class="search-result-item">
                        <a href="${match.link}">
                            <div class="search-result-session">üìÅ Project Overview</div>
                            <div class="search-result-excerpt">
                                ${highlightText(match.excerpt, searchState.query)}
                            </div>
                            <div class="search-result-meta">
                                <span>${match.matchCount} matches</span>
                                <span>${match.stats}</span>
                            </div>
                        </a>
                    </div>
                `;
            });
            
            // Show session matches
            groups.sessions.forEach(match => {
                const sessionId = match.link.split('/').pop().replace('session-', '').replace('.html', '').substring(0, 8);
                html += `
                    <div class="search-result-item">
                        <a href="${match.link}">
                            <div class="search-result-session">üí¨ Session ${sessionId}</div>
                            <div class="search-result-excerpt">
                                ${highlightText(match.excerpt, searchState.query)}
                            </div>
                            <div class="search-result-meta">
                                <span>${match.matchCount} matches</span>
                                <span>${match.sessionMeta}</span>
                            </div>
                        </a>
                    </div>
                `;
            });
            
            html += '</div>';
        });
        
        searchResultsContent.innerHTML = html;
    }

    // Highlight text in search results (always case-insensitive)
    function highlightText(text, query) {
        if (!query) return text;

        const pattern = searchState.useRegex ?
            new RegExp(query, 'gi') :
            new RegExp(query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'gi');

        return text.replace(pattern, match => `<span class="search-highlight">${match}</span>`);
    }

    // Update search UI
    function updateSearchUI() {
        const hasMatches = searchState.matches.length > 0;
        
        searchResultsInfo.classList.toggle('visible', hasMatches);
        searchPrev.disabled = !hasMatches;
        searchNext.disabled = !hasMatches;
        
        if (hasMatches) {
            if (searchState.isIndexPage) {
                const totalMatches = searchState.totalMatchCount || searchState.matches.length;
                const conversationCount = searchState.matches.length;
                if (totalMatches > conversationCount) {
                    searchResultCount.textContent = `${totalMatches} matches in ${conversationCount} conversations`;
                } else {
                    searchResultCount.textContent = `${conversationCount} matches`;
                }
            } else {
                searchResultCount.textContent = `${searchState.currentMatchIndex + 1} of ${searchState.matches.length} matches`;
            }
        } else if (searchState.query) {
            searchResultCount.textContent = 'No matches';
        } else {
            searchResultCount.textContent = 'No results';
        }
    }

    // Clear search
    function clearSearch() {
        searchInput.value = '';
        searchState.query = '';
        searchState.matches = [];
        searchState.currentMatchIndex = 0;
        updateSearchInputState();
        clearHighlights();
        updateSearchUI();

        if (searchState.isIndexPage && searchResultsPanel) {
            searchResultsPanel.classList.remove('visible');
        }

        saveSearchState();
    }


    // Handle keyboard shortcuts
    function handleKeyboardShortcuts(e) {
        // Ctrl+F or Cmd+F
        if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
            e.preventDefault();

            // On transcript pages, open filter toolbar if not visible
            const filterToolbar = document.querySelector('.filter-toolbar');
            if (filterToolbar && !filterToolbar.classList.contains('visible')) {
                // Trigger filter button click to show toolbar
                const filterButton = document.getElementById('filterMessages');
                if (filterButton) filterButton.click();
            }

            // Focus and select search input
            if (searchInput) {
                searchInput.focus();
                searchInput.select();
            }
        }

        // F3 - Next match
        if (e.key === 'F3') {
            e.preventDefault();
            if (e.shiftKey) {
                navigateMatch(-1);
            } else {
                navigateMatch(1);
            }
        }

        // Escape - Close search results panel on index page
        if (e.key === 'Escape') {
            if (searchState.isIndexPage && searchResultsPanel && searchResultsPanel.classList.contains('visible')) {
                searchResultsPanel.classList.remove('visible');
            }
        }
        
        // Enter - Next match when search input is focused
        if (e.key === 'Enter' && document.activeElement === searchInput) {
            e.preventDefault();
            if (e.shiftKey) {
                navigateMatch(-1);
            } else {
                navigateMatch(1);
            }
        }
    }

    // Save search state to localStorage
    function saveSearchState() {
        const state = {
            query: searchState.query,
            useRegex: searchState.useRegex,
            searchInFiltered: searchState.searchInFiltered
        };
        localStorage.setItem('claudeLogSearchState', JSON.stringify(state));
    }

    // Restore search state from localStorage
    function restoreSearchState() {
        const saved = localStorage.getItem('claudeLogSearchState');
        if (saved) {
            try {
                const state = JSON.parse(saved);
                searchState.useRegex = state.useRegex || false;
                searchState.searchInFiltered = state.searchInFiltered !== false;

                // Update UI
                searchRegex.checked = searchState.useRegex;
                searchInFiltered.checked = searchState.searchInFiltered;
            } catch (e) {
                console.error('Failed to restore search state:', e);
            }
        }
    }

    // Re-index when filters change (for transcript pages)
    if (!searchState.isIndexPage) {
        // Listen for filter changes
        let isUpdatingFilters = false;
        const observer = new MutationObserver((mutations) => {
            // Only react to filtered-hidden class changes, not search highlights
            const hasFilterChange = mutations.some(mutation => {
                if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                    const target = mutation.target;
                    // Check if this is a message element getting filtered
                    return target.classList && target.classList.contains('message');
                }
                return false;
            });

            if (hasFilterChange && !isUpdatingFilters && searchState.query && searchState.searchInFiltered) {
                isUpdatingFilters = true;
                setTimeout(() => {
                    buildSearchIndex();
                    performSearch(searchState.query);
                    isUpdatingFilters = false;
                }, 100);
            }
        });

        // Observe changes to filtered-hidden class
        observer.observe(document.body, {
            attributes: true,
            attributeFilter: ['class'],
            subtree: true
        });
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initSearch);
    } else {
        initSearch();
    }
})();
</script>
</body>

</html>